"use strict";const getGlobalThis=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==this)return this;throw new Error("Unable to locate global `this`")},globalObject=getGlobalThis();var loader;!function(v){let A=0;const S=[],E=[],R={baseUrl:""},I={};function c(v,S,E){let R=null,O={},z=null;"function"==typeof v?O=v:"string"==typeof v?(R=v,"function"==typeof S?O=S:S instanceof Array&&(z=S,O=E)):v instanceof Array&&(z=v,"function"==typeof S&&(O=S)),z=z||["require","exports","module"],null===R&&(R="unnamed-module-"+A++),R=g(R),z=(z||[]).map((v=>function(v,A){return v?b(A,v):A}(R,v))),I[R]||(I[R]={name:R,parent:null,dclamd:1,dependencies:z,handlers:[],exports:{},dependants:new Set}),I[R].dependencies=z,p(z,(function(v){const A=I[R];if(!A)throw new Error("Could not access registered module "+R);let S=A.exports;S="function"==typeof O?O.apply(globalObject,v)||S:O,A.exports=S,d(R)}),(v=>{if("function"!=typeof onerror)throw v;onerror(v)}),R)}function d(v){const A=I[v];if(!A)throw new Error("Could not access registered module "+v);A.dclamd=2;const S=A.handlers;if(S&&S.length)for(let A=0;A<S.length;A++)S[A](I[v])}function u(v,A,S){if(!I[v])return null;if(v===A||50===S)return[v];const E=I[v].dependencies;for(let R=0,I=E.length;R<I;R++){const I=u(E[R],A,S+1);if(null!==I)return I.push(v),I}return null}function a(v,A){const S=I[v];if(!S)return!1;const E={};for(const v in I)E[v]=!1;const R=[];for(R.push(S),E[v]=!0;R.length>0;){const v=R.shift().dependencies;if(v)for(let S=0,O=v.length;S<O;S++){const O=v[S];if(O===A)return!0;const z=I[O];z&&!E[O]&&(E[O]=!0,R.push(z))}}return!1}function p(v,A,S,R){const O=new Array(v.length).fill(null);let z=0,M=!1;if("string"==typeof v){if(I[v]){if(1===I[v].dclamd)throw new Error(`Trying to load ${v} from ${R}. The first module is still loading.`);return I[v]}throw new Error(v+" has not been defined. Please include it as a dependency in "+R+"'s define()")}const B=v.length;for(let k=0;k<B;k++)switch(v[k]){case"require":const h=function(v,A,S){return p(v,A,S,R)};h.toUrl=function(v){return b(v,R)},O[k]=h,z++;break;case"exports":if(!I[R])throw new Error("Parent module "+R+" not registered yet");O[k]=I[R].exports,z++;break;case"module":O[k]={id:R,uri:b(R)},z++;break;default:{const H=v[k],m=()=>{O[k]=I[H].exports,z++,z===B&&A&&(M=!0,A(O))};if(a(H,R)){const v=u(H,R,0);v&&(v.reverse(),v.push(H),E.push(v)),w(H,(()=>{}),S,R),m()}else w(H,m,S,R);break}}!M&&z===B&&A&&A(O)}function h(v,A){return function(){return dcl.callRpc(v,A.name,S.slice.call(arguments,0))}}function w(v,A,S,E){if(I[v])return I[v].dependants.add(E),void(1===I[v].dclamd?A&&I[v].handlers.push(A):A&&A(I[v]));if(I[v]={name:v,parent:E,dclamd:1,handlers:[A],dependencies:[],dependants:new Set([E]),exports:{}},0===v.indexOf("@")){const A=I[v].exports;if("function"!=typeof dcl.loadModule)throw new Error("Asynchronous modules will not work because loadModule function is not present");dcl.loadModule(v,A).then((S=>{for(const v in S.methods){const E=S.methods[v];A[E.name]=h(S.rpcHandle,E)}d(v)})).catch((v=>{S(v)}))}}function g(v){let A,S=v;for(A=/\/\.\//;A.test(S);)S=S.replace(A,"/");for(S=S.replace(/^\.\//g,""),A=/\/(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//;A.test(S);)S=S.replace(A,"/");return S=S.replace(/^(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//,""),S=S.replace(/^\//g,""),S}function b(v,A){switch(v){case"require":case"exports":case"module":return v}return A?function(v,A){let S=v;if(!S.startsWith("@")&&(S.startsWith("./")||S.startsWith("../"))){const v=A.split("/");v.pop(),S=g(v.join("/")+"/"+S)}return S}(v,A):g(v)}v.config=function(v){if("object"==typeof v)for(const A in v)v.hasOwnProperty(A)&&(R[A]=v[A])},v.define=c,function(v){v.amd={},v.modules=I}(c=v.define||(v.define={})),v.require=p,"undefined"!=typeof dcl&&dcl.onStart((()=>{const v=new Set,A=[];for(const S in I)I[S]&&(1===I[S].dclamd&&A.push(I[S]),I[S].dependencies.forEach((A=>{"require"!==A&&"exports"!==A&&"module"!==A&&(I[A]||v.add(A))})));const S=[];if(E.length&&S.push(`\n> Cyclic dependencies: ${E.map((v=>"\n  - "+v.join(" -> "))).join("")}`),v.size&&S.push(`\n> Undeclared/unknown modules: ${Array.from(v).map((v=>"\n  - "+v)).join("")}`),A.length&&S.push(`\n> These modules didn't load: ${A.map((v=>"\n  - "+v.name)).join("")}.\n`),S.length)throw new Error(S.join("\n"))})),p.toUrl=b}(loader||(loader={})),globalObject.define=loader.define,globalObject.dclamd=loader,function(v){var A=function(){function t(){}return t.AVATAR={getEntityRepresentation:function(v){return v.avatarEntity}},t.FIRST_PERSON_CAMERA={getEntityRepresentation:function(v){return v.firstPersonCameraEntity}},t}(),n=function(v,A){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var S in A)Object.prototype.hasOwnProperty.call(A,S)&&(v[S]=A[S])},n(v,A)
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */};function i(v,A){if("function"!=typeof A&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function i(){this.constructor=v}n(v,A),v.prototype=null===A?Object.create(A):(i.prototype=A.prototype,new i)}var o=function(){return o=Object.assign||function(v){for(var A,S=1,E=arguments.length;S<E;S++)for(var R in A=arguments[S])Object.prototype.hasOwnProperty.call(A,R)&&(v[R]=A[R]);return v},o.apply(this,arguments)};function r(v,A,S,E){var R,I=arguments.length,O=I<3?A:null===E?E=Object.getOwnPropertyDescriptor(A,S):E;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)O=Reflect.decorate(v,A,S,E);else for(var z=v.length-1;z>=0;z--)(R=v[z])&&(O=(I<3?R(O):I>3?R(A,S,O):R(A,S))||O);return I>3&&O&&Object.defineProperty(A,S,O),O}function s(v,A){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(v,A)}function h(v){var A="function"==typeof Symbol&&Symbol.iterator,S=A&&v[A],E=0;if(S)return S.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(v,A){var S="function"==typeof Symbol&&v[Symbol.iterator];if(!S)return v;var E,R,I=S.call(v),O=[];try{for(;(void 0===A||A-- >0)&&!(E=I.next()).done;)O.push(E.value)}catch(v){R={error:v}}finally{try{E&&!E.done&&(S=I.return)&&S.call(I)}finally{if(R)throw R.error}}return O}function p(v,A){for(var S=0,E=A.length,R=v.length;S<E;S++,R++)v[R]=A[S];return v}var S=0;function u(){for(var v=[],A=0;A<arguments.length;A++)v[A]=arguments[A];"undefined"!=typeof dcl?dcl.log.apply(dcl,p([],l(v))):console.log.apply(console,p(["DEBUG:"],l(v)))}function y(v,A){"undefined"!=typeof dcl?dcl.error(v,A):console.error("ERROR:",v,A)}function f(v){if(S++,0===v.length)throw new Error("newId(type: string): type cannot be empty");return v+S.toString(36)}function m(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(v){var A=16*Math.random()|0;return("x"===v?A:3&A|8).toString(16)}))}var E=[];function _(v){if(!("__event_name__"in v)||"string"!=typeof v.__event_name__)throw new Error("The EventConstructor is not registered");return v.__event_name__}var R=function(){function t(){this.listeners={}}return t.prototype.addListener=function(v,A,S){if(!v||"function"!=typeof v)throw new Error("Invalid EventConstructor");var E=_(v),R=this.listeners[E];R||(R=this.listeners[E]=[]);for(var I=0;I<R.length;I++)if(R[I].listener===A)throw new Error("The provided listener is already registered");return R.push({listener:A,fn:S}),this},t.prototype.removeListener=function(v,A){if(!A||"function"!=typeof A)throw new Error("Invalid EventConstructor");var S=_(A),E=this.listeners[S];if(!E)return!1;for(var R=0;R<E.length;R++)if(E[R].listener===v)return E.splice(R,1),!0;return!1},t.prototype.fireEvent=function(v){var A=_(v.constructor),S=this.listeners[A];if(S)for(var E=0;E<S.length;E++)try{var R=S[E];R.fn.call(R.listener,v)}catch(v){y(v)}return this},t}();function x(){var v=f("EV");if(-1!==E.indexOf(v))throw new Error("The event name ".concat(v," is already taken"));return E.push(v),function(A){return A.__event_name__=v,A}}var I,O=r([x(),s("design:paramtypes",[Object,String,Object])],(function(v,A,S){this.entity=v,this.componentName=A,this.component=S})),z=r([x(),s("design:paramtypes",[Object,String,Object])],(function(v,A,S){this.entity=v,this.componentName=A,this.classId=S})),M=r([x(),s("design:paramtypes",[Object,Object])],(function(v,A){this.entity=v,this.parent=A}));v.UIValueType=void 0,(I=v.UIValueType||(v.UIValueType={}))[I.PERCENT=0]="PERCENT",I[I.PIXELS=1]="PIXELS";var B=function(){function e(A){if(this.type=v.UIValueType.PIXELS,"string"==typeof A){var S=A;S.indexOf("px")>-1?this.type=v.UIValueType.PIXELS:S.indexOf("%")>-1&&(this.type=v.UIValueType.PERCENT),this.value=parseFloat(S)}else this.value=A}return e.prototype.toString=function(){var A=this.value.toString();return this.type===v.UIValueType.PERCENT?A+="%":A+="px",A},e}(),k="__name__symbol_",H="__classId__symbol_",V="__component__id_",W=r([x(),s("design:paramtypes",[String,String,Number])],(function(v,A,S){this.componentId=v,this.componentName=A,this.classId=S})),X=r([x(),s("design:paramtypes",[String])],(function(v){this.componentId=v})),Q=r([x(),s("design:paramtypes",[String,Object])],(function(v,A){this.componentId=v,this.component=A}));function P(v,A){return function(S){if(S.isComponent)throw new TypeError("You cannot extend a component. Trying to extend ".concat(S.originalClassName," with: ").concat(v));var E=S,o=function(){var S=Array.prototype.slice.call(arguments),R=new(E.bind.apply(E,p([void 0],l(S))));return Object.defineProperty(R,k,{enumerable:!1,writable:!1,configurable:!1,value:v}),void 0!==A&&Object.defineProperty(R,H,{enumerable:!1,writable:!1,configurable:!1,value:A}),R};return void 0!==A&&(o.__classId__symbol_=A),o.__name__symbol_=v,o.isComponent=!0,o.originalClassName=v,(o.prototype=S.prototype).constructor=S,o}}function N(v,A){return function(S){if(S.isComponent)throw new TypeError("You cannot extend a component. Trying to extend ".concat(S.originalClassName," with: ").concat(v));if("number"!=typeof A||isNaN(A))throw new Error("classId: ".concat(A," is an invalid integer"));var E=S,o=function(){if(!N.engine)throw new Error("You need to set a DisposableComponent.engine before creating disposable components");var S=Array.prototype.slice.call(arguments),R=new(E.bind.apply(E,p([void 0],l(S)))),I=f("C");return Object.defineProperty(R,k,{enumerable:!1,writable:!1,configurable:!1,value:v}),Object.defineProperty(R,V,{enumerable:!1,writable:!1,configurable:!1,value:I}),void 0!==A&&Object.defineProperty(R,H,{enumerable:!1,writable:!1,configurable:!1,value:A}),N.engine&&N.engine.registerComponent(R),R};return void 0!==A&&(o.__classId__symbol_=A),o.__name__symbol_=v,o.isComponent=!0,o.isDisposableComponent=!0,o.originalClassName=v,(o.prototype=S.prototype).constructor=S,o}}function F(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__name__symbol_)return v.__name__symbol_;throw new TypeError(v+" is not a registered component.")}function L(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__classId__symbol_)return v.__classId__symbol_;if(!v.__name__symbol_)throw new TypeError(v+" is not a registered component.");return null}function D(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__component__id_)return v.__component__id_;throw new TypeError(v+" is not a registered disposable component.")}!function(v){v.engine=null}(N||(N={}));var K=function(){function t(){this.dirty=!1,this.data={},this.subscriptions=[]}return t.component=function(v,A){if(delete v[A]){var S=A+"_"+Math.random();v[S]=void 0,Object.defineProperty(v,S,o(o({},Object.getOwnPropertyDescriptor(v,S)),{enumerable:!1})),Object.defineProperty(v,A.toString(),{get:function(){return this[S]},set:function(v){var E=this[S];if(this.data[A]=v?D(v):null,this[S]=v,v!==E){this.dirty=!0;for(var R=0;R<this.subscriptions.length;R++)this.subscriptions[R](A,v,E)}},enumerable:!0})}},t.field=function(v,A){delete v[A]&&Object.defineProperty(v,A.toString(),{get:function(){return this.data[A]},set:function(v){var S=this.data[A];if(this.data[A]=v,v!==S){this.dirty=!0;for(var E=0;E<this.subscriptions.length;E++)this.subscriptions[E](A,v,S)}},enumerable:!0})},t.uiValue=function(v,A){delete v[A]&&Object.defineProperty(v,A.toString(),{get:function(){return this.data[A].toString()},set:function(v){var S=this.data[A],E=new B(v);if(this.data[A]=E,E!==S){this.dirty=!0;for(var R=0;R<this.subscriptions.length;R++)this.subscriptions[R](A,E,S)}},enumerable:!0})},t.readonly=function(v,A){delete v[A]&&Object.defineProperty(v,A.toString(),{get:function(){if(A in this.data==0)throw new Error("The field ".concat(A," is uninitialized"));return this.data[A]},set:function(v){if(A in this.data)throw new Error("The field ".concat(A," is readonly"));this.data[A]=v,this.dirty=!0},enumerable:!0,configurable:!1})},t.prototype.onChange=function(v){return this.subscriptions.push(v),this},t.prototype.toJSON=function(){return this.data},t}();function U(v){return V in v}var Z=function(){function t(){for(var v=[],A=0;A<arguments.length;A++)v[A]=arguments[A];if(this.entities=[],this.active=!1,this._requiresNames=[],!v)throw new Error("ComponentGroup: Could not load the requires list");if(!(v instanceof Array))throw new Error("ComponentGroup: requires list is not an Array");Object.defineProperty(this,"requires",{get:function(){return v.slice()}}),Object.defineProperty(this,"requiresNames",{get:function(){return this._requiresNames.slice()}});for(var n=function(A){var E=v[A],R=null;if(!E)throw new Error("ComponentGroup: the required component at location ".concat(A," is invalid"));try{R=F(E)}catch(v){throw new Error("ComponentGroup: the required component at location ".concat(A," is not registered as a @Component. Remember to provide the class of the component, not the name"))}if(S._requiresNames.some((function(v){return v===R})))throw new Error("ComponentGroup: the required component list has a repeated name ".concat(R));S._requiresNames.push(R)},S=this,E=0;E<v.length;E++)n(E)}return t.prototype.hasEntity=function(v){return!!v.isAddedToEngine()&&-1!==this.entities.indexOf(v)},t.prototype.addEntity=function(v){if(!v.isAddedToEngine())throw new TypeError("ComponentGroup: Cannot add a entity that is not added to the engine");-1===this.entities.indexOf(v)&&this.entities.push(v)},t.prototype.removeEntity=function(v){var A=this.entities.indexOf(v);-1!==A&&this.entities.splice(A,1)},t.prototype.componentRemoved=function(v,A){-1!==this._requiresNames.indexOf(A)&&this.removeEntity(v)},t.prototype.meetsRequirements=function(v){for(var A=0;A<this._requiresNames.length;A++)if(!(this._requiresNames[A]in v.components))return!1;return!0},t}(),J=function(){function t(v){this.name=v,this.children={},this.eventManager=null,this.alive=!1,this.uuid=f("E"),this.components={},this.engine=null,this._parent=null}return t.prototype.addComponentOrReplace=function(v){if("function"==typeof v)throw new Error("You passed a function or class as a component, an instance of component is expected");if("object"!=typeof v)throw new Error("You passed a ".concat(typeof v,", an instance of component is expected"));var A=F(v);if(this.components[A]){if(this.components[A]===v)return v;this.removeComponent(this.components[A],!1)}return this.addComponent(v)},t.prototype.hasComponent=function(v){var A=typeof v;if("string"!==A&&"object"!==A&&"function"!==A)throw new Error("Entity#has(component): component is not a class, name or instance");if(null===v)return!1;var S="string"===A?v:F(v),E=this.components[S];return!!E&&("object"===A?E===v:"function"!==A||E instanceof v)},t.prototype.getComponent=function(v){var A=typeof v;if("string"!==A&&"function"!==A)throw new Error("Entity#get(component): component is not a class or name");var S="string"===A?v:F(v),E=this.components[S];if(!E)throw new Error('Can not get component "'.concat(S,'" from entity "').concat(this.identifier,'"'));if("function"===A){if(E instanceof v)return E;throw new Error('Can not get component "'.concat(S,'" from entity "').concat(this.identifier,'" (by instance)'))}return E},t.prototype.getComponentOrNull=function(v){var A=typeof v;if("string"!==A&&"function"!==A)throw new Error("Entity#getOrNull(component): component is not a class or name");var S="string"===A?v:F(v),E=this.components[S];return E?"function"===A?E instanceof v?E:null:E:null},t.prototype.getComponentOrCreate=function(v){if("function"!=typeof v)throw new Error("Entity#getOrCreate(component): component is not a class");var A=this.getComponentOrNull(v);return A||(F(A=new v),this.addComponentOrReplace(A)),A},t.prototype.addComponent=function(v){if("object"!=typeof v)throw new Error("Entity#add(component): You passed a function or class as a component, an instance of component is expected");var A=F(v),S=L(v);if(this.components[A])throw new Error('A component of type "'.concat(A,'" is already present in entity "').concat(this.identifier,'"'));this.components[A]=v,this.eventManager&&this.eventManager.fireEvent(new z(this,A,S));var E=v;return"function"==typeof E.addedToEntity&&E.addedToEntity(this),v},t.prototype.removeComponent=function(v,A){void 0===A&&(A=!0);var S=typeof v;if("string"!==S&&"function"!==S&&"object"!==S)throw new Error("Entity#remove(component): component is not a class, class or name");var E="string"===S?v:F(v),R=this.components[E];if(R){if("function"===S)return R instanceof v?(delete this.components[E],void(R&&(A&&this.eventManager&&this.eventManager.fireEvent(new O(this,E,R)),"function"==typeof R.removedFromEntity&&R.removedFromEntity(this)))):void u('Entity Warning: Trying to remove wrong (by constructor) component "'.concat(E,'" from entity "').concat(this.identifier,'"'));delete this.components[E],R&&(A&&this.eventManager&&this.eventManager.fireEvent(new O(this,E,R)),"function"==typeof R.removedFromEntity&&R.removedFromEntity(this))}else u('Entity Warning: Trying to remove inexisting component "'.concat(E,'" from entity "').concat(this.identifier,'"'))},t.prototype.isAddedToEngine=function(){return!(!this.engine||!(this.uuid in this.engine.entities)&&this.engine.rootEntity!==this)},t.prototype.setParent=function(v){var A;if(v&&"getEntityRepresentation"in v){if(!this.engine)throw new Error("In order to set an attachable as parent, you first need to add the entity to the engine.");A=v.getEntityRepresentation(this.engine)}else A=!v&&this.engine?this.engine.rootEntity:v;var S=this.getParent();if(A===this)throw new Error('Failed to set parent for entity "'.concat(this.identifier,"\": An entity can't set itself as a its own parent"));if(A===S)return this;var E=this.getCircularAncestor(A);if(E)throw new Error('Failed to set parent for entity "'.concat(this.identifier,'": Circular parent references are not allowed (See entity "').concat(E,'")'));return S&&delete S.children[this.uuid],null!==A&&"0"!==A.uuid&&(!A.isAddedToEngine()&&this.isAddedToEngine()&&this.engine.removeEntity(this),A.isAddedToEngine()&&!this.isAddedToEngine()&&A.engine.addEntity(this)),this._parent=A||null,this.registerAsChild(),this.eventManager&&this.engine&&this.eventManager.fireEvent(new M(this,A)),this},t.prototype.getParent=function(){return this._parent},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.name||this.uuid},enumerable:!1,configurable:!0}),t.prototype.getCircularAncestor=function(v){for(var A=this.engine?this.engine.rootEntity:null,S=v;S&&S!==A;){var E=S.getParent();if(E===this)return S.uuid;S=E}return null},t.prototype.registerAsChild=function(){var v=this.getParent();this.uuid&&v&&(v.children[this.uuid]=this)},t}(),$=function(){function t(v){this.eventManager=new R,this.systems=[],this.entityLists={},this.addedSystems=[],this._entities={},this._disposableComponents={},this._componentGroups={},this.simpleSystems=[],this.eventManager.addListener(z,this,this.componentAddedHandler),this.eventManager.addListener(O,this,this.componentRemovedHandler),this.rootEntity=v,this.firstPersonCameraEntity=new J,this.firstPersonCameraEntity.uuid="FirstPersonCameraEntityReference",this.addEntity(this.firstPersonCameraEntity),this.avatarEntity=new J,this.avatarEntity.uuid="AvatarEntityReference",this.addEntity(this.avatarEntity)}return Object.defineProperty(t.prototype,"entities",{get:function(){return this._entities},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disposableComponents",{get:function(){return this._disposableComponents},enumerable:!1,configurable:!0}),t.prototype.addEntity=function(v){var A=v.getParent();if(v.isAddedToEngine())return v;for(var S in v.eventManager=this.eventManager,v.engine=this,this._entities[v.uuid]=v,this.checkRequirementsAndAdd(v),A?A.isAddedToEngine()||A===this.rootEntity||u("Engine: warning, added an entity with a parent not present in the engine. Parent id: "+A.uuid):v.setParent(this.rootEntity),v.alive=!0,v.children){var E=v.children[S];E&&(E.isAddedToEngine()||this.addEntity(E))}return v},t.prototype.removeEntity=function(v){var A=v.uuid;if(v.isAddedToEngine()){for(var S in v.components){var E=this._componentGroups[S];if(E)for(var R in E)E[R].removeEntity(v);delete this.entityLists[S][A]}for(var I=0;I<this.simpleSystems.length;I++){var O=this.simpleSystems[I];O.onRemoveEntity&&O.onRemoveEntity(v)}for(var I in v.children){var z=v.children[I];z&&this.removeEntity(z)}return v.alive=!1,v.eventManager=null,delete this._entities[A],!0}for(var S in u("Engine: Trying to remove non existent entity from engine."),v.isAddedToEngine()?u("Engine: Entity id: "+A):u('Engine: Entity "'.concat(v.uuid,'" has not been added to any engine yet.')),u("Engine: Entity's components:"),v.components)u(S);return!1},t.prototype.addSystem=function(v,A){if(void 0===A&&(A=0),-1!==this.addedSystems.indexOf(v))return u("Engine: Trying to add a system that is already added. Aborting"),v;if(this.systems.length>0)for(var S=0;S<this.systems.length;S++){var E=this.systems[S],R=S===this.systems.length-1;if(E.priority>A){this.addedSystems.push(v),this.systems.splice(S,0,{system:v,priority:A});break}if(R){this.addedSystems.push(v),this.systems.splice(S+1,0,{system:v,priority:A});break}}else this.addedSystems.push(v),this.systems.splice(1,0,{system:v,priority:A});return this.registerSystem(v),v},t.prototype.removeSystem=function(v){var A=this.addedSystems.indexOf(v);if(-1!==A){v.active=!1,v.deactivate&&v.deactivate(),this.addedSystems.splice(A,1);for(var S=0;S<this.systems.length;S++)this.systems[S].system===v&&this.systems.splice(S,1);return!0}return!1},t.prototype.update=function(v){for(var A in this.systems){var S=this.systems[A].system;if(S.active&&S.update)try{S.update(v)}catch(v){y(v)}}return this},t.prototype.getEntitiesWithComponent=function(v){var A="string"==typeof v?v:F(v);return A in this.entityLists?this.entityLists[A]:this.entityLists[A]={}},t.prototype.registerComponent=function(v){var A=D(v),S=F(v),E=L(v);this._disposableComponents[A]=v,null!==E&&(this.eventManager.fireEvent(new W(A,S,E)),this.eventManager.fireEvent(new Q(A,v)))},t.prototype.disposeComponent=function(v){var A=D(v);return delete this._disposableComponents[A]&&(this.eventManager.fireEvent(new X(A)),v.onDispose&&v.onDispose(),!0)},t.prototype.updateComponent=function(v){this.eventManager.fireEvent(new Q(D(v),v))},t.prototype.getComponentGroup=function(){for(var v=[],A=0;A<arguments.length;A++)v[A]=arguments[A];var S=void 0;if(v.length>0&&(M=this._componentGroups[F(v[0])]))for(var E=v.slice(),R=0;R<M.length;R++){var I=M[R];if(E.length===I.requires.length){for(var O=0;O<E.length&&-1!==I.requires.indexOf(E[O]);O++)O===E.length-1&&(S=I);if(S)break}}if(S)return S;(S=new(Z.bind.apply(Z,p([void 0],l(v))))).active=!0;var z=S.requiresNames;for(R=0;R<z.length;R++){var M,B=z[R];(M=this._componentGroups[B])||(this._componentGroups[B]=M=[]),-1===M.indexOf(S)&&M.push(S)}for(var k in this._entities)this.checkRequirements(this._entities[k],S);return S},t.prototype.removeComponentGroup=function(v){if(v.active){v.active=!1;for(var A=v.requiresNames,S=0;S<A.length;S++){var E=A[S],R=this._componentGroups[E];if(R){var I=R.indexOf(v);-1!==I&&R.splice(I,1)}}return!0}return!1},t.prototype.registerSystem=function(v){v.active=!0,v.activate&&v.activate(this),this.simpleSystems.push(v)},t.prototype.checkRequirementsAndAdd=function(v){if(v.isAddedToEngine()){for(var A in v.components){A in this.entityLists||(this.entityLists[A]={}),this.entityLists[A][v.uuid]=v;var S=this._componentGroups[A];if(S)for(var E in S)this.checkRequirements(v,S[E])}for(var R=0;R<this.simpleSystems.length;R++){var I=this.simpleSystems[R];I.onAddEntity&&I.onAddEntity(v)}}},t.prototype.checkRequirements=function(v,A){A.meetsRequirements(v)?A.hasEntity(v)||A.addEntity(v):A.hasEntity(v)&&A.removeEntity(v)},t.prototype.componentAddedHandler=function(v){var A,S=v.entity,E=v.componentName;if(S.isAddedToEngine()){this.entityLists[E]?this.entityLists[E][S.uuid]=S:this.entityLists[E]=((A={})[S.uuid]=S,A);var R=this._componentGroups[E];if(R)for(var I in R)this.checkRequirements(S,R[I])}},t.prototype.componentRemovedHandler=function(v){var A=v.entity,S=v.componentName;if(A.isAddedToEngine()){delete this.entityLists[S][A.uuid];var E=this._componentGroups[S];if(E)for(var R in E)this.checkRequirements(A,E[R])}},t}(),et=Promise.resolve().then.bind(Promise.resolve());function G(v){var A=et(v);return A.isComplete=!1,A.then((function(v){A.isComplete=!0,A.result=v,A.didFail=!1})).catch((function(v){A.isComplete=!0,A.error=v,A.didFail=!0,y("executeTask: FAILED "+v.toString(),v)})),A}var nt,it,ot=function(){function t(v,A,S,E){void 0===A&&(A=!1),this.initalize(v,A,S,E)}return t.prototype.initalize=function(v,A,S,E){return void 0===A&&(A=!1),this.mask=v,this.skipNextObservers=A,this.target=S,this.currentTarget=E,this},t}(),Y=function(v,A,S){void 0===S&&(S=null),this.callback=v,this.mask=A,this.scope=S,this.unregisterOnNextCall=!1,this._willBeUnregistered=!1},rt=function(){function t(){this._observers=null,this._observables=null}return t.Watch=function(v,A,S,E){var R,I;void 0===S&&(S=-1),void 0===E&&(E=null);var O=new t;O._observers=new Array,O._observables=v;try{for(var z=h(v),M=z.next();!M.done;M=z.next()){var B=M.value.add(A,S,!1,E);B&&O._observers.push(B)}}catch(v){R={error:v}}finally{try{M&&!M.done&&(I=z.return)&&I.call(z)}finally{if(R)throw R.error}}return O},t.prototype.dispose=function(){if(this._observers&&this._observables)for(var v=0;v<this._observers.length;v++)this._observables[v].remove(this._observers[v]);this._observers=null,this._observables=null},t}(),st=function(){function t(v){this._observers=new Array,this._onObserverAdded=null,this._eventState=new ot(0),v&&(this._onObserverAdded=v)}return t.prototype.add=function(v,A,S,E,R){if(void 0===A&&(A=-1),void 0===S&&(S=!1),void 0===E&&(E=null),void 0===R&&(R=!1),!v)return null;var I=new Y(v,A,E);return I.unregisterOnNextCall=R,S?this._observers.unshift(I):this._observers.push(I),this._onObserverAdded&&this._onObserverAdded(I),I},t.prototype.addOnce=function(v){return this.add(v,void 0,void 0,void 0,!0)},t.prototype.remove=function(v){return!!v&&-1!==this._observers.indexOf(v)&&(this._deferUnregister(v),!0)},t.prototype.removeCallback=function(v,A){for(var S=0;S<this._observers.length;S++)if(this._observers[S].callback===v&&(!A||A===this._observers[S].scope))return this._deferUnregister(this._observers[S]),!0;return!1},t.prototype.notifyObservers=function(v,A,S,E){var R,I;if(void 0===A&&(A=-1),!this._observers.length)return!0;var O=this._eventState;O.mask=A,O.target=S,O.currentTarget=E,O.skipNextObservers=!1,O.lastReturnValue=v;try{for(var z=h(this._observers),M=z.next();!M.done;M=z.next()){var B=M.value;if(!B._willBeUnregistered&&(B.mask&A&&(B.scope?O.lastReturnValue=B.callback.apply(B.scope,[v,O]):O.lastReturnValue=B.callback(v,O),B.unregisterOnNextCall&&this._deferUnregister(B)),O.skipNextObservers))return!1}}catch(v){R={error:v}}finally{try{M&&!M.done&&(I=z.return)&&I.call(z)}finally{if(R)throw R.error}}return!0},t.prototype.notifyObserversWithPromise=function(v,A,S,E){var R=this;void 0===A&&(A=-1);var I=Promise.resolve(v);if(!this._observers.length)return I;var O=this._eventState;return O.mask=A,O.target=S,O.currentTarget=E,O.skipNextObservers=!1,this._observers.forEach((function(S){O.skipNextObservers||S._willBeUnregistered||S.mask&A&&(I=S.scope?I.then((function(A){return O.lastReturnValue=A,S.callback.apply(S.scope,[v,O])})):I.then((function(A){return O.lastReturnValue=A,S.callback(v,O)})),S.unregisterOnNextCall&&R._deferUnregister(S))})),I.then((function(){return v}))},t.prototype.notifyObserver=function(v,A,S){void 0===S&&(S=-1);var E=this._eventState;E.mask=S,E.skipNextObservers=!1,v.callback(A,E)},t.prototype.hasObservers=function(){return this._observers.length>0},t.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},t.prototype.clone=function(){var v=new t;return v._observers=this._observers.slice(0),v},t.prototype.hasSpecificMask=function(v){var A,S;void 0===v&&(v=-1);try{for(var E=h(this._observers),R=E.next();!R.done;R=E.next()){var I=R.value;if(I.mask&v||I.mask===v)return!0}}catch(v){A={error:v}}finally{try{R&&!R.done&&(S=E.return)&&S.call(E)}finally{if(A)throw A.error}}return!1},t.prototype._deferUnregister=function(v){var A=this;v.unregisterOnNextCall=!1,v._willBeUnregistered=!0,G((function(){return function(v,A,S,E){return new(S||(S=Promise))((function(A,R){function s(v){try{d(E.next(v))}catch(v){R(v)}}function a(v){try{d(E.throw(v))}catch(v){R(v)}}function d(v){var E;v.done?A(v.value):(E=v.value,E instanceof S?E:new S((function(v){v(E)}))).then(s,a)}d((E=E.apply(v,[])).next())}))}(A,0,void 0,(function(){return function(v,A){var S,E,R,I,O={label:0,sent:function(){if(1&R[0])throw R[1];return R[1]},trys:[],ops:[]};return I={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(I[Symbol.iterator]=function(){return this}),I;function a(I){return function(z){return function(I){if(S)throw new TypeError("Generator is already executing.");for(;O;)try{if(S=1,E&&(R=2&I[0]?E.return:I[0]?E.throw||((R=E.return)&&R.call(E),0):E.next)&&!(R=R.call(E,I[1])).done)return R;switch(E=0,R&&(I=[2&I[0],R.value]),I[0]){case 0:case 1:R=I;break;case 4:return O.label++,{value:I[1],done:!1};case 5:O.label++,E=I[1],I=[0];continue;case 7:I=O.ops.pop(),O.trys.pop();continue;default:if(!((R=(R=O.trys).length>0&&R[R.length-1])||6!==I[0]&&2!==I[0])){O=0;continue}if(3===I[0]&&(!R||I[1]>R[0]&&I[1]<R[3])){O.label=I[1];break}if(6===I[0]&&O.label<R[1]){O.label=R[1],R=I;break}if(R&&O.label<R[2]){O.label=R[2],O.ops.push(I);break}R[2]&&O.ops.pop(),O.trys.pop();continue}I=A.call(v,O)}catch(v){I=[6,v],E=0}finally{S=R=0}if(5&I[0])throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}([I,z])}}}(this,(function(A){return[2,this._remove(v)]}))}))}))},t.prototype._remove=function(v){if(!v)return!1;var A=this._observers.indexOf(v);return-1!==A&&(this._observers.splice(A,1),!0)},t}(),at=r([x(),s("design:paramtypes",[String,Object])],(function(v,A){this.uuid=v,this.payload=A})),lt=r([x(),s("design:paramtypes",[Object])],(function(v){this.payload=v})),ht=r([x(),s("design:paramtypes",[Object])],(function(v){this.payload=v}));function tt(v){return function(){it&&it.subscribe(v)}}var ct=new st(tt("cameraModeChanged")),ut=new st(tt("idleStateChanged")),dt=new st(tt("onEnterScene")),pt=dt,yt=new st(tt("onLeaveScene")),ft=yt,gt=new st(tt("sceneStart")),vt=new st(tt("playerExpression")),bt=new st(tt("onPointerLock")),wt=new st(tt("videoEvent")),Tt=new st(tt("profileChanged")),xt=new st(tt("playerConnected")),Ct=new st(tt("playerDisconnected")),_t=new st(tt("onRealmChanged")),At=new st(tt("playerClicked"));function mt(v){(it=v)&&it.onEvent((function(v){switch(v.type){case"onEnterScene":return void dt.notifyObservers(v.data);case"onLeaveScene":return void yt.notifyObservers(v.data);case"cameraModeChanged":return void ct.notifyObservers(v.data);case"idleStateChanged":return void ut.notifyObservers(v.data);case"sceneStart":return void gt.notifyObservers(v.data);case"playerExpression":return void vt.notifyObservers(v.data);case"videoEvent":var A=v.data,S=N.engine.disposableComponents[A.componentId];return S&&S.update(A),void wt.notifyObservers(A);case"profileChanged":return void Tt.notifyObservers(v.data);case"onPointerLock":return void bt.notifyObservers(v.data);case"playerConnected":return void xt.notifyObservers(v.data);case"playerDisconnected":return void Ct.notifyObservers(v.data);case"onRealmChanged":return void _t.notifyObservers(v.data);case"playerClicked":return void At.notifyObservers(v.data)}}))}var St=function(){function t(v){this.dcl=v,this.cachedComponents={}}return t.prototype.activate=function(v){var A=this;this.engine=v,v.eventManager.addListener(z,this,this.componentAdded),v.eventManager.addListener(O,this,this.componentRemoved),v.eventManager.addListener(W,this,this.disposableComponentCreated),v.eventManager.addListener(X,this,this.disposableComponentRemoved),v.eventManager.addListener(Q,this,this.disposableComponentUpdated),v.eventManager.addListener(M,this,this.parentChanged);var S=v.rootEntity.uuid;this.dcl.addEntity(S),this.dcl.onUpdate((function(S){v.update(S),A.presentEntities()})),this.dcl.onEvent((function(A){var S=A.data;switch(A.type){case"uuidEvent":v.eventManager.fireEvent(new at(S.uuid,S.payload));break;case"raycastResponse":("HitFirst"===S.queryType||"HitAll"===S.queryType)&&v.eventManager.fireEvent(new lt(S));break;case"actionButtonEvent":v.eventManager.fireEvent(new ht(S.payload))}}))},t.prototype.onAddEntity=function(v){if(v&&v.isAddedToEngine()){var A=v.uuid,S=v.getParent();for(var E in this.dcl.addEntity(A),S&&this.dcl.setParent(A,S.uuid),this.cachedComponents[A]={},v.components){var R=v.components[E],I=L(R);if(null!==I)if(U(R))this.dcl.attachEntityComponent(v.uuid,E,D(R));else{var O=JSON.stringify(R);this.dcl.updateEntityComponent(A,E,I,O),this.cachedComponents[A][E]=O}}}},t.prototype.onRemoveEntity=function(v){if(v.isAddedToEngine()){var A=v.uuid;this.dcl.removeEntity(A),delete this.cachedComponents[A]}},t.prototype.presentEntities=function(){for(var v in this.engine.entities){var A=this.engine.entities[v];for(var S in A.components){var E=L(O=A.components[S]);if(null!==E&&!U(O)){var R=this.getJsonIfDirty(A.uuid,S,O);R&&(this.dcl.updateEntityComponent(A.uuid,S,E,R),this.clearDirty(A.uuid,S,O,R))}}}for(var I in this.engine.disposableComponents){var O;(O=this.engine.disposableComponents[I])instanceof K&&O.dirty&&(this.dcl.componentUpdated(I,JSON.stringify(O)),O.dirty=!1)}},t.prototype.componentAdded=function(v){if(v.entity.isAddedToEngine()){var A=v.entity.components[v.componentName];if(U(A))this.dcl.attachEntityComponent(v.entity.uuid,v.componentName,D(A));else if(null!==v.classId){var S=JSON.stringify(A);this.dcl.updateEntityComponent(v.entity.uuid,v.componentName,v.classId,S),this.cachedComponents[v.entity.uuid][v.componentName]=S}}},t.prototype.componentRemoved=function(v){v.entity.isAddedToEngine()&&(this.dcl.removeEntityComponent(v.entity.uuid,v.componentName),delete this.cachedComponents[v.entity.uuid][v.componentName])},t.prototype.disposableComponentCreated=function(v){this.dcl.componentCreated(v.componentId,v.componentName,v.classId)},t.prototype.disposableComponentRemoved=function(v){this.dcl.componentDisposed(v.componentId)},t.prototype.disposableComponentUpdated=function(v){this.dcl.componentUpdated(v.componentId,JSON.stringify(v.component))},t.prototype.parentChanged=function(v){this.dcl.setParent(v.entity.uuid,v.parent?v.parent.uuid:"0")},t.prototype.getJsonIfDirty=function(v,A,S){var E=JSON.stringify(S);return E!==this.cachedComponents[v][A]&&E},t.prototype.clearDirty=function(v,A,S,E){this.cachedComponents[v][A]=E},t}(),Rt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Pt={},It={};!function(v){var A,S;Object.defineProperty(v,"__esModule",{value:!0}),v.RAD2DEG=v.DEG2RAD=v.Epsilon=v.ToLinearSpace=v.ToGammaSpace=v.Space=v.Orientation=void 0,(A=v.Orientation||(v.Orientation={}))[A.CW=0]="CW",A[A.CCW=1]="CCW",(S=v.Space||(v.Space={}))[S.LOCAL=0]="LOCAL",S[S.WORLD=1]="WORLD",S[S.BONE=2]="BONE",v.ToGammaSpace=1/2.2,v.ToLinearSpace=2.2,v.Epsilon=1e-6,v.DEG2RAD=Math.PI/180,v.RAD2DEG=360/(2*Math.PI)}(It);var Ot={},Nt={};Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.buildArray=void 0,Nt.buildArray=function(v,A){const S=[];for(let E=0;E<v;++E)S.push(A());return S};var zt={},Lt={},Ft={},Bt={},kt={};Object.defineProperty(kt,"__esModule",{value:!0}),kt.Scalar=void 0;class Et{static WithinEpsilon(v,A,S=1401298e-51){const E=v-A;return-S<=E&&E<=S}static ToHex(v){const A=v.toString(16);return v<=15?("0"+A).toUpperCase():A.toUpperCase()}static Sign(v){const A=+v;return 0===A||isNaN(A)?A:A>0?1:-1}static Clamp(v,A=0,S=1){return Math.min(S,Math.max(A,v))}static Log2(v){return Math.log(v)*Math.LOG2E}static Repeat(v,A){return v-Math.floor(v/A)*A}static Normalize(v,A,S){return(v-A)/(S-A)}static Denormalize(v,A,S){return v*(S-A)+A}static DeltaAngle(v,A){let S=Et.Repeat(A-v,360);return S>180&&(S-=360),S}static PingPong(v,A){const S=Et.Repeat(v,2*A);return A-Math.abs(S-A)}static SmoothStep(v,A,S){let E=Et.Clamp(S);return E=-2*E*E*E+3*E*E,A*E+v*(1-E)}static MoveTowards(v,A,S){let E=0;return E=Math.abs(A-v)<=S?A:v+Et.Sign(A-v)*S,E}static MoveTowardsAngle(v,A,S){const E=Et.DeltaAngle(v,A);let R=0;return R=-S<E&&E<S?A:Et.MoveTowards(v,v+E,S),R}static Lerp(v,A,S){return v+(A-v)*S}static LerpAngle(v,A,S){let E=Et.Repeat(A-v,360);return E>180&&(E-=360),v+E*Et.Clamp(S)}static InverseLerp(v,A,S){let E=0;return E=v!==A?Et.Clamp((S-v)/(A-v)):0,E}static Hermite(v,A,S,E,R){const I=R*R,O=R*I;return v*(2*O-3*I+1)+S*(-2*O+3*I)+A*(O-2*I+R)+E*(O-I)}static RandomRange(v,A){return v===A?v:Math.random()*(A-v)+v}static RangeToPercent(v,A,S){return(v-A)/(S-A)}static PercentToRange(v,A,S){return(S-A)*v+A}static NormalizeRadians(v){return v-Et.TwoPi*Math.floor((v+Math.PI)/Et.TwoPi)}}kt.Scalar=Et,Et.TwoPi=2*Math.PI,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.Vector4=void 0;const Ht=It,Ut=kt,Vt=zt;class Mt{constructor(v,A,S,E){this.x=v,this.y=A,this.z=S,this.w=E}static Add(v,A){return new Mt(v.x,v.y,v.z,v.w).addInPlace(A)}static FromArray(v,A=0){return new Mt(v[A],v[A+1],v[A+2],v[A+3])}static FromArrayToRef(v,A,S){S.x=v[A],S.y=v[A+1],S.z=v[A+2],S.w=v[A+3]}static FromFloatArrayToRef(v,A,S){Mt.FromArrayToRef(v,A,S)}static FromFloatsToRef(v,A,S,E,R){R.x=v,R.y=A,R.z=S,R.w=E}static Zero(){return new Mt(0,0,0,0)}static One(){return new Mt(1,1,1,1)}static Normalize(v){const A=Mt.Zero();return Mt.NormalizeToRef(v,A),A}static NormalizeToRef(v,A){A.copyFrom(v),A.normalize()}static Minimize(v,A){const S=new Mt(v.x,v.y,v.z,v.w);return S.minimizeInPlace(A),S}static Maximize(v,A){const S=new Mt(v.x,v.y,v.z,v.w);return S.maximizeInPlace(A),S}static Distance(v,A){return Math.sqrt(Mt.DistanceSquared(v,A))}static DistanceSquared(v,A){const S=v.x-A.x,E=v.y-A.y,R=v.z-A.z,I=v.w-A.w;return S*S+E*E+R*R+I*I}static Center(v,A){const S=Mt.Add(v,A);return S.scaleInPlace(.5),S}static TransformNormal(v,A){const S=Mt.Zero();return Mt.TransformNormalToRef(v,A,S),S}static TransformNormalToRef(v,A,S){const E=A.m,R=v.x*E[0]+v.y*E[4]+v.z*E[8],I=v.x*E[1]+v.y*E[5]+v.z*E[9],O=v.x*E[2]+v.y*E[6]+v.z*E[10];S.x=R,S.y=I,S.z=O,S.w=v.w}static TransformNormalFromFloatsToRef(v,A,S,E,R,I){const O=R.m;I.x=v*O[0]+A*O[4]+S*O[8],I.y=v*O[1]+A*O[5]+S*O[9],I.z=v*O[2]+A*O[6]+S*O[10],I.w=E}toString(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"}getClassName(){return"Vector4"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v=397*v^(this.w||0),v}asArray(){const v=new Array;return this.toArray(v,0),v}toArray(v,A=0){return v[A]=this.x,v[A+1]=this.y,v[A+2]=this.z,v[A+3]=this.w,this}addInPlace(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this}add(v){return new Mt(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w)}addToRef(v,A){return A.x=this.x+v.x,A.y=this.y+v.y,A.z=this.z+v.z,A.w=this.w+v.w,this}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this.w-=v.w,this}subtract(v){return new Mt(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w)}subtractToRef(v,A){return A.x=this.x-v.x,A.y=this.y-v.y,A.z=this.z-v.z,A.w=this.w-v.w,this}subtractFromFloats(v,A,S,E){return new Mt(this.x-v,this.y-A,this.z-S,this.w-E)}subtractFromFloatsToRef(v,A,S,E,R){return R.x=this.x-v,R.y=this.y-A,R.z=this.z-S,R.w=this.w-E,this}negate(){return new Mt(-this.x,-this.y,-this.z,-this.w)}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}scale(v){return new Mt(this.x*v,this.y*v,this.z*v,this.w*v)}scaleToRef(v,A){return A.x=this.x*v,A.y=this.y*v,A.z=this.z*v,A.w=this.w*v,this}scaleAndAddToRef(v,A){return A.x+=this.x*v,A.y+=this.y*v,A.z+=this.z*v,A.w+=this.w*v,this}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z&&this.w===v.w}equalsWithEpsilon(v,A=Ht.Epsilon){return v&&Ut.Scalar.WithinEpsilon(this.x,v.x,A)&&Ut.Scalar.WithinEpsilon(this.y,v.y,A)&&Ut.Scalar.WithinEpsilon(this.z,v.z,A)&&Ut.Scalar.WithinEpsilon(this.w,v.w,A)}equalsToFloats(v,A,S,E){return this.x===v&&this.y===A&&this.z===S&&this.w===E}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this.w*=v.w,this}multiply(v){return new Mt(this.x*v.x,this.y*v.y,this.z*v.z,this.w*v.w)}multiplyToRef(v,A){return A.x=this.x*v.x,A.y=this.y*v.y,A.z=this.z*v.z,A.w=this.w*v.w,this}multiplyByFloats(v,A,S,E){return new Mt(this.x*v,this.y*A,this.z*S,this.w*E)}divide(v){return new Mt(this.x/v.x,this.y/v.y,this.z/v.z,this.w/v.w)}divideToRef(v,A){return A.x=this.x/v.x,A.y=this.y/v.y,A.z=this.z/v.z,A.w=this.w/v.w,this}divideInPlace(v){return this.divideToRef(v,this)}minimizeInPlace(v){return v.x<this.x&&(this.x=v.x),v.y<this.y&&(this.y=v.y),v.z<this.z&&(this.z=v.z),v.w<this.w&&(this.w=v.w),this}maximizeInPlace(v){return v.x>this.x&&(this.x=v.x),v.y>this.y&&(this.y=v.y),v.z>this.z&&(this.z=v.z),v.w>this.w&&(this.w=v.w),this}floor(){return new Mt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fract(){return new Mt(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){const v=this.length();return 0===v?this:this.scaleInPlace(1/v)}toVector3(){return new Vt.Vector3(this.x,this.y,this.z)}clone(){return new Mt(this.x,this.y,this.z,this.w)}copyFrom(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}copyFromFloats(v,A,S,E){return this.x=v,this.y=A,this.z=S,this.w=E,this}set(v,A,S,E){return this.copyFromFloats(v,A,S,E)}setAll(v){return this.x=this.y=this.z=this.w=v,this}}Bt.Vector4=Mt,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.Matrix=void 0;const Wt=zt,Gt=Lt,qt=Ot,Yt=Bt;class Dt{constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this._m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this._updateIdentityStatus(!1)}get m(){return this._m}static get IdentityReadOnly(){return Dt._identityReadOnly}static FromArray(v,A=0){const S=new Dt;return Dt.FromArrayToRef(v,A,S),S}static FromArrayToRef(v,A,S){for(let E=0;E<16;E++)S._m[E]=v[E+A];S._markAsUpdated()}static FromFloatArrayToRefScaled(v,A,S,E){for(let R=0;R<16;R++)E._m[R]=v[R+A]*S;E._markAsUpdated()}static FromValuesToRef(v,A,S,E,R,I,O,z,M,B,k,H,V,W,X,Q,K){const Z=K._m;Z[0]=v,Z[1]=A,Z[2]=S,Z[3]=E,Z[4]=R,Z[5]=I,Z[6]=O,Z[7]=z,Z[8]=M,Z[9]=B,Z[10]=k,Z[11]=H,Z[12]=V,Z[13]=W,Z[14]=X,Z[15]=Q,K._markAsUpdated()}static FromValues(v,A,S,E,R,I,O,z,M,B,k,H,V,W,X,Q){const K=new Dt,Z=K._m;return Z[0]=v,Z[1]=A,Z[2]=S,Z[3]=E,Z[4]=R,Z[5]=I,Z[6]=O,Z[7]=z,Z[8]=M,Z[9]=B,Z[10]=k,Z[11]=H,Z[12]=V,Z[13]=W,Z[14]=X,Z[15]=Q,K._markAsUpdated(),K}static Compose(v,A,S){const E=new Dt;return Dt.ComposeToRef(v,A,S,E),E}static ComposeToRef(v,A,S,E){Dt.ScalingToRef(v.x,v.y,v.z,qt.MathTmp.Matrix[1]),A.toRotationMatrix(qt.MathTmp.Matrix[0]),qt.MathTmp.Matrix[1].multiplyToRef(qt.MathTmp.Matrix[0],E),E.setTranslation(S)}static Identity(){const v=Dt.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return v._updateIdentityStatus(!0),v}static IdentityToRef(v){Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,v),v._updateIdentityStatus(!0)}static Zero(){const v=Dt.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return v._updateIdentityStatus(!1),v}static RotationX(v){const A=new Dt;return Dt.RotationXToRef(v,A),A}static Invert(v){const A=new Dt;return v.invertToRef(A),A}static RotationXToRef(v,A){const S=Math.sin(v),E=Math.cos(v);Dt.FromValuesToRef(1,0,0,0,0,E,S,0,0,-S,E,0,0,0,0,1,A),A._updateIdentityStatus(1===E&&0===S)}static RotationY(v){const A=new Dt;return Dt.RotationYToRef(v,A),A}static RotationYToRef(v,A){const S=Math.sin(v),E=Math.cos(v);Dt.FromValuesToRef(E,0,-S,0,0,1,0,0,S,0,E,0,0,0,0,1,A),A._updateIdentityStatus(1===E&&0===S)}static RotationZ(v){const A=new Dt;return Dt.RotationZToRef(v,A),A}static RotationZToRef(v,A){const S=Math.sin(v),E=Math.cos(v);Dt.FromValuesToRef(E,S,0,0,-S,E,0,0,0,0,1,0,0,0,0,1,A),A._updateIdentityStatus(1===E&&0===S)}static RotationAxis(v,A){const S=new Dt;return Dt.RotationAxisToRef(v,A,S),S}static RotationAxisToRef(v,A,S){const E=Math.sin(-A),R=Math.cos(-A),I=1-R;v.normalize();const O=S._m;O[0]=v.x*v.x*I+R,O[1]=v.x*v.y*I-v.z*E,O[2]=v.x*v.z*I+v.y*E,O[3]=0,O[4]=v.y*v.x*I+v.z*E,O[5]=v.y*v.y*I+R,O[6]=v.y*v.z*I-v.x*E,O[7]=0,O[8]=v.z*v.x*I-v.y*E,O[9]=v.z*v.y*I+v.x*E,O[10]=v.z*v.z*I+R,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,S._markAsUpdated()}static RotationYawPitchRoll(v,A,S){const E=new Dt;return Dt.RotationYawPitchRollToRef(v,A,S,E),E}static RotationYawPitchRollToRef(v,A,S,E){Gt.Quaternion.RotationYawPitchRollToRef(v,A,S,qt.MathTmp.Quaternion[0]),qt.MathTmp.Quaternion[0].toRotationMatrix(E)}static Scaling(v,A,S){const E=new Dt;return Dt.ScalingToRef(v,A,S,E),E}static ScalingToRef(v,A,S,E){Dt.FromValuesToRef(v,0,0,0,0,A,0,0,0,0,S,0,0,0,0,1,E),E._updateIdentityStatus(1===v&&1===A&&1===S)}static Translation(v,A,S){const E=new Dt;return Dt.TranslationToRef(v,A,S,E),E}static TranslationToRef(v,A,S,E){Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v,A,S,1,E),E._updateIdentityStatus(0===v&&0===A&&0===S)}static Lerp(v,A,S){const E=new Dt;return Dt.LerpToRef(v,A,S,E),E}static LerpToRef(v,A,S,E){for(let R=0;R<16;R++)E._m[R]=v._m[R]*(1-S)+A._m[R]*S;E._markAsUpdated()}static DecomposeLerp(v,A,S){const E=new Dt;return Dt.DecomposeLerpToRef(v,A,S,E),E}static DecomposeLerpToRef(v,A,S,E){const R=qt.MathTmp.Vector3[0],I=qt.MathTmp.Quaternion[0],O=qt.MathTmp.Vector3[1];v.decompose(R,I,O);const z=qt.MathTmp.Vector3[2],M=qt.MathTmp.Quaternion[1],B=qt.MathTmp.Vector3[3];A.decompose(z,M,B);const k=qt.MathTmp.Vector3[4];Wt.Vector3.LerpToRef(R,z,S,k);const H=qt.MathTmp.Quaternion[2];Gt.Quaternion.SlerpToRef(I,M,S,H);const V=qt.MathTmp.Vector3[5];Wt.Vector3.LerpToRef(O,B,S,V),Dt.ComposeToRef(k,H,V,E)}static LookAtLH(v,A,S){const E=new Dt;return Dt.LookAtLHToRef(v,A,S,E),E}static LookAtLHToRef(v,A,S,E){const R=qt.MathTmp.Vector3[0],I=qt.MathTmp.Vector3[1],O=qt.MathTmp.Vector3[2];A.subtractToRef(v,O),O.normalize(),Wt.Vector3.CrossToRef(S,O,R);const z=R.lengthSquared();0===z?R.x=1:R.normalizeFromLength(Math.sqrt(z)),Wt.Vector3.CrossToRef(O,R,I),I.normalize();const M=-Wt.Vector3.Dot(R,v),B=-Wt.Vector3.Dot(I,v),k=-Wt.Vector3.Dot(O,v);Dt.FromValuesToRef(R.x,I.x,O.x,0,R.y,I.y,O.y,0,R.z,I.z,O.z,0,M,B,k,1,E)}static LookAtRH(v,A,S){const E=new Dt;return Dt.LookAtRHToRef(v,A,S,E),E}static LookAtRHToRef(v,A,S,E){const R=qt.MathTmp.Vector3[0],I=qt.MathTmp.Vector3[1],O=qt.MathTmp.Vector3[2];v.subtractToRef(A,O),O.normalize(),Wt.Vector3.CrossToRef(S,O,R);const z=R.lengthSquared();0===z?R.x=1:R.normalizeFromLength(Math.sqrt(z)),Wt.Vector3.CrossToRef(O,R,I),I.normalize();const M=-Wt.Vector3.Dot(R,v),B=-Wt.Vector3.Dot(I,v),k=-Wt.Vector3.Dot(O,v);Dt.FromValuesToRef(R.x,I.x,O.x,0,R.y,I.y,O.y,0,R.z,I.z,O.z,0,M,B,k,1,E)}static OrthoLH(v,A,S,E){const R=new Dt;return Dt.OrthoLHToRef(v,A,S,E,R),R}static OrthoLHToRef(v,A,S,E,R){const I=2/v,O=2/A,z=2/(E-S),M=-(E+S)/(E-S);Dt.FromValuesToRef(I,0,0,0,0,O,0,0,0,0,z,0,0,0,M,1,R),R._updateIdentityStatus(1===I&&1===O&&1===z&&0===M)}static OrthoOffCenterLH(v,A,S,E,R,I){const O=new Dt;return Dt.OrthoOffCenterLHToRef(v,A,S,E,R,I,O),O}static OrthoOffCenterLHToRef(v,A,S,E,R,I,O){const z=2/(A-v),M=2/(E-S),B=2/(I-R),k=-(I+R)/(I-R),H=(v+A)/(v-A),V=(E+S)/(S-E);Dt.FromValuesToRef(z,0,0,0,0,M,0,0,0,0,B,0,H,V,k,1,O),O._markAsUpdated()}static OrthoOffCenterRH(v,A,S,E,R,I){const O=new Dt;return Dt.OrthoOffCenterRHToRef(v,A,S,E,R,I,O),O}static OrthoOffCenterRHToRef(v,A,S,E,R,I,O){Dt.OrthoOffCenterLHToRef(v,A,S,E,R,I,O),O._m[10]*=-1}static PerspectiveLH(v,A,S,E){const R=new Dt,I=2*S/v,O=2*S/A,z=(E+S)/(E-S),M=-2*E*S/(E-S);return Dt.FromValuesToRef(I,0,0,0,0,O,0,0,0,0,z,1,0,0,M,0,R),R._updateIdentityStatus(!1),R}static PerspectiveFovLH(v,A,S,E){const R=new Dt;return Dt.PerspectiveFovLHToRef(v,A,S,E,R),R}static PerspectiveFovLHToRef(v,A,S,E,R,I=!0){const O=S,z=E,M=1/Math.tan(.5*v),B=I?M/A:M,k=I?M:M*A,H=(z+O)/(z-O),V=-2*z*O/(z-O);Dt.FromValuesToRef(B,0,0,0,0,k,0,0,0,0,H,1,0,0,V,0,R),R._updateIdentityStatus(!1)}static PerspectiveFovRH(v,A,S,E){const R=new Dt;return Dt.PerspectiveFovRHToRef(v,A,S,E,R),R}static PerspectiveFovRHToRef(v,A,S,E,R,I=!0){const O=S,z=E,M=1/Math.tan(.5*v),B=I?M/A:M,k=I?M:M*A,H=-(z+O)/(z-O),V=-2*z*O/(z-O);Dt.FromValuesToRef(B,0,0,0,0,k,0,0,0,0,H,-1,0,0,V,0,R),R._updateIdentityStatus(!1)}static PerspectiveFovWebVRToRef(v,A,S,E,R=!1){const I=R?-1:1,O=Math.tan(v.upDegrees*Math.PI/180),z=Math.tan(v.downDegrees*Math.PI/180),M=Math.tan(v.leftDegrees*Math.PI/180),B=Math.tan(v.rightDegrees*Math.PI/180),k=2/(M+B),H=2/(O+z),V=E._m;V[0]=k,V[1]=V[2]=V[3]=V[4]=0,V[5]=H,V[6]=V[7]=0,V[8]=(M-B)*k*.5,V[9]=-(O-z)*H*.5,V[10]=-S/(A-S),V[11]=1*I,V[12]=V[13]=V[15]=0,V[14]=-2*S*A/(S-A),E._markAsUpdated()}static GetAsMatrix2x2(v){return[v._m[0],v._m[1],v._m[4],v._m[5]]}static GetAsMatrix3x3(v){return[v._m[0],v._m[1],v._m[2],v._m[4],v._m[5],v._m[6],v._m[8],v._m[9],v._m[10]]}static Transpose(v){const A=new Dt;return Dt.TransposeToRef(v,A),A}static TransposeToRef(v,A){const S=A._m,E=v._m;S[0]=E[0],S[1]=E[4],S[2]=E[8],S[3]=E[12],S[4]=E[1],S[5]=E[5],S[6]=E[9],S[7]=E[13],S[8]=E[2],S[9]=E[6],S[10]=E[10],S[11]=E[14],S[12]=E[3],S[13]=E[7],S[14]=E[11],S[15]=E[15],A._updateIdentityStatus(v._isIdentity,v._isIdentityDirty)}static Reflection(v){const A=new Dt;return Dt.ReflectionToRef(v,A),A}static ReflectionToRef(v,A){v.normalize();const S=v.normal.x,E=v.normal.y,R=v.normal.z,I=-2*S,O=-2*E,z=-2*R;Dt.FromValuesToRef(I*S+1,O*S,z*S,0,I*E,O*E+1,z*E,0,I*R,O*R,z*R+1,0,I*v.d,O*v.d,z*v.d,1,A)}static FromXYZAxesToRef(v,A,S,E){Dt.FromValuesToRef(v.x,v.y,v.z,0,A.x,A.y,A.z,0,S.x,S.y,S.z,0,0,0,0,1,E)}static FromQuaternionToRef(v,A){const S=v.x*v.x,E=v.y*v.y,R=v.z*v.z,I=v.x*v.y,O=v.z*v.w,z=v.z*v.x,M=v.y*v.w,B=v.y*v.z,k=v.x*v.w;A._m[0]=1-2*(E+R),A._m[1]=2*(I+O),A._m[2]=2*(z-M),A._m[3]=0,A._m[4]=2*(I-O),A._m[5]=1-2*(R+S),A._m[6]=2*(B+k),A._m[7]=0,A._m[8]=2*(z+M),A._m[9]=2*(B-k),A._m[10]=1-2*(E+S),A._m[11]=0,A._m[12]=0,A._m[13]=0,A._m[14]=0,A._m[15]=1,A._markAsUpdated()}_markAsUpdated(){this.updateFlag=Dt._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const v=this._m;this._isIdentity=1===v[0]&&0===v[1]&&0===v[2]&&0===v[3]&&0===v[4]&&1===v[5]&&0===v[6]&&0===v[7]&&0===v[8]&&0===v[9]&&1===v[10]&&0===v[11]&&0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const v=this._m,A=v[0],S=v[1],E=v[2],R=v[3],I=v[4],O=v[5],z=v[6],M=v[7],B=v[8],k=v[9],H=v[10],V=v[11],W=v[12],X=v[13],Q=v[14],K=v[15],Z=H*K-Q*V,J=k*K-X*V,$=k*Q-X*H,et=B*K-W*V,nt=B*Q-H*W,it=B*X-W*k;return A*+(O*Z-z*J+M*$)+S*-(I*Z-z*et+M*nt)+E*+(I*J-O*et+M*it)+R*-(I*$-O*nt+z*it)}toArray(){return this._m}asArray(){return this._m}invert(){return this.invertToRef(this),this}reset(){return Dt.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(v){const A=new Dt;return this.addToRef(v,A),A}addToRef(v,A){for(let S=0;S<16;S++)A._m[S]=this._m[S]+v._m[S];return A._markAsUpdated(),this}addToSelf(v){for(let A=0;A<16;A++)this._m[A]+=v._m[A];return this._markAsUpdated(),this}invertToRef(v){if(!0===this._isIdentity)return Dt.IdentityToRef(v),this;const A=this._m,S=A[0],E=A[1],R=A[2],I=A[3],O=A[4],z=A[5],M=A[6],B=A[7],k=A[8],H=A[9],V=A[10],W=A[11],X=A[12],Q=A[13],K=A[14],Z=A[15],J=V*Z-K*W,$=H*Z-Q*W,et=H*K-Q*V,nt=k*Z-X*W,it=k*K-V*X,ot=k*Q-X*H,rt=+(z*J-M*$+B*et),st=-(O*J-M*nt+B*it),at=+(O*$-z*nt+B*ot),lt=-(O*et-z*it+M*ot),ht=S*rt+E*st+R*at+I*lt;if(0===ht)return v.copyFrom(this),this;const ct=1/ht,ut=M*Z-K*B,dt=z*Z-Q*B,pt=z*K-Q*M,yt=O*Z-X*B,ft=O*K-X*M,gt=O*Q-X*z,vt=M*W-V*B,bt=z*W-H*B,wt=z*V-H*M,Tt=O*W-k*B,xt=O*V-k*M,Ct=O*H-k*z,_t=-(E*J-R*$+I*et),At=+(S*J-R*nt+I*it),St=-(S*$-E*nt+I*ot),Rt=+(S*et-E*it+R*ot),Pt=+(E*ut-R*dt+I*pt),It=-(S*ut-R*yt+I*ft),Ot=+(S*dt-E*yt+I*gt),Nt=-(S*pt-E*ft+R*gt),zt=-(E*vt-R*bt+I*wt),Lt=+(S*vt-R*Tt+I*xt),Ft=-(S*bt-E*Tt+I*Ct),Bt=+(S*wt-E*xt+R*Ct);return Dt.FromValuesToRef(rt*ct,_t*ct,Pt*ct,zt*ct,st*ct,At*ct,It*ct,Lt*ct,at*ct,St*ct,Ot*ct,Ft*ct,lt*ct,Rt*ct,Nt*ct,Bt*ct,v),this}addAtIndex(v,A){return this._m[v]+=A,this._markAsUpdated(),this}multiplyAtIndex(v,A){return this._m[v]*=A,this._markAsUpdated(),this}setTranslationFromFloats(v,A,S){return this._m[12]=v,this._m[13]=A,this._m[14]=S,this._markAsUpdated(),this}setTranslation(v){return this.setTranslationFromFloats(v.x,v.y,v.z)}getTranslation(){return new Wt.Vector3(this._m[12],this._m[13],this._m[14])}getTranslationToRef(v){return v.x=this._m[12],v.y=this._m[13],v.z=this._m[14],this}removeRotationAndScaling(){const v=this.m;return Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v[12],v[13],v[14],v[15],this),this._updateIdentityStatus(0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]),this}multiply(v){const A=new Dt;return this.multiplyToRef(v,A),A}copyFrom(v){v.copyToArray(this._m);const A=v;return this._updateIdentityStatus(A._isIdentity,A._isIdentityDirty,A._isIdentity3x2,A._isIdentity3x2Dirty),this}copyToArray(v,A=0){for(let S=0;S<16;S++)v[A+S]=this._m[S];return this}multiplyToRef(v,A){return this._isIdentity?(A.copyFrom(v),this):v._isIdentity?(A.copyFrom(this),this):(this.multiplyToArray(v,A._m,0),A._markAsUpdated(),this)}multiplyToArray(v,A,S){const E=this._m,R=v.m,I=E[0],O=E[1],z=E[2],M=E[3],B=E[4],k=E[5],H=E[6],V=E[7],W=E[8],X=E[9],Q=E[10],K=E[11],Z=E[12],J=E[13],$=E[14],et=E[15],nt=R[0],it=R[1],ot=R[2],rt=R[3],st=R[4],at=R[5],lt=R[6],ht=R[7],ct=R[8],ut=R[9],dt=R[10],pt=R[11],yt=R[12],ft=R[13],gt=R[14],vt=R[15];return A[S]=I*nt+O*st+z*ct+M*yt,A[S+1]=I*it+O*at+z*ut+M*ft,A[S+2]=I*ot+O*lt+z*dt+M*gt,A[S+3]=I*rt+O*ht+z*pt+M*vt,A[S+4]=B*nt+k*st+H*ct+V*yt,A[S+5]=B*it+k*at+H*ut+V*ft,A[S+6]=B*ot+k*lt+H*dt+V*gt,A[S+7]=B*rt+k*ht+H*pt+V*vt,A[S+8]=W*nt+X*st+Q*ct+K*yt,A[S+9]=W*it+X*at+Q*ut+K*ft,A[S+10]=W*ot+X*lt+Q*dt+K*gt,A[S+11]=W*rt+X*ht+Q*pt+K*vt,A[S+12]=Z*nt+J*st+$*ct+et*yt,A[S+13]=Z*it+J*at+$*ut+et*ft,A[S+14]=Z*ot+J*lt+$*dt+et*gt,A[S+15]=Z*rt+J*ht+$*pt+et*vt,this}equals(v){const A=v;if(!A)return!1;if((this._isIdentity||A._isIdentity)&&!this._isIdentityDirty&&!A._isIdentityDirty)return this._isIdentity&&A._isIdentity;const S=this.m,E=A.m;return S[0]===E[0]&&S[1]===E[1]&&S[2]===E[2]&&S[3]===E[3]&&S[4]===E[4]&&S[5]===E[5]&&S[6]===E[6]&&S[7]===E[7]&&S[8]===E[8]&&S[9]===E[9]&&S[10]===E[10]&&S[11]===E[11]&&S[12]===E[12]&&S[13]===E[13]&&S[14]===E[14]&&S[15]===E[15]}clone(){const v=new Dt;return v.copyFrom(this),v}getClassName(){return"Matrix"}getHashCode(){let v=this._m[0]||0;for(let A=1;A<16;A++)v=397*v^(this._m[A]||0);return v}decompose(v,A,S){if(this._isIdentity)return S&&S.setAll(0),v&&v.setAll(1),A&&A.copyFromFloats(0,0,0,1),!0;const E=this._m;S&&S.copyFromFloats(E[12],E[13],E[14]);const R=v||qt.MathTmp.Vector3[0];if(R.x=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]),R.y=Math.sqrt(E[4]*E[4]+E[5]*E[5]+E[6]*E[6]),R.z=Math.sqrt(E[8]*E[8]+E[9]*E[9]+E[10]*E[10]),this.determinant()<=0&&(R.y*=-1),0===R.x||0===R.y||0===R.z)return A&&A.copyFromFloats(0,0,0,1),!1;if(A){const v=1/R.x,S=1/R.y,I=1/R.z;Dt.FromValuesToRef(E[0]*v,E[1]*v,E[2]*v,0,E[4]*S,E[5]*S,E[6]*S,0,E[8]*I,E[9]*I,E[10]*I,0,0,0,0,1,qt.MathTmp.Matrix[0]),Gt.Quaternion.FromRotationMatrixToRef(qt.MathTmp.Matrix[0],A)}return!0}getRow(v){if(v<0||v>3)return null;const A=4*v;return new Yt.Vector4(this._m[A+0],this._m[A+1],this._m[A+2],this._m[A+3])}setRow(v,A){return this.setRowFromFloats(v,A.x,A.y,A.z,A.w)}transpose(){return Dt.Transpose(this)}transposeToRef(v){return Dt.TransposeToRef(this,v),this}setRowFromFloats(v,A,S,E,R){if(v<0||v>3)return this;const I=4*v;return this._m[I+0]=A,this._m[I+1]=S,this._m[I+2]=E,this._m[I+3]=R,this._markAsUpdated(),this}scale(v){const A=new Dt;return this.scaleToRef(v,A),A}scaleToRef(v,A){for(let S=0;S<16;S++)A._m[S]=this._m[S]*v;return A._markAsUpdated(),this}scaleAndAddToRef(v,A){for(let S=0;S<16;S++)A._m[S]+=this._m[S]*v;return A._markAsUpdated(),this}toNormalMatrix(v){const A=qt.MathTmp.Matrix[0];this.invertToRef(A),A.transposeToRef(v);const S=v._m;Dt.FromValuesToRef(S[0],S[1],S[2],0,S[4],S[5],S[6],0,S[8],S[9],S[10],0,0,0,0,1,v)}getRotationMatrix(){const v=new Dt;return this.getRotationMatrixToRef(v),v}getRotationMatrixToRef(v){const A=qt.MathTmp.Vector3[0];if(!this.decompose(A))return Dt.IdentityToRef(v),this;const S=this._m,E=1/A.x,R=1/A.y,I=1/A.z;return Dt.FromValuesToRef(S[0]*E,S[1]*E,S[2]*E,0,S[4]*R,S[5]*R,S[6]*R,0,S[8]*I,S[9]*I,S[10]*I,0,0,0,0,1,v),this}toggleModelMatrixHandInPlace(){const v=this._m;v[2]*=-1,v[6]*=-1,v[8]*=-1,v[9]*=-1,v[14]*=-1,this._markAsUpdated()}toggleProjectionMatrixHandInPlace(){const v=this._m;v[8]*=-1,v[9]*=-1,v[10]*=-1,v[11]*=-1,this._markAsUpdated()}_updateIdentityStatus(v,A=!1,S=!1,E=!0){this.updateFlag=Dt._updateFlagSeed++,this._isIdentity=v,this._isIdentity3x2=v||S,this._isIdentityDirty=!this._isIdentity&&A,this._isIdentity3x2Dirty=!this._isIdentity3x2&&E}}Ft.Matrix=Dt,Dt._updateFlagSeed=0,Dt._identityReadOnly=Dt.Identity(),Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.Quaternion=void 0;const Qt=Ft,Kt=zt,Zt=Ot,Jt=It,$t=kt;class jt{constructor(v=0,A=0,S=0,E=1){this.x=v,this.y=A,this.z=S,this.w=E}static FromRotationMatrix(v){const A=new jt;return jt.FromRotationMatrixToRef(v,A),A}static FromRotationMatrixToRef(v,A){const S=v.m,E=S[0],R=S[4],I=S[8],O=S[1],z=S[5],M=S[9],B=S[2],k=S[6],H=S[10],V=E+z+H;let W;V>0?(W=.5/Math.sqrt(V+1),A.w=.25/W,A.x=(k-M)*W,A.y=(I-B)*W,A.z=(O-R)*W):E>z&&E>H?(W=2*Math.sqrt(1+E-z-H),A.w=(k-M)/W,A.x=.25*W,A.y=(R+O)/W,A.z=(I+B)/W):z>H?(W=2*Math.sqrt(1+z-E-H),A.w=(I-B)/W,A.x=(R+O)/W,A.y=.25*W,A.z=(M+k)/W):(W=2*Math.sqrt(1+H-E-z),A.w=(O-R)/W,A.x=(I+B)/W,A.y=(M+k)/W,A.z=.25*W)}static Dot(v,A){return v.x*A.x+v.y*A.y+v.z*A.z+v.w*A.w}static AreClose(v,A){return jt.Dot(v,A)>=0}static Zero(){return new jt(0,0,0,0)}static Inverse(v){return new jt(-v.x,-v.y,-v.z,v.w)}static IsIdentity(v){return v&&0===v.x&&0===v.y&&0===v.z&&1===v.w}static RotationAxis(v,A){const S=A*Jt.DEG2RAD;return jt.RotationAxisToRef(v,S,new jt)}static RotationAxisToRef(v,A,S){const E=A*Jt.DEG2RAD,R=Math.sin(E/2);return v.normalize(),S.w=Math.cos(E/2),S.x=v.x*R,S.y=v.y*R,S.z=v.z*R,S}static FromArray(v,A=0){return new jt(v[A],v[A+1],v[A+2],v[A+3])}static FromEulerAnglesRef(v,A,S,E){return jt.RotationYawPitchRollToRef(A*Jt.DEG2RAD,v*Jt.DEG2RAD,S*Jt.DEG2RAD,E)}static RotationYawPitchRoll(v,A,S){const E=new jt;return jt.RotationYawPitchRollToRef(v,A,S,E),E}static RotationYawPitchRollToRef(v,A,S,E){const R=.5*A,I=.5*v,O=.5*S,z=Math.cos(R),M=Math.cos(I),B=Math.cos(O),k=Math.sin(R),H=Math.sin(I),V=Math.sin(O);E.x=M*k*B+H*z*V,E.y=H*z*B-M*k*V,E.z=M*z*V-H*k*B,E.w=M*z*B+H*k*V}static RotationAlphaBetaGamma(v,A,S){const E=new jt;return jt.RotationAlphaBetaGammaToRef(v,A,S,E),E}static RotationAlphaBetaGammaToRef(v,A,S,E){const R=.5*(S+v),I=.5*(S-v),O=.5*A;E.x=Math.cos(I)*Math.sin(O),E.y=Math.sin(I)*Math.sin(O),E.z=Math.sin(R)*Math.cos(O),E.w=Math.cos(R)*Math.cos(O)}static RotationQuaternionFromAxis(v,A,S){const E=new jt(0,0,0,0);return jt.RotationQuaternionFromAxisToRef(v,A,S,E),E}static RotationQuaternionFromAxisToRef(v,A,S,E){const R=Zt.MathTmp.Matrix[0];Qt.Matrix.FromXYZAxesToRef(v.normalize(),A.normalize(),S.normalize(),R),jt.FromRotationMatrixToRef(R,E)}static Slerp(v,A,S){const E=jt.Identity;return jt.SlerpToRef(v,A,S,E),E}static SlerpToRef(v,A,S,E){let R,I,O=v.x*A.x+v.y*A.y+v.z*A.z+v.w*A.w,z=!1;if(O<0&&(z=!0,O=-O),O>.999999)I=1-S,R=z?-S:S;else{const v=Math.acos(O),A=1/Math.sin(v);I=Math.sin((1-S)*v)*A,R=z?-Math.sin(S*v)*A:Math.sin(S*v)*A}E.x=I*v.x+R*A.x,E.y=I*v.y+R*A.y,E.z=I*v.z+R*A.z,E.w=I*v.w+R*A.w}static Hermite(v,A,S,E,R){const I=R*R,O=R*I,z=2*O-3*I+1,M=-2*O+3*I,B=O-2*I+R,k=O-I,H=v.x*z+S.x*M+A.x*B+E.x*k,V=v.y*z+S.y*M+A.y*B+E.y*k,W=v.z*z+S.z*M+A.z*B+E.z*k,X=v.w*z+S.w*M+A.w*B+E.w*k;return new jt(H,V,W,X)}static get Identity(){return new jt(0,0,0,1)}static Angle(v,A){const S=jt.Dot(v,A);return 2*Math.acos(Math.min(Math.abs(S),1))*Jt.RAD2DEG}static Euler(v,A,S){return jt.RotationYawPitchRoll(A*Jt.DEG2RAD,v*Jt.DEG2RAD,S*Jt.DEG2RAD)}static LookRotation(v,A=Zt.MathTmp.staticUp){const S=Kt.Vector3.Normalize(v),E=Kt.Vector3.Normalize(Kt.Vector3.Cross(A,S)),R=Kt.Vector3.Cross(S,E),I=E.x,O=E.y,z=E.z,M=R.x,B=R.y,k=R.z,H=S.x,V=S.y,W=S.z,X=I+B+W,Q=new jt;if(X>0){let v=Math.sqrt(X+1);return Q.w=.5*v,v=.5/v,Q.x=(k-V)*v,Q.y=(H-z)*v,Q.z=(O-M)*v,Q}if(I>=B&&I>=W){const v=Math.sqrt(1+I-B-W),A=.5/v;return Q.x=.5*v,Q.y=(O+M)*A,Q.z=(z+H)*A,Q.w=(k-V)*A,Q}if(B>W){const v=Math.sqrt(1+B-I-W),A=.5/v;return Q.x=(M+O)*A,Q.y=.5*v,Q.z=(V+k)*A,Q.w=(H-z)*A,Q}const K=Math.sqrt(1+W-I-B),Z=.5/K;return Q.x=(H+z)*Z,Q.y=(V+k)*Z,Q.z=.5*K,Q.w=(O-M)*Z,Q}static RotateTowards(v,A,S){const E=jt.Angle(v,A);if(0===E)return A;const R=Math.min(1,S/E);return jt.Slerp(v,A,R)}static FromToRotation(v,A,S=Zt.MathTmp.staticUp){const E=v.normalize(),R=A.normalize(),I=Kt.Vector3.Cross(E,R),O=Math.sqrt(E.lengthSquared()*R.lengthSquared())+Kt.Vector3.Dot(E,R);return I.lengthSquared()<1e-4?Math.abs(O)<1e-4?new jt(S.x,S.y,S.z,0).normalized:jt.Identity:new jt(I.x,I.y,I.z,O).normalized}get normalized(){return this.normalize()}setFromToRotation(v,A,S=Zt.MathTmp.staticUp){const E=jt.FromToRotation(v,A,S);this.x=E.x,this.y=E.y,this.z=E.z,this.w=E.w}set eulerAngles(v){this.setEuler(v.x,v.y,v.z)}get eulerAngles(){const v=new Kt.Vector3,A=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w,S=this.x*this.w-this.y*this.z;return S>.4995*A?(v.x=Math.PI/2,v.y=2*Math.atan2(this.y,this.x),v.z=0):S<-.4995*A?(v.x=-Math.PI/2,v.y=-2*Math.atan2(this.y,this.x),v.z=0):(v.x=Math.asin(2*(this.w*this.x-this.y*this.z)),v.y=Math.atan2(2*this.w*this.y+2*this.z*this.x,1-2*(this.x*this.x+this.y*this.y)),v.z=Math.atan2(2*this.w*this.z+2*this.x*this.y,1-2*(this.z*this.z+this.x*this.x))),v.x*=Jt.RAD2DEG,v.y*=Jt.RAD2DEG,v.z*=Jt.RAD2DEG,v.x=$t.Scalar.Repeat(v.x,360),v.y=$t.Scalar.Repeat(v.y,360),v.z=$t.Scalar.Repeat(v.z,360),v}toString(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`}get length(){return Math.sqrt(this.lengthSquared)}get lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}getClassName(){return"Quaternion"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v=397*v^(this.w||0),v}asArray(){return[this.x,this.y,this.z,this.w]}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z&&this.w===v.w}clone(){return new jt(this.x,this.y,this.z,this.w)}copyFrom(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}copyFromFloats(v,A,S,E){return this.x=v,this.y=A,this.z=S,this.w=E,this}set(v,A,S,E){return this.copyFromFloats(v,A,S,E)}setEuler(v,A,S){return jt.RotationYawPitchRollToRef(A*Jt.DEG2RAD,v*Jt.DEG2RAD,S*Jt.DEG2RAD,this),this}add(v){return new jt(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w)}addInPlace(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this}subtract(v){return new jt(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w)}scale(v){return new jt(this.x*v,this.y*v,this.z*v,this.w*v)}scaleToRef(v,A){return A.x=this.x*v,A.y=this.y*v,A.z=this.z*v,A.w=this.w*v,this}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}scaleAndAddToRef(v,A){return A.x+=this.x*v,A.y+=this.y*v,A.z+=this.z*v,A.w+=this.w*v,this}multiply(v){const A=new jt(0,0,0,1);return this.multiplyToRef(v,A),A}multiplyToRef(v,A){const S=this.x*v.w+this.y*v.z-this.z*v.y+this.w*v.x,E=-this.x*v.z+this.y*v.w+this.z*v.x+this.w*v.y,R=this.x*v.y-this.y*v.x+this.z*v.w+this.w*v.z,I=-this.x*v.x-this.y*v.y-this.z*v.z+this.w*v.w;return A.copyFromFloats(S,E,R,I),this}multiplyInPlace(v){return this.multiplyToRef(v,this),this}conjugateToRef(v){return v.copyFromFloats(-this.x,-this.y,-this.z,this.w),this}conjugateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this}conjugate(){return new jt(-this.x,-this.y,-this.z,this.w)}normalize(){const v=1/this.length;return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}angleAxis(v,A){if(0===A.lengthSquared())return jt.Identity;const S=jt.Identity;let E=v*Jt.DEG2RAD;E*=.5;let R=A.normalize();return R=A.scaleInPlace(Math.sin(E)),S.x=R.x,S.y=R.y,S.z=R.z,S.w=Math.cos(E),S.normalize()}toRotationMatrix(v){return Qt.Matrix.FromQuaternionToRef(this,v),this}fromRotationMatrix(v){return jt.FromRotationMatrixToRef(v,this),this}}Lt.Quaternion=jt,Object.defineProperty(zt,"__esModule",{value:!0}),zt.Vector3=void 0;const ee=Ot,ne=It,ie=Lt,oe=kt;class Xt{constructor(v=0,A=0,S=0){this.x=v,this.y=A,this.z=S}get isNonUniform(){const v=Math.abs(this.x),A=Math.abs(this.y);if(v!==A)return!0;const S=Math.abs(this.z);return v!==S||A!==S}static Add(v,A){return new Xt(v.x,v.y,v.z).addInPlace(A)}static GetClipFactor(v,A,S,E){const R=Xt.Dot(v,S)-E;return R/(R-(Xt.Dot(A,S)-E))}static GetAngleBetweenVectors(v,A,S){const E=v.normalizeToRef(ee.MathTmp.Vector3[1]),R=A.normalizeToRef(ee.MathTmp.Vector3[2]),I=Xt.Dot(E,R),O=ee.MathTmp.Vector3[3];return Xt.CrossToRef(E,R,O),Xt.Dot(O,S)>0?Math.acos(I):-Math.acos(I)}static FromArray(v,A=0){return new Xt(v[A],v[A+1],v[A+2])}static FromFloatArray(v,A){return Xt.FromArray(v,A)}static FromArrayToRef(v,A,S){S.x=v[A],S.y=v[A+1],S.z=v[A+2]}static FromFloatArrayToRef(v,A,S){return Xt.FromArrayToRef(v,A,S)}static FromFloatsToRef(v,A,S,E){E.copyFromFloats(v,A,S)}static Zero(){return new Xt(0,0,0)}static One(){return new Xt(1,1,1)}static Up(){return new Xt(0,1,0)}static Down(){return new Xt(0,-1,0)}static Forward(){return new Xt(0,0,1)}static Backward(){return new Xt(0,0,-1)}static Right(){return new Xt(1,0,0)}static Left(){return new Xt(-1,0,0)}static TransformCoordinates(v,A){const S=Xt.Zero();return Xt.TransformCoordinatesToRef(v,A,S),S}static TransformCoordinatesToRef(v,A,S){return Xt.TransformCoordinatesFromFloatsToRef(v.x,v.y,v.z,A,S)}static TransformCoordinatesFromFloatsToRef(v,A,S,E,R){const I=E.m,O=v*I[0]+A*I[4]+S*I[8]+I[12],z=v*I[1]+A*I[5]+S*I[9]+I[13],M=v*I[2]+A*I[6]+S*I[10]+I[14],B=1/(v*I[3]+A*I[7]+S*I[11]+I[15]);R.x=O*B,R.y=z*B,R.z=M*B}static TransformNormal(v,A){const S=Xt.Zero();return Xt.TransformNormalToRef(v,A,S),S}static TransformNormalToRef(v,A,S){this.TransformNormalFromFloatsToRef(v.x,v.y,v.z,A,S)}static TransformNormalFromFloatsToRef(v,A,S,E,R){const I=E.m;R.x=v*I[0]+A*I[4]+S*I[8],R.y=v*I[1]+A*I[5]+S*I[9],R.z=v*I[2]+A*I[6]+S*I[10]}static CatmullRom(v,A,S,E,R){const I=R*R,O=R*I,z=.5*(2*A.x+(-v.x+S.x)*R+(2*v.x-5*A.x+4*S.x-E.x)*I+(-v.x+3*A.x-3*S.x+E.x)*O),M=.5*(2*A.y+(-v.y+S.y)*R+(2*v.y-5*A.y+4*S.y-E.y)*I+(-v.y+3*A.y-3*S.y+E.y)*O),B=.5*(2*A.z+(-v.z+S.z)*R+(2*v.z-5*A.z+4*S.z-E.z)*I+(-v.z+3*A.z-3*S.z+E.z)*O);return new Xt(z,M,B)}static Clamp(v,A,S){const E=new Xt;return Xt.ClampToRef(v,A,S,E),E}static ClampToRef(v,A,S,E){let R=v.x;R=R>S.x?S.x:R,R=R<A.x?A.x:R;let I=v.y;I=I>S.y?S.y:I,I=I<A.y?A.y:I;let O=v.z;O=O>S.z?S.z:O,O=O<A.z?A.z:O,E.copyFromFloats(R,I,O)}static Hermite(v,A,S,E,R){const I=R*R,O=R*I,z=2*O-3*I+1,M=-2*O+3*I,B=O-2*I+R,k=O-I,H=v.x*z+S.x*M+A.x*B+E.x*k,V=v.y*z+S.y*M+A.y*B+E.y*k,W=v.z*z+S.z*M+A.z*B+E.z*k;return new Xt(H,V,W)}static Lerp(v,A,S){const E=new Xt(0,0,0);return Xt.LerpToRef(v,A,S,E),E}static LerpToRef(v,A,S,E){E.x=v.x+(A.x-v.x)*S,E.y=v.y+(A.y-v.y)*S,E.z=v.z+(A.z-v.z)*S}static Dot(v,A){return v.x*A.x+v.y*A.y+v.z*A.z}static Cross(v,A){const S=Xt.Zero();return Xt.CrossToRef(v,A,S),S}static CrossToRef(v,A,S){const E=v.y*A.z-v.z*A.y,R=v.z*A.x-v.x*A.z,I=v.x*A.y-v.y*A.x;S.copyFromFloats(E,R,I)}static Normalize(v){const A=Xt.Zero();return Xt.NormalizeToRef(v,A),A}static NormalizeToRef(v,A){v.normalizeToRef(A)}static Minimize(v,A){const S=new Xt(v.x,v.y,v.z);return S.minimizeInPlace(A),S}static Maximize(v,A){const S=new Xt(v.x,v.y,v.z);return S.maximizeInPlace(A),S}static Distance(v,A){return Math.sqrt(Xt.DistanceSquared(v,A))}static DistanceSquared(v,A){const S=v.x-A.x,E=v.y-A.y,R=v.z-A.z;return S*S+E*E+R*R}static Center(v,A){const S=Xt.Add(v,A);return S.scaleInPlace(.5),S}static RotationFromAxis(v,A,S){const E=Xt.Zero();return Xt.RotationFromAxisToRef(v,A,S,E),E}static RotationFromAxisToRef(v,A,S,E){const R=ee.MathTmp.Quaternion[0];ie.Quaternion.RotationQuaternionFromAxisToRef(v,A,S,R),E.copyFrom(R.eulerAngles)}toString(){return`(${this.x}, ${this.y}, ${this.z})`}getClassName(){return"Vector3"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v}asArray(){const v=[];return this.toArray(v,0),v}toArray(v,A=0){return v[A]=this.x,v[A+1]=this.y,v[A+2]=this.z,this}toQuaternion(){return ie.Quaternion.Identity.setEuler(this.y,this.x,this.z)}addInPlace(v){return this.addInPlaceFromFloats(v.x,v.y,v.z)}addInPlaceFromFloats(v,A,S){return this.x+=v,this.y+=A,this.z+=S,this}add(v){return new Xt(this.x+v.x,this.y+v.y,this.z+v.z)}addToRef(v,A){return A.copyFromFloats(this.x+v.x,this.y+v.y,this.z+v.z)}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this}subtract(v){return new Xt(this.x-v.x,this.y-v.y,this.z-v.z)}subtractToRef(v,A){return this.subtractFromFloatsToRef(v.x,v.y,v.z,A)}subtractFromFloats(v,A,S){return new Xt(this.x-v,this.y-A,this.z-S)}subtractFromFloatsToRef(v,A,S,E){return E.copyFromFloats(this.x-v,this.y-A,this.z-S)}applyMatrix4(v){this.applyMatrix4ToRef(v,this)}applyMatrix4ToRef(v,A){const{x:S,y:E,z:R}=this,{m:I}=v,O=1/(I[3]*S+I[7]*E+I[11]*R+I[15]);return A.x=(I[0]*S+I[4]*E+I[8]*R+I[12])*O,A.y=(I[1]*S+I[5]*E+I[9]*R+I[13])*O,A.z=(I[2]*S+I[6]*E+I[10]*R+I[14])*O,A}rotate(v){return this.rotateToRef(v,this)}rotateToRef(v,A){const{x:S,y:E,z:R}=this,{x:I,y:O,z:z,w:M}=v,B=M*S+O*R-z*E,k=M*E+z*S-I*R,H=M*R+I*E-O*S,V=-I*S-O*E-z*R;return A.x=B*M+V*-I+k*-z-H*-O,A.y=k*M+V*-O+H*-I-B*-z,A.z=H*M+V*-z+B*-O-k*-I,A}negate(){return new Xt(-this.x,-this.y,-this.z)}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this}scale(v){return new Xt(this.x*v,this.y*v,this.z*v)}scaleToRef(v,A){return A.copyFromFloats(this.x*v,this.y*v,this.z*v)}scaleAndAddToRef(v,A){return A.addInPlaceFromFloats(this.x*v,this.y*v,this.z*v)}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z}equalsWithEpsilon(v,A=ne.Epsilon){return v&&oe.Scalar.WithinEpsilon(this.x,v.x,A)&&oe.Scalar.WithinEpsilon(this.y,v.y,A)&&oe.Scalar.WithinEpsilon(this.z,v.z,A)}equalsToFloats(v,A,S){return this.x===v&&this.y===A&&this.z===S}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this}multiply(v){return this.multiplyByFloats(v.x,v.y,v.z)}multiplyToRef(v,A){return A.copyFromFloats(this.x*v.x,this.y*v.y,this.z*v.z)}multiplyByFloats(v,A,S){return new Xt(this.x*v,this.y*A,this.z*S)}divide(v){return new Xt(this.x/v.x,this.y/v.y,this.z/v.z)}divideToRef(v,A){return A.copyFromFloats(this.x/v.x,this.y/v.y,this.z/v.z)}divideInPlace(v){return this.divideToRef(v,this)}minimizeInPlace(v){return this.minimizeInPlaceFromFloats(v.x,v.y,v.z)}maximizeInPlace(v){return this.maximizeInPlaceFromFloats(v.x,v.y,v.z)}minimizeInPlaceFromFloats(v,A,S){return v<this.x&&(this.x=v),A<this.y&&(this.y=A),S<this.z&&(this.z=S),this}maximizeInPlaceFromFloats(v,A,S){return v>this.x&&(this.x=v),A>this.y&&(this.y=A),S>this.z&&(this.z=S),this}floor(){return new Xt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fract(){return new Xt(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(v){return 0===v||1===v?this:this.scaleInPlace(1/v)}normalizeToNew(){const v=new Xt(0,0,0);return this.normalizeToRef(v),v}normalizeToRef(v){const A=this.length();return 0===A||1===A?v.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/A,v)}clone(){return new Xt(this.x,this.y,this.z)}copyFrom(v){return this.copyFromFloats(v.x,v.y,v.z)}copyFromFloats(v,A,S){return this.x=v,this.y=A,this.z=S,this}set(v,A,S){return this.copyFromFloats(v,A,S)}setAll(v){return this.x=this.y=this.z=v,this}}zt.Vector3=Xt,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.MathTmp=void 0;const se=Nt,ae=zt,le=Lt,he=Ft;Ot.MathTmp={Vector3:(0,se.buildArray)(6,ae.Vector3.Zero),Matrix:(0,se.buildArray)(2,he.Matrix.Identity),Quaternion:(0,se.buildArray)(3,le.Quaternion.Zero),staticUp:ae.Vector3.Up(),tmpMatrix:he.Matrix.Zero()};var ce={};Object.defineProperty(ce,"__esModule",{value:!0}),ce.Angle=void 0;class te{constructor(v){this._radians=v,this._radians<0&&(this._radians+=2*Math.PI)}static BetweenTwoPoints(v,A){const S=A.subtract(v),E=Math.atan2(S.y,S.x);return new te(E)}static FromRadians(v){return new te(v)}static FromDegrees(v){return new te(v*Math.PI/180)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}}ce.Angle=te;var ue={},de={};Object.defineProperty(de,"__esModule",{value:!0}),de.Vector2=void 0;const ye=It,fe=kt;class re{constructor(v=0,A=0){this.x=v,this.y=A}static Zero(){return new re(0,0)}static One(){return new re(1,1)}static Add(v,A){return new re(v.x,v.y).addInPlace(A)}static FromArray(v,A=0){return new re(v[A],v[A+1])}static FromArrayToRef(v,A,S){S.x=v[A],S.y=v[A+1]}static CatmullRom(v,A,S,E,R){const I=R*R,O=R*I,z=.5*(2*A.x+(-v.x+S.x)*R+(2*v.x-5*A.x+4*S.x-E.x)*I+(-v.x+3*A.x-3*S.x+E.x)*O),M=.5*(2*A.y+(-v.y+S.y)*R+(2*v.y-5*A.y+4*S.y-E.y)*I+(-v.y+3*A.y-3*S.y+E.y)*O);return new re(z,M)}static Clamp(v,A,S){let E=v.x;E=E>S.x?S.x:E,E=E<A.x?A.x:E;let R=v.y;return R=R>S.y?S.y:R,R=R<A.y?A.y:R,new re(E,R)}static Hermite(v,A,S,E,R){const I=R*R,O=R*I,z=2*O-3*I+1,M=-2*O+3*I,B=O-2*I+R,k=O-I,H=v.x*z+S.x*M+A.x*B+E.x*k,V=v.y*z+S.y*M+A.y*B+E.y*k;return new re(H,V)}static Lerp(v,A,S){const E=v.x+(A.x-v.x)*S,R=v.y+(A.y-v.y)*S;return new re(E,R)}static Dot(v,A){return v.x*A.x+v.y*A.y}static Normalize(v){const A=new re(v.x,v.y);return A.normalize(),A}static Minimize(v,A){const S=v.x<A.x?v.x:A.x,E=v.y<A.y?v.y:A.y;return new re(S,E)}static Maximize(v,A){const S=v.x>A.x?v.x:A.x,E=v.y>A.y?v.y:A.y;return new re(S,E)}static Transform(v,A){const S=re.Zero();return re.TransformToRef(v,A,S),S}static TransformToRef(v,A,S){const E=A.m,R=v.x*E[0]+v.y*E[4]+E[12],I=v.x*E[1]+v.y*E[5]+E[13];S.x=R,S.y=I}static PointInTriangle(v,A,S,E){const R=.5*(-S.y*E.x+A.y*(-S.x+E.x)+A.x*(S.y-E.y)+S.x*E.y),I=R<0?-1:1,O=(A.y*E.x-A.x*E.y+(E.y-A.y)*v.x+(A.x-E.x)*v.y)*I,z=(A.x*S.y-A.y*S.x+(A.y-S.y)*v.x+(S.x-A.x)*v.y)*I;return O>0&&z>0&&O+z<2*R*I}static Distance(v,A){return Math.sqrt(re.DistanceSquared(v,A))}static DistanceSquared(v,A){const S=v.x-A.x,E=v.y-A.y;return S*S+E*E}static Center(v,A){const S=re.Add(v,A);return S.scaleInPlace(.5),S}static DistanceOfPointFromSegment(v,A,S){const E=re.DistanceSquared(A,S);if(0===E)return re.Distance(v,A);const R=S.subtract(A),I=Math.max(0,Math.min(1,re.Dot(v.subtract(A),R)/E)),O=A.add(R.multiplyByFloats(I,I));return re.Distance(v,O)}toString(){return"{X: "+this.x+" Y:"+this.y+"}"}getClassName(){return"Vector2"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v}toArray(v,A=0){return v[A]=this.x,v[A+1]=this.y,this}asArray(){const v=new Array;return this.toArray(v,0),v}copyFrom(v){return this.x=v.x,this.y=v.y,this}copyFromFloats(v,A){return this.x=v,this.y=A,this}set(v,A){return this.copyFromFloats(v,A)}add(v){return new re(this.x+v.x,this.y+v.y)}addToRef(v,A){return A.x=this.x+v.x,A.y=this.y+v.y,this}addInPlace(v){return this.x+=v.x,this.y+=v.y,this}addVector3(v){return new re(this.x+v.x,this.y+v.y)}subtract(v){return new re(this.x-v.x,this.y-v.y)}subtractToRef(v,A){return A.x=this.x-v.x,A.y=this.y-v.y,this}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this}multiply(v){return new re(this.x*v.x,this.y*v.y)}multiplyToRef(v,A){return A.x=this.x*v.x,A.y=this.y*v.y,this}multiplyByFloats(v,A){return new re(this.x*v,this.y*A)}divide(v){return new re(this.x/v.x,this.y/v.y)}divideToRef(v,A){return A.x=this.x/v.x,A.y=this.y/v.y,this}divideInPlace(v){return this.divideToRef(v,this)}negate(){return new re(-this.x,-this.y)}scaleInPlace(v){return this.x*=v,this.y*=v,this}scale(v){const A=new re(0,0);return this.scaleToRef(v,A),A}scaleToRef(v,A){return A.x=this.x*v,A.y=this.y*v,this}scaleAndAddToRef(v,A){return A.x+=this.x*v,A.y+=this.y*v,this}equals(v){return v&&this.x===v.x&&this.y===v.y}equalsWithEpsilon(v,A=ye.Epsilon){return v&&fe.Scalar.WithinEpsilon(this.x,v.x,A)&&fe.Scalar.WithinEpsilon(this.y,v.y,A)}floor(){return new re(Math.floor(this.x),Math.floor(this.y))}fract(){return new re(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){const v=this.length();if(0===v)return this;const A=1/v;return this.x*=A,this.y*=A,this}clone(){return new re(this.x,this.y)}}de.Vector2=re,Object.defineProperty(ue,"__esModule",{value:!0}),ue.Arc2=void 0;const me=ce,ve=de,be=It;ue.Arc2=class{constructor(v,A,S){this.startPoint=v,this.midPoint=A,this.endPoint=S;const E=Math.pow(A.x,2)+Math.pow(A.y,2),R=(Math.pow(v.x,2)+Math.pow(v.y,2)-E)/2,I=(E-Math.pow(S.x,2)-Math.pow(S.y,2))/2,O=(v.x-A.x)*(A.y-S.y)-(A.x-S.x)*(v.y-A.y);this.centerPoint=new ve.Vector2((R*(A.y-S.y)-I*(v.y-A.y))/O,((v.x-A.x)*I-(A.x-S.x)*R)/O),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=me.Angle.BetweenTwoPoints(this.centerPoint,this.startPoint);const z=this.startAngle.degrees();let M=me.Angle.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),B=me.Angle.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();M-z>180&&(M-=360),M-z<-180&&(M+=360),B-M>180&&(B-=360),B-M<-180&&(B+=360),this.orientation=M-z<0?be.Orientation.CW:be.Orientation.CCW,this.angle=me.Angle.FromDegrees(this.orientation===be.Orientation.CW?z-B:B-z)}};var we={};Object.defineProperty(we,"__esModule",{value:!0}),we.Axis=void 0;const Te=zt;class pe{}we.Axis=pe,pe.X=new Te.Vector3(1,0,0),pe.Y=new Te.Vector3(0,1,0),pe.Z=new Te.Vector3(0,0,1);var Ce={};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.BezierCurve=void 0,Ce.BezierCurve=class{static Interpolate(v,A,S,E,R){const I=1-3*E+3*A,O=3*E-6*A,z=3*A;let M=v;for(let A=0;A<5;A++){const A=M*M;M-=1/(3*I*A+2*O*M+z)*(I*(A*M)+O*A+z*M-v),M=Math.min(1,Math.max(0,M))}return 3*Math.pow(1-M,2)*M*S+3*(1-M)*Math.pow(M,2)*R+Math.pow(M,3)}};var _e={},Se={};Object.defineProperty(Se,"__esModule",{value:!0}),Se.Color4=void 0;const Ee=kt,Re=It;class ge{constructor(v=0,A=0,S=0,E=1){this.r=v,this.g=A,this.b=S,this.a=E}static FromHexString(v){if("#"!==v.substring(0,1)||9!==v.length)return new ge(0,0,0,0);const A=parseInt(v.substring(1,3),16),S=parseInt(v.substring(3,5),16),E=parseInt(v.substring(5,7),16),R=parseInt(v.substring(7,9),16);return ge.FromInts(A,S,E,R)}static Lerp(v,A,S){const E=new ge(0,0,0,0);return ge.LerpToRef(v,A,S,E),E}static LerpToRef(v,A,S,E){E.r=v.r+(A.r-v.r)*S,E.g=v.g+(A.g-v.g)*S,E.b=v.b+(A.b-v.b)*S,E.a=v.a+(A.a-v.a)*S}static Red(){return new ge(1,0,0,1)}static Green(){return new ge(0,1,0,1)}static Blue(){return new ge(0,0,1,1)}static Black(){return new ge(0,0,0,1)}static White(){return new ge(1,1,1,1)}static Purple(){return new ge(.5,0,.5,1)}static Magenta(){return new ge(1,0,1,1)}static Yellow(){return new ge(1,1,0,1)}static Gray(){return new ge(.5,.5,.5,1)}static Teal(){return new ge(0,1,1,1)}static Clear(){return new ge(0,0,0,0)}static FromColor3(v,A=1){return new ge(v.r,v.g,v.b,A)}static FromArray(v,A=0){return new ge(v[A],v[A+1],v[A+2],v[A+3])}static FromInts(v,A,S,E){return new ge(v/255,A/255,S/255,E/255)}static CheckColors4(v,A){if(v.length===3*A){const A=[];for(let S=0;S<v.length;S+=3){const E=S/3*4;A[E]=v[S],A[E+1]=v[S+1],A[E+2]=v[S+2],A[E+3]=1}return A}return v}addInPlace(v){return this.r+=v.r,this.g+=v.g,this.b+=v.b,this.a+=v.a,this}asArray(){const v=new Array;return this.toArray(v,0),v}toArray(v,A=0){return v[A]=this.r,v[A+1]=this.g,v[A+2]=this.b,v[A+3]=this.a,this}add(v){return new ge(this.r+v.r,this.g+v.g,this.b+v.b,this.a+v.a)}subtract(v){return new ge(this.r-v.r,this.g-v.g,this.b-v.b,this.a-v.a)}subtractToRef(v,A){return A.r=this.r-v.r,A.g=this.g-v.g,A.b=this.b-v.b,A.a=this.a-v.a,this}scale(v){return new ge(this.r*v,this.g*v,this.b*v,this.a*v)}scaleToRef(v,A){return A.r=this.r*v,A.g=this.g*v,A.b=this.b*v,A.a=this.a*v,this}scaleAndAddToRef(v,A){return A.r+=this.r*v,A.g+=this.g*v,A.b+=this.b*v,A.a+=this.a*v,this}clampToRef(v=0,A=1,S){return S.r=Ee.Scalar.Clamp(this.r,v,A),S.g=Ee.Scalar.Clamp(this.g,v,A),S.b=Ee.Scalar.Clamp(this.b,v,A),S.a=Ee.Scalar.Clamp(this.a,v,A),this}multiply(v){return new ge(this.r*v.r,this.g*v.g,this.b*v.b,this.a*v.a)}multiplyToRef(v,A){return A.r=this.r*v.r,A.g=this.g*v.g,A.b=this.b*v.b,A.a=this.a*v.a,A}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let v=this.r||0;return v=397*v^(this.g||0),v=397*v^(this.b||0),v=397*v^(this.a||0),v}clone(){return new ge(this.r,this.g,this.b,this.a)}copyFrom(v){return this.r=v.r,this.g=v.g,this.b=v.b,this.a=v.a,this}copyFromFloats(v,A,S,E){return this.r=v,this.g=A,this.b=S,this.a=E,this}set(v,A,S,E){return this.copyFromFloats(v,A,S,E)}toHexString(){const v=255*this.r|0,A=255*this.g|0,S=255*this.b|0,E=255*this.a|0;return"#"+Ee.Scalar.ToHex(v)+Ee.Scalar.ToHex(A)+Ee.Scalar.ToHex(S)+Ee.Scalar.ToHex(E)}toLinearSpace(){const v=new ge;return this.toLinearSpaceToRef(v),v}toLinearSpaceToRef(v){return v.r=Math.pow(this.r,Re.ToLinearSpace),v.g=Math.pow(this.g,Re.ToLinearSpace),v.b=Math.pow(this.b,Re.ToLinearSpace),v.a=this.a,this}toGammaSpace(){const v=new ge;return this.toGammaSpaceToRef(v),v}toGammaSpaceToRef(v){return v.r=Math.pow(this.r,Re.ToGammaSpace),v.g=Math.pow(this.g,Re.ToGammaSpace),v.b=Math.pow(this.b,Re.ToGammaSpace),v.a=this.a,this}}Se.Color4=ge,Object.defineProperty(_e,"__esModule",{value:!0}),_e.Color3=void 0;const Pe=It,Ie=Se,Oe=kt;class xe{constructor(v=0,A=0,S=0){this.r=v,this.g=A,this.b=S}static FromHexString(v){if("#"!==v.substring(0,1)||7!==v.length)return new xe(0,0,0);const A=parseInt(v.substring(1,3),16),S=parseInt(v.substring(3,5),16),E=parseInt(v.substring(5,7),16);return xe.FromInts(A,S,E)}static FromArray(v,A=0){return new xe(v[A],v[A+1],v[A+2])}static FromInts(v,A,S){return new xe(v/255,A/255,S/255)}static Lerp(v,A,S){const E=new xe(0,0,0);return xe.LerpToRef(v,A,S,E),E}static LerpToRef(v,A,S,E){E.r=v.r+(A.r-v.r)*S,E.g=v.g+(A.g-v.g)*S,E.b=v.b+(A.b-v.b)*S}static Red(){return new xe(1,0,0)}static Green(){return new xe(0,1,0)}static Blue(){return new xe(0,0,1)}static Black(){return new xe(0,0,0)}static White(){return new xe(1,1,1)}static Purple(){return new xe(.5,0,.5)}static Magenta(){return new xe(1,0,1)}static Yellow(){return new xe(1,1,0)}static Gray(){return new xe(.5,.5,.5)}static Teal(){return new xe(0,1,1)}static Random(){return new xe(Math.random(),Math.random(),Math.random())}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let v=this.r||0;return v=397*v^(this.g||0),v=397*v^(this.b||0),v}toArray(v,A=0){return v[A]=this.r,v[A+1]=this.g,v[A+2]=this.b,this}toColor4(v=1){return new Ie.Color4(this.r,this.g,this.b,v)}asArray(){const v=new Array;return this.toArray(v,0),v}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(v){return new xe(this.r*v.r,this.g*v.g,this.b*v.b)}multiplyToRef(v,A){return A.r=this.r*v.r,A.g=this.g*v.g,A.b=this.b*v.b,this}equals(v){return v&&this.r===v.r&&this.g===v.g&&this.b===v.b}equalsFloats(v,A,S){return this.r===v&&this.g===A&&this.b===S}scale(v){return new xe(this.r*v,this.g*v,this.b*v)}scaleToRef(v,A){return A.r=this.r*v,A.g=this.g*v,A.b=this.b*v,this}scaleAndAddToRef(v,A){return A.r+=this.r*v,A.g+=this.g*v,A.b+=this.b*v,this}clampToRef(v=0,A=1,S){return S.r=Oe.Scalar.Clamp(this.r,v,A),S.g=Oe.Scalar.Clamp(this.g,v,A),S.b=Oe.Scalar.Clamp(this.b,v,A),this}add(v){return new xe(this.r+v.r,this.g+v.g,this.b+v.b)}addToRef(v,A){return A.r=this.r+v.r,A.g=this.g+v.g,A.b=this.b+v.b,this}subtract(v){return new xe(this.r-v.r,this.g-v.g,this.b-v.b)}subtractToRef(v,A){return A.r=this.r-v.r,A.g=this.g-v.g,A.b=this.b-v.b,this}clone(){return new xe(this.r,this.g,this.b)}copyFrom(v){return this.r=v.r,this.g=v.g,this.b=v.b,this}copyFromFloats(v,A,S){return this.r=v,this.g=A,this.b=S,this}set(v,A,S){return this.copyFromFloats(v,A,S)}toHexString(){const v=255*this.r|0,A=255*this.g|0,S=255*this.b|0;return"#"+Oe.Scalar.ToHex(v)+Oe.Scalar.ToHex(A)+Oe.Scalar.ToHex(S)}toLinearSpace(){const v=new xe;return this.toLinearSpaceToRef(v),v}toLinearSpaceToRef(v){return v.r=Math.pow(this.r,Pe.ToLinearSpace),v.g=Math.pow(this.g,Pe.ToLinearSpace),v.b=Math.pow(this.b,Pe.ToLinearSpace),this}toGammaSpace(){const v=new xe;return this.toGammaSpaceToRef(v),v}toGammaSpaceToRef(v){return v.r=Math.pow(this.r,Pe.ToGammaSpace),v.g=Math.pow(this.g,Pe.ToGammaSpace),v.b=Math.pow(this.b,Pe.ToGammaSpace),this}toJSON(){return{r:this.r,g:this.g,b:this.b}}}_e.Color3=xe;var Ne={};Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.Curve3=void 0;const Le=zt;class Ae{constructor(v){this._length=0,this._points=v,this._length=this._computeLength(v)}static CreateQuadraticBezier(v,A,S,E){E=E>2?E:3;const R=new Array,r=(v,A,S,E)=>(1-v)*(1-v)*A+2*v*(1-v)*S+v*v*E;for(let I=0;I<=E;I++)R.push(new Le.Vector3(r(I/E,v.x,A.x,S.x),r(I/E,v.y,A.y,S.y),r(I/E,v.z,A.z,S.z)));return new Ae(R)}static CreateCubicBezier(v,A,S,E,R){R=R>3?R:4;const I=new Array,s=(v,A,S,E,R)=>(1-v)*(1-v)*(1-v)*A+3*v*(1-v)*(1-v)*S+3*v*v*(1-v)*E+v*v*v*R;for(let O=0;O<=R;O++)I.push(new Le.Vector3(s(O/R,v.x,A.x,S.x,E.x),s(O/R,v.y,A.y,S.y,E.y),s(O/R,v.z,A.z,S.z,E.z)));return new Ae(I)}static CreateHermiteSpline(v,A,S,E,R){const I=new Array,O=1/R;for(let z=0;z<=R;z++)I.push(Le.Vector3.Hermite(v,A,S,E,z*O));return new Ae(I)}static CreateCatmullRomSpline(v,A,S){const E=new Array,R=1/A;let I=0;if(S){const S=v.length;for(let O=0;O<S;O++){I=0;for(let z=0;z<A;z++)E.push(Le.Vector3.CatmullRom(v[O%S],v[(O+1)%S],v[(O+2)%S],v[(O+3)%S],I)),I+=R}E.push(E[0])}else{const S=new Array;S.push(v[0].clone()),Array.prototype.push.apply(S,v),S.push(v[v.length-1].clone());let O=0;for(O=0;O<S.length-3;O++){I=0;for(let v=0;v<A;v++)E.push(Le.Vector3.CatmullRom(S[O],S[O+1],S[O+2],S[O+3],I)),I+=R}O--,E.push(Le.Vector3.CatmullRom(S[O],S[O+1],S[O+2],S[O+3],I))}return new Ae(E)}getPoints(){return this._points}length(){return this._length}continue(v){const A=this._points[this._points.length-1],S=this._points.slice(),E=v.getPoints();for(let v=1;v<E.length;v++)S.push(E[v].subtract(E[0]).add(A));return new Ae(S)}_computeLength(v){let A=0;for(let S=1;S<v.length;S++)A+=v[S].subtract(v[S-1]).length();return A}}Ne.Curve3=Ae;var Fe={},Be={};Object.defineProperty(Be,"__esModule",{value:!0}),Be.Plane=void 0;const ke=zt,He=Ft,Ue=Ot;class ze{constructor(v,A,S,E){this.normal=new ke.Vector3(v,A,S),this.d=E}static FromArray(v){return new ze(v[0],v[1],v[2],v[3])}static FromPoints(v,A,S){const E=new ze(0,0,0,0);return E.copyFromPoints(v,A,S),E}static FromPositionAndNormal(v,A){const S=new ze(0,0,0,0);return A.normalize(),S.normal=A,S.d=-(A.x*v.x+A.y*v.y+A.z*v.z),S}static SignedDistanceToPlaneFromPositionAndNormal(v,A,S){const E=-(A.x*v.x+A.y*v.y+A.z*v.z);return ke.Vector3.Dot(S,A)+E}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new ze(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let v=this.normal.getHashCode();return v=397*v^(this.d||0),v}normalize(){const v=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let A=0;return 0!==v&&(A=1/v),this.normal.x*=A,this.normal.y*=A,this.normal.z*=A,this.d*=A,this}transform(v){const A=Ue.MathTmp.Matrix[0];He.Matrix.TransposeToRef(v,A);const S=A.m,E=this.normal.x,R=this.normal.y,I=this.normal.z,O=this.d,z=E*S[0]+R*S[1]+I*S[2]+O*S[3],M=E*S[4]+R*S[5]+I*S[6]+O*S[7],B=E*S[8]+R*S[9]+I*S[10]+O*S[11],k=E*S[12]+R*S[13]+I*S[14]+O*S[15];return new ze(z,M,B,k)}dotCoordinate(v){return this.normal.x*v.x+this.normal.y*v.y+this.normal.z*v.z+this.d}copyFromPoints(v,A,S){const E=A.x-v.x,R=A.y-v.y,I=A.z-v.z,O=S.x-v.x,z=S.y-v.y,M=S.z-v.z,B=R*M-I*z,k=I*O-E*M,H=E*z-R*O,V=Math.sqrt(B*B+k*k+H*H);let W;return W=0!==V?1/V:0,this.normal.x=B*W,this.normal.y=k*W,this.normal.z=H*W,this.d=-(this.normal.x*v.x+this.normal.y*v.y+this.normal.z*v.z),this}isFrontFacingTo(v,A){return ke.Vector3.Dot(this.normal,v)<=A}signedDistanceTo(v){return ke.Vector3.Dot(v,this.normal)+this.d}}Be.Plane=ze,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.Frustum=void 0;const Ve=Be;class Me{static GetPlanes(v){const A=[];for(let v=0;v<6;v++)A.push(new Ve.Plane(0,0,0,0));return Me.GetPlanesToRef(v,A),A}static GetNearPlaneToRef(v,A){const S=v.m;A.normal.x=S[3]+S[2],A.normal.y=S[7]+S[6],A.normal.z=S[11]+S[10],A.d=S[15]+S[14],A.normalize()}static GetFarPlaneToRef(v,A){const S=v.m;A.normal.x=S[3]-S[2],A.normal.y=S[7]-S[6],A.normal.z=S[11]-S[10],A.d=S[15]-S[14],A.normalize()}static GetLeftPlaneToRef(v,A){const S=v.m;A.normal.x=S[3]+S[0],A.normal.y=S[7]+S[4],A.normal.z=S[11]+S[8],A.d=S[15]+S[12],A.normalize()}static GetRightPlaneToRef(v,A){const S=v.m;A.normal.x=S[3]-S[0],A.normal.y=S[7]-S[4],A.normal.z=S[11]-S[8],A.d=S[15]-S[12],A.normalize()}static GetTopPlaneToRef(v,A){const S=v.m;A.normal.x=S[3]-S[1],A.normal.y=S[7]-S[5],A.normal.z=S[11]-S[9],A.d=S[15]-S[13],A.normalize()}static GetBottomPlaneToRef(v,A){const S=v.m;A.normal.x=S[3]+S[1],A.normal.y=S[7]+S[5],A.normal.z=S[11]+S[9],A.d=S[15]+S[13],A.normalize()}static GetPlanesToRef(v,A){Me.GetNearPlaneToRef(v,A[0]),Me.GetFarPlaneToRef(v,A[1]),Me.GetLeftPlaneToRef(v,A[2]),Me.GetRightPlaneToRef(v,A[3]),Me.GetTopPlaneToRef(v,A[4]),Me.GetBottomPlaneToRef(v,A[5])}}Fe.Frustum=Me;var We={};Object.defineProperty(We,"__esModule",{value:!0}),We.Path2=void 0;const Ge=de,Xe=ue,qe=It;class De{constructor(v,A){this.closed=!1,this._points=new Array,this._length=0,this._points.push(new Ge.Vector2(v,A))}static StartingAt(v,A){return new De(v,A)}addLineTo(v,A){if(this.closed)return this;const S=new Ge.Vector2(v,A),E=this._points[this._points.length-1];return this._points.push(S),this._length+=S.subtract(E).length(),this}addArcTo(v,A,S,E,R=36){if(this.closed)return this;const I=this._points[this._points.length-1],O=new Ge.Vector2(v,A),z=new Ge.Vector2(S,E),M=new Xe.Arc2(I,O,z);let B=M.angle.radians()/R;M.orientation===qe.Orientation.CW&&(B*=-1);let k=M.startAngle.radians()+B;for(let v=0;v<R;v++){const v=Math.cos(k)*M.radius+M.centerPoint.x,A=Math.sin(k)*M.radius+M.centerPoint.y;this.addLineTo(v,A),k+=B}return this}close(){return this.closed=!0,this}length(){let v=this._length;if(!this.closed){const A=this._points[this._points.length-1];v+=this._points[0].subtract(A).length()}return v}getPoints(){return this._points}getPointAtLengthPosition(v){if(v<0||v>1)return Ge.Vector2.Zero();const A=v*this.length();let S=0;for(let v=0;v<this._points.length;v++){const E=(v+1)%this._points.length,R=this._points[v],I=this._points[E].subtract(R),O=I.length()+S;if(A>=S&&A<=O){const v=I.normalize(),E=A-S;return new Ge.Vector2(R.x+v.x*E,R.y+v.y*E)}S=O}return Ge.Vector2.Zero()}}We.Path2=De;var Ye={};Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.Path3D=void 0;const Qe=zt,Ze=It,Je=kt;Ye.Path3D=class{constructor(v,A=null,S){this.path=v,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(let A=0;A<v.length;A++)this._curve[A]=v[A].clone();this._raw=S||!1,this._compute(A)}getCurve(){return this._curve}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}update(v,A=null){for(let A=0;A<v.length;A++)this._curve[A].x=v[A].x,this._curve[A].y=v[A].y,this._curve[A].z=v[A].z;return this._compute(A),this}_compute(v){const A=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[A-1]=this._curve[A-1].subtract(this._curve[A-2]),this._raw||this._tangents[A-1].normalize();const S=this._tangents[0],E=this._normalVector(this._curve[0],S,v);let R,I,O,z;this._normals[0]=E,this._raw||this._normals[0].normalize(),this._binormals[0]=Qe.Vector3.Cross(S,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let v=1;v<A;v++)R=this._getLastNonNullVector(v),v<A-1&&(I=this._getFirstNonNullVector(v),this._tangents[v]=R.add(I),this._tangents[v].normalize()),this._distances[v]=this._distances[v-1]+R.length(),O=this._tangents[v],z=this._binormals[v-1],this._normals[v]=Qe.Vector3.Cross(z,O),this._raw||this._normals[v].normalize(),this._binormals[v]=Qe.Vector3.Cross(O,this._normals[v]),this._raw||this._binormals[v].normalize()}_getFirstNonNullVector(v){let A=1,S=this._curve[v+A].subtract(this._curve[v]);for(;0===S.length()&&v+A+1<this._curve.length;)A++,S=this._curve[v+A].subtract(this._curve[v]);return S}_getLastNonNullVector(v){let A=1,S=this._curve[v].subtract(this._curve[v-A]);for(;0===S.length()&&v>A+1;)A++,S=this._curve[v].subtract(this._curve[v-A]);return S}_normalVector(v,A,S){let E,R=A.length();if(0===R&&(R=1),null==S){let v;v=Je.Scalar.WithinEpsilon(Math.abs(A.y)/R,1,Ze.Epsilon)?Je.Scalar.WithinEpsilon(Math.abs(A.x)/R,1,Ze.Epsilon)?Je.Scalar.WithinEpsilon(Math.abs(A.z)/R,1,Ze.Epsilon)?Qe.Vector3.Zero():new Qe.Vector3(0,0,1):new Qe.Vector3(1,0,0):new Qe.Vector3(0,-1,0),E=Qe.Vector3.Cross(A,v)}else E=Qe.Vector3.Cross(A,S),Qe.Vector3.CrossToRef(E,A,E);return E.normalize(),E}};var $e={};Object.defineProperty($e,"__esModule",{value:!0}),$e.Size=void 0;class je{constructor(v,A){this.width=v,this.height=A}get surface(){return this.width*this.height}static Zero(){return new je(0,0)}static Lerp(v,A,S){const E=v.width+(A.width-v.width)*S,R=v.height+(A.height-v.height)*S;return new je(E,R)}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let v=this.width||0;return v=397*v^(this.height||0),v}copyFrom(v){this.width=v.width,this.height=v.height}copyFromFloats(v,A){return this.width=v,this.height=A,this}set(v,A){return this.copyFromFloats(v,A)}multiplyByFloats(v,A){return new je(this.width*v,this.height*A)}clone(){return new je(this.width,this.height)}equals(v){return!!v&&this.width===v.width&&this.height===v.height}add(v){return new je(this.width+v.width,this.height+v.height)}subtract(v){return new je(this.width-v.width,this.height-v.height)}}$e.Size=je,function(v){var A=Rt&&Rt.__createBinding||(Object.create?function(v,A,S,E){void 0===E&&(E=S),Object.defineProperty(v,E,{enumerable:!0,get:function(){return A[S]}})}:function(v,A,S,E){void 0===E&&(E=S),v[E]=A[S]}),S=Rt&&Rt.__exportStar||function(v,S){for(var E in v)"default"===E||Object.prototype.hasOwnProperty.call(S,E)||A(S,v,E)};Object.defineProperty(v,"__esModule",{value:!0}),S(It,v),S(Ot,v),S(ce,v),S(ue,v),S(we,v),S(Ce,v),S(_e,v),S(Se,v),S(Ne,v),S(Fe,v),S(Ft,v),S(We,v),S(Ye,v),S(Be,v),S(Lt,v),S(kt,v),S($e,v),S(de,v),S(zt,v),S(Bt,v),S(Pt,v)}(Pt);var tn,nn,on,rn,sn={looping:!0,speed:1,weight:1,layer:0},an=function(v){function e(A,S){void 0===S&&(S=sn);var E=v.call(this)||this;return E.isAnimationClip=!0,E.looping=sn.looping,E.weight=sn.weight,E.playing=!1,E.shouldReset=!1,E.speed=sn.speed,E.name=f("AnimClip"),E.layer=sn.layer,E.clip=A,E.setParams(o({},S)),E}return i(e,v),e.prototype.setParams=function(v){return this.looping=void 0!==v.looping?v.looping:this.looping,this.speed=v.speed||this.speed,this.weight=v.weight||this.weight,this.layer=v.layer||this.layer,this},e.prototype.toJSON=function(){var A=JSON.parse(JSON.stringify(v.prototype.toJSON.call(this)));return this.shouldReset&&(this.shouldReset=!1),A},e.prototype.play=function(v){var A;void 0===v&&(v=!1),null===(A=this.owner)||void 0===A||A.play(this,v)},e.prototype.pause=function(){var v;null===(v=this.owner)||void 0===v||v.pause(this)},e.prototype.reset=function(){this.shouldReset=!0},e.prototype.stop=function(){var v;null===(v=this.owner)||void 0===v||v.stop(this)},r([K.readonly,s("design:type",String)],e.prototype,"clip",void 0),r([K.field,s("design:type",Boolean)],e.prototype,"looping",void 0),r([K.field,s("design:type",Number)],e.prototype,"weight",void 0),r([K.field,s("design:type",Boolean)],e.prototype,"playing",void 0),r([K.field,s("design:type",Boolean)],e.prototype,"shouldReset",void 0),r([K.field,s("design:type",Number)],e.prototype,"speed",void 0),r([K.readonly,s("design:type",String)],e.prototype,"name",void 0),e}(K);v.InputEventType=void 0,(tn=v.InputEventType||(v.InputEventType={}))[tn.DOWN=0]="DOWN",tn[tn.UP=1]="UP",v.CameraMode=void 0,(nn=v.CameraMode||(v.CameraMode={}))[nn.FirstPerson=0]="FirstPerson",nn[nn.ThirdPerson=1]="ThirdPerson",nn[nn.BuildingToolGodMode=2]="BuildingToolGodMode",v.LandRole=void 0,(on=v.LandRole||(v.LandRole={})).OWNER="owner",on.OPERATOR="operator",v.ActionButton=void 0,(rn=v.ActionButton||(v.ActionButton={})).POINTER="POINTER",rn.PRIMARY="PRIMARY",rn.SECONDARY="SECONDARY",rn.ANY="ANY",rn.FORWARD="FORWARD",rn.BACKWARD="BACKWARD",rn.RIGHT="RIGHT",rn.LEFT="LEFT",rn.JUMP="JUMP",rn.WALK="WALK",rn.ACTION_3="ACTION_3",rn.ACTION_4="ACTION_4",rn.ACTION_5="ACTION_5",rn.ACTION_6="ACTION_6";var ln,hn,Ke=function(v){if(this.callback=v,!v||!("apply"in v)||!("call"in v))throw new Error("Callback is not a function");dn.ensureInstance()},cn=function(v){function e(){return null!==v&&v.apply(this,arguments)||this}return i(e,v),r([P("pointerDown")],e)}(Ke),un=function(v){function e(){return null!==v&&v.apply(this,arguments)||this}return i(e,v),r([P("pointerUp")],e)}(Ke),en=function(v,A){this.fn=v,this.useRaycast=A},dn=function(){function e(){this.buttonIdMapping=[v.ActionButton.POINTER,v.ActionButton.PRIMARY,v.ActionButton.SECONDARY,v.ActionButton.ANY,v.ActionButton.FORWARD,v.ActionButton.BACKWARD,v.ActionButton.RIGHT,v.ActionButton.LEFT,v.ActionButton.JUMP,v.ActionButton.WALK,v.ActionButton.ACTION_3,v.ActionButton.ACTION_4,v.ActionButton.ACTION_5,v.ActionButton.ACTION_6],this.subscriptions=this.buttonIdMapping.reduce((function(v,A){var S;return o(o({},v),((S={})[A]={BUTTON_DOWN:[],BUTTON_UP:[]},S))}),{}),this.internalState=this.buttonIdMapping.reduce((function(v,A){var S;return o(o({},v),((S={})[A]={BUTTON_DOWN:!1},S))}),{})}return Object.defineProperty(e,"instance",{get:function(){return e.ensureInstance(),e._instance},enumerable:!1,configurable:!0}),e.ensureInstance=function(){e._instance||(e._instance=new e)},e.prototype.isButtonPressed=function(v){return this.internalState[v]},e.prototype.subscribe=function(v,A,S,E){var R=this;return this.subscriptions[A][v].push(new en(E,S)),function(){R.unsubscribe(v,A,E)}},e.prototype.unsubscribe=function(v,A,S){var E=this.getSubscriptionId(v,A,S);return E>-1&&this.subscriptions[A][v].splice(E,1)},e.prototype.handlePointerEvent=function(A){var S=this.getPointerById(A.buttonId);if(S){var E=o(o({},A),{button:S,direction:(new Pt.Vector3).copyFrom(A.direction),origin:(new Pt.Vector3).copyFrom(A.origin),hit:void 0}),R=A.hit?o(o({},A.hit),{hitPoint:(new Pt.Vector3).copyFrom(A.hit.hitPoint),normal:(new Pt.Vector3).copyFrom(A.hit.normal),worldNormal:(new Pt.Vector3).copyFrom(A.hit.worldNormal)}):void 0;if(A.type===v.InputEventType.DOWN){this.internalState[S].BUTTON_DOWN=!0;for(var I=0;I<this.subscriptions[S].BUTTON_DOWN.length;I++)(O=this.subscriptions[S].BUTTON_DOWN[I]).useRaycast?E.hit=R:E.hit=void 0,O.fn(E);R&&R.entityId&&N.engine&&(M=(z=N.engine.entities[R.entityId])&&z.getComponentOrNull(cn))&&(E.hit=R,M.callback(E))}else{for(this.internalState[S].BUTTON_DOWN=!1,I=0;I<this.subscriptions[S].BUTTON_UP.length;I++){var O;(O=this.subscriptions[S].BUTTON_UP[I]).useRaycast?E.hit=R:E.hit=void 0,O.fn(E)}var z,M;R&&R.entityId&&N.engine&&(M=(z=N.engine.entities[R.entityId])&&z.getComponentOrNull(un))&&(E.hit=R,M.callback(E))}}},e.prototype.getSubscriptionId=function(v,A,S){for(var E=0;E<this.subscriptions[A][v].length;E++)if(this.subscriptions[A][v][E].fn===S)return E;return-1},e.prototype.getPointerById=function(A){if(A<0||A>=this.buttonIdMapping.length)return null;var S=this.buttonIdMapping[A];return S===v.ActionButton.ANY?null:S},e}();v.CLASS_ID=void 0,(ln=v.CLASS_ID||(v.CLASS_ID={}))[ln.TRANSFORM=1]="TRANSFORM",ln[ln.UUID_CALLBACK=8]="UUID_CALLBACK",ln[ln.BOX_SHAPE=16]="BOX_SHAPE",ln[ln.SPHERE_SHAPE=17]="SPHERE_SHAPE",ln[ln.PLANE_SHAPE=18]="PLANE_SHAPE",ln[ln.CONE_SHAPE=19]="CONE_SHAPE",ln[ln.CYLINDER_SHAPE=20]="CYLINDER_SHAPE",ln[ln.TEXT_SHAPE=21]="TEXT_SHAPE",ln[ln.NFT_SHAPE=22]="NFT_SHAPE",ln[ln.UI_WORLD_SPACE_SHAPE=23]="UI_WORLD_SPACE_SHAPE",ln[ln.UI_SCREEN_SPACE_SHAPE=24]="UI_SCREEN_SPACE_SHAPE",ln[ln.UI_CONTAINER_RECT=25]="UI_CONTAINER_RECT",ln[ln.UI_CONTAINER_STACK=26]="UI_CONTAINER_STACK",ln[ln.UI_TEXT_SHAPE=27]="UI_TEXT_SHAPE",ln[ln.UI_INPUT_TEXT_SHAPE=28]="UI_INPUT_TEXT_SHAPE",ln[ln.UI_IMAGE_SHAPE=29]="UI_IMAGE_SHAPE",ln[ln.UI_SLIDER_SHAPE=30]="UI_SLIDER_SHAPE",ln[ln.CIRCLE_SHAPE=31]="CIRCLE_SHAPE",ln[ln.BILLBOARD=32]="BILLBOARD",ln[ln.ANIMATION=33]="ANIMATION",ln[ln.FONT=34]="FONT",ln[ln.UI_FULLSCREEN_SHAPE=40]="UI_FULLSCREEN_SHAPE",ln[ln.UI_BUTTON_SHAPE=41]="UI_BUTTON_SHAPE",ln[ln.GLTF_SHAPE=54]="GLTF_SHAPE",ln[ln.OBJ_SHAPE=55]="OBJ_SHAPE",ln[ln.AVATAR_SHAPE=56]="AVATAR_SHAPE",ln[ln.BASIC_MATERIAL=64]="BASIC_MATERIAL",ln[ln.PBR_MATERIAL=65]="PBR_MATERIAL",ln[ln.HIGHLIGHT_ENTITY=66]="HIGHLIGHT_ENTITY",ln[ln.SOUND=67]="SOUND",ln[ln.TEXTURE=68]="TEXTURE",ln[ln.VIDEO_CLIP=70]="VIDEO_CLIP",ln[ln.VIDEO_TEXTURE=71]="VIDEO_TEXTURE",ln[ln.AVATAR_TEXTURE=72]="AVATAR_TEXTURE",ln[ln.AUDIO_CLIP=200]="AUDIO_CLIP",ln[ln.AUDIO_SOURCE=201]="AUDIO_SOURCE",ln[ln.AUDIO_STREAM=202]="AUDIO_STREAM",ln[ln.GIZMOS=203]="GIZMOS",ln[ln.SMART_ITEM=204]="SMART_ITEM",ln[ln.AVATAR_MODIFIER_AREA=205]="AVATAR_MODIFIER_AREA",ln[ln.AVATAR_ATTACH=206]="AVATAR_ATTACH",ln[ln.CAMERA_MODE_AREA=207]="CAMERA_MODE_AREA",ln[ln.NAME=300]="NAME",ln[ln.LOCKED_ON_EDIT=301]="LOCKED_ON_EDIT",ln[ln.VISIBLE_ON_EDIT=302]="VISIBLE_ON_EDIT",v.AvatarModifiers=void 0,(hn=v.AvatarModifiers||(v.AvatarModifiers={})).HIDE_AVATARS="HIDE_AVATARS",hn.DISABLE_PASSPORTS="DISABLE_PASSPORTS";var pn,yn=function(A){function n(v){var S=A.call(this)||this;return S.area=v.area,S.modifiers=v.modifiers,S.excludeIds=v.excludeIds,S}return i(n,A),r([K.field,s("design:type",Object)],n.prototype,"area",void 0),r([K.field,s("design:type",Array)],n.prototype,"modifiers",void 0),r([K.field,s("design:type",Array)],n.prototype,"excludeIds",void 0),r([P("engine.avatarModifierArea",v.CLASS_ID.AVATAR_MODIFIER_AREA),s("design:paramtypes",[Object])],n)}(K),fn=function(A){function n(v){void 0===v&&(v={});var S=A.call(this)||this;return S.position=v.position||Pt.Vector3.Zero(),S.rotation=v.rotation||Pt.Quaternion.Identity,S.scale=v.scale||new Pt.Vector3(1,1,1),S}return i(n,A),Object.defineProperty(n.prototype,"eulerAngles",{get:function(){return this.rotation.eulerAngles},enumerable:!1,configurable:!0}),n.prototype.lookAt=function(v,A){void 0===A&&(A=Pt.MathTmp.staticUp);var S=new Pt.Matrix;return Pt.Matrix.LookAtLHToRef(this.position,v,A,S),S.invert(),Pt.Quaternion.FromRotationMatrixToRef(S,this.rotation),this},n.prototype.rotate=function(v,A){return this.rotation.multiplyInPlace(this.rotation.angleAxis(A,v)),this},n.prototype.translate=function(v){return this.position.addInPlace(v),this},r([K.field,s("design:type",Pt.Vector3)],n.prototype,"position",void 0),r([K.field,s("design:type",Pt.Quaternion)],n.prototype,"rotation",void 0),r([K.field,s("design:type",Pt.Vector3)],n.prototype,"scale",void 0),r([P("engine.transform",v.CLASS_ID.TRANSFORM),s("design:paramtypes",[Object])],n)}(K);v.AttachToAvatarAnchorPointId=void 0,(pn=v.AttachToAvatarAnchorPointId||(v.AttachToAvatarAnchorPointId={}))[pn.Position=0]="Position",pn[pn.NameTag=1]="NameTag",pn[pn.LeftHand=2]="LeftHand",pn[pn.RightHand=3]="RightHand";var gn,mn=function(A){function n(S){void 0===S&&(S={});var E=A.call(this)||this;return E.avatarId=S.avatarId||"",E.anchorPointId=S.anchorPointId||v.AttachToAvatarAnchorPointId.Position,E}return i(n,A),r([K.field,s("design:type",String)],n.prototype,"avatarId",void 0),r([K.field,s("design:type",Number)],n.prototype,"anchorPointId",void 0),r([K.field,s("design:type",String)],n.prototype,"avatarSceneId",void 0),r([P("engine.transform",v.CLASS_ID.AVATAR_ATTACH),s("design:paramtypes",[Object])],n)}(K),vn=function(A){function n(v,S,E){void 0===v&&(v=!0),void 0===S&&(S=!0),void 0===E&&(E=!0);var R=A.call(this)||this;return R.x=!0,R.y=!0,R.z=!0,R.x=v,R.y=S,R.z=E,R}return i(n,A),r([K.field,s("design:type",Boolean)],n.prototype,"x",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"y",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"z",void 0),r([P("engine.billboard",v.CLASS_ID.BILLBOARD),s("design:paramtypes",[Boolean,Boolean,Boolean])],n)}(K),bn=function(v){function e(){var A=null!==v&&v.apply(this,arguments)||this;return A.withCollisions=!0,A.isPointerBlocker=!0,A.visible=!0,A}return i(e,v),r([K.field,s("design:type",Boolean)],e.prototype,"withCollisions",void 0),r([K.field,s("design:type",Boolean)],e.prototype,"isPointerBlocker",void 0),r([K.field,s("design:type",Boolean)],e.prototype,"visible",void 0),e}(K),wn=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([K.field,s("design:type",Array)],n.prototype,"uvs",void 0),r([N("engine.shape",v.CLASS_ID.BOX_SHAPE)],n)}(bn),Tn=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.SPHERE_SHAPE)],n)}(bn),xn=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([K.field,s("design:type",Number)],n.prototype,"segments",void 0),r([K.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CIRCLE_SHAPE)],n)}(bn),Cn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.width=1,v.height=1,v}return i(n,A),r([K.field,s("design:type",Number)],n.prototype,"width",void 0),r([K.field,s("design:type",Number)],n.prototype,"height",void 0),r([K.field,s("design:type",Array)],n.prototype,"uvs",void 0),r([N("engine.shape",v.CLASS_ID.PLANE_SHAPE)],n)}(bn),_n=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.radiusTop=0,v.radiusBottom=1,v.segmentsHeight=1,v.segmentsRadial=36,v.openEnded=!1,v.radius=null,v.arc=360,v}return i(n,A),r([K.field,s("design:type",Number)],n.prototype,"radiusTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"radiusBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"segmentsHeight",void 0),r([K.field,s("design:type",Number)],n.prototype,"segmentsRadial",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"openEnded",void 0),r([K.field,s("design:type",Object)],n.prototype,"radius",void 0),r([K.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CONE_SHAPE)],n)}(bn),An=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.radiusTop=1,v.radiusBottom=1,v.segmentsHeight=1,v.segmentsRadial=36,v.openEnded=!1,v.radius=null,v.arc=360,v}return i(n,A),r([K.field,s("design:type",Number)],n.prototype,"radiusTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"radiusBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"segmentsHeight",void 0),r([K.field,s("design:type",Number)],n.prototype,"segmentsRadial",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"openEnded",void 0),r([K.field,s("design:type",Object)],n.prototype,"radius",void 0),r([K.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CYLINDER_SHAPE)],n)}(bn),Sn=function(A){function n(v){var S=A.call(this)||this;return S.src=v,S}return i(n,A),r([bn.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.shape",v.CLASS_ID.GLTF_SHAPE),s("design:paramtypes",[String])],n)}(bn);v.PictureFrameStyle=void 0,(gn=v.PictureFrameStyle||(v.PictureFrameStyle={}))[gn.Classic=0]="Classic",gn[gn.Baroque_Ornament=1]="Baroque_Ornament",gn[gn.Diamond_Ornament=2]="Diamond_Ornament",gn[gn.Minimal_Wide=3]="Minimal_Wide",gn[gn.Minimal_Grey=4]="Minimal_Grey",gn[gn.Blocky=5]="Blocky",gn[gn.Gold_Edges=6]="Gold_Edges",gn[gn.Gold_Carved=7]="Gold_Carved",gn[gn.Gold_Wide=8]="Gold_Wide",gn[gn.Gold_Rounded=9]="Gold_Rounded",gn[gn.Metal_Medium=10]="Metal_Medium",gn[gn.Metal_Wide=11]="Metal_Wide",gn[gn.Metal_Slim=12]="Metal_Slim",gn[gn.Metal_Rounded=13]="Metal_Rounded",gn[gn.Pins=14]="Pins",gn[gn.Minimal_Black=15]="Minimal_Black",gn[gn.Minimal_White=16]="Minimal_White",gn[gn.Tape=17]="Tape",gn[gn.Wood_Slim=18]="Wood_Slim",gn[gn.Wood_Wide=19]="Wood_Wide",gn[gn.Wood_Twigs=20]="Wood_Twigs",gn[gn.Canvas=21]="Canvas",gn[gn.None=22]="None";var En,Rn=function(A){function n(S,E){void 0===E&&(E={});var R=A.call(this)||this;R.src=S;var I=new Pt.Color3(.6404918,.611472,.8584906),O=v.PictureFrameStyle.Classic;return"r"in E?I=E:null!==E&&(E.color&&(I=E.color),E.style&&(O=E.style)),R.color=I,R.style=O,R}return i(n,A),r([bn.readonly,s("design:type",String)],n.prototype,"src",void 0),r([bn.readonly,s("design:type",Number)],n.prototype,"style",void 0),r([K.field,s("design:type",Pt.Color3)],n.prototype,"color",void 0),r([N("engine.shape",v.CLASS_ID.NFT_SHAPE),s("design:paramtypes",[String,Object])],n)}(bn),Pn=function(A){function n(v,S){var E=A.call(this)||this,R=new RegExp("data:[a-z-]+/[a-z-]+;base64");if((v.length>2048||R.test(v))&&u("⚠️🚨 Base64 textures will be deprecated in version 7 of decentraland-ecs"),E.src=v,S)for(var I in S)E[I]=S[I];return E}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"src",void 0),r([K.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([K.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([K.readonly,s("design:type",Boolean)],n.prototype,"hasAlpha",void 0),r([N("engine.texture",v.CLASS_ID.TEXTURE),s("design:paramtypes",[String,Object])],n)}(K),In=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.states=[],v}return i(n,A),n.prototype.addClip=function(v){var A=this;return this.states.push(v),v.onChange((function(){A.dirty=!0})),v.owner=this,this},n.prototype.getClip=function(v){for(var A=0;A<this.states.length;A++){var S=this.states[A];if(S.clip===v)return S}var E=new an(v);return this.addClip(E),E},n.prototype.stop=function(v){if(v)v.playing=!1,v.shouldReset=!0;else for(var A=0;A<this.states.length;A++){var S=this.states[A];this.stop(S)}},n.prototype.play=function(v,A){void 0===A&&(A=!1);for(var S=0;S<this.states.length;S++){var E=this.states[S];E.layer===v.layer&&v!==E&&this.pause(E)}A&&(v.shouldReset=!0),v.playing=!0,v.dirty=!0,v.data.nonce=Math.random()},n.prototype.pause=function(v){if(v)v.playing=!1;else for(var A=0;A<this.states.length;A++){var S=this.states[A];this.pause(S)}},r([K.readonly,s("design:type",Array)],n.prototype,"states",void 0),r([P("engine.animator",v.CLASS_ID.ANIMATION)],n)}(bn),On=function(A){function n(v){var S=A.call(this)||this;return S.src=v,S}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.shape",v.CLASS_ID.OBJ_SHAPE),s("design:paramtypes",[String])],n)}(bn),Dn=function(A){function n(v){void 0===v&&(v="");var S=A.call(this)||this;return S.src=v,S}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.font",v.CLASS_ID.FONT),s("design:paramtypes",[String])],n)}(K);v.Fonts=void 0,(En=v.Fonts||(v.Fonts={})).SanFrancisco="builtin:SF-UI-Text-Regular SDF",En.SanFrancisco_Heavy="builtin:SF-UI-Text-Heavy SDF",En.SanFrancisco_Semibold="builtin:SF-UI-Text-Semibold SDF",En.LiberationSans="builtin:LiberationSans SDF",En.SansSerif="SansSerif",En.SansSerif_Heavy="SansSerif_Heavy",En.SansSerif_Bold="SansSerif_Bold",En.SansSerif_SemiBold="SansSerif_SemiBold";var Nn,zn=function(A){function n(v){var S=A.call(this)||this;return S.outlineWidth=0,S.outlineColor=new Pt.Color3(1,1,1),S.color=new Pt.Color3(1,1,1),S.fontSize=10,S.opacity=1,S.value="",S.lineSpacing="0px",S.lineCount=0,S.textWrapping=!1,S.shadowBlur=0,S.shadowOffsetX=0,S.shadowOffsetY=0,S.shadowColor=new Pt.Color3(1,1,1),S.hTextAlign="center",S.vTextAlign="center",S.width=1,S.height=1,S.paddingTop=0,S.paddingRight=0,S.paddingBottom=0,S.paddingLeft=0,S.billboard=!1,S.visible=!0,v&&(S.value=v),S}return i(n,A),r([K.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([K.field,s("design:type",Pt.Color3)],n.prototype,"outlineColor",void 0),r([K.field,s("design:type",Pt.Color3)],n.prototype,"color",void 0),r([K.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([K.component,s("design:type",Dn)],n.prototype,"font",void 0),r([K.field,s("design:type",Number)],n.prototype,"opacity",void 0),r([K.field,s("design:type",String)],n.prototype,"value",void 0),r([K.field,s("design:type",String)],n.prototype,"lineSpacing",void 0),r([K.field,s("design:type",Number)],n.prototype,"lineCount",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([K.field,s("design:type",Pt.Color3)],n.prototype,"shadowColor",void 0),r([K.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([K.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([K.field,s("design:type",Number)],n.prototype,"width",void 0),r([K.field,s("design:type",Number)],n.prototype,"height",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"billboard",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"visible",void 0),r([P("engine.text",v.CLASS_ID.TEXT_SHAPE),s("design:paramtypes",[String])],n)}(K);v.TransparencyMode=void 0,(Nn=v.TransparencyMode||(v.TransparencyMode={}))[Nn.OPAQUE=0]="OPAQUE",Nn[Nn.ALPHA_TEST=1]="ALPHA_TEST",Nn[Nn.ALPHA_BLEND=2]="ALPHA_BLEND",Nn[Nn.ALPHA_TEST_AND_BLEND=3]="ALPHA_TEST_AND_BLEND",Nn[Nn.AUTO=4]="AUTO";var Mn,Ln=function(A){function n(){var S=null!==A&&A.apply(this,arguments)||this;return S.alphaTest=.5,S.castShadows=!0,S.transparencyMode=v.TransparencyMode.AUTO,S}return i(n,A),r([K.field,s("design:type",Number)],n.prototype,"alphaTest",void 0),r([K.field,s("design:type",Object)],n.prototype,"albedoColor",void 0),r([K.field,s("design:type",Pt.Color3)],n.prototype,"emissiveColor",void 0),r([K.field,s("design:type",Number)],n.prototype,"metallic",void 0),r([K.field,s("design:type",Number)],n.prototype,"roughness",void 0),r([K.field,s("design:type",Pt.Color3)],n.prototype,"reflectivityColor",void 0),r([K.field,s("design:type",Number)],n.prototype,"directIntensity",void 0),r([K.field,s("design:type",Number)],n.prototype,"microSurface",void 0),r([K.field,s("design:type",Number)],n.prototype,"emissiveIntensity",void 0),r([K.field,s("design:type",Number)],n.prototype,"specularIntensity",void 0),r([K.component,s("design:type",Object)],n.prototype,"albedoTexture",void 0),r([K.component,s("design:type",Object)],n.prototype,"alphaTexture",void 0),r([K.component,s("design:type",Object)],n.prototype,"emissiveTexture",void 0),r([K.component,s("design:type",Object)],n.prototype,"bumpTexture",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"castShadows",void 0),r([K.field,s("design:type",Number)],n.prototype,"transparencyMode",void 0),r([N("engine.material",v.CLASS_ID.PBR_MATERIAL)],n)}(K),Fn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.alphaTest=.5,v.castShadows=!0,v}return i(n,A),r([K.component,s("design:type",Object)],n.prototype,"texture",void 0),r([K.field,s("design:type",Number)],n.prototype,"alphaTest",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"castShadows",void 0),r([N("engine.material",v.CLASS_ID.BASIC_MATERIAL)],n)}(K),Bn=function(v){function e(A){var S=v.call(this)||this;if(S.uuid=f("UUID"),!A||!("apply"in A)||!("call"in A))throw new Error("Callback is not a function");return S.callback=A,S}return i(e,v),e.uuidEvent=function(v,A){if(delete v[A]){var S=A+"_"+Math.random();v[S]=void 0,Object.defineProperty(v,S,o(o({},Object.getOwnPropertyDescriptor(v,S)),{enumerable:!1})),Object.defineProperty(v,A.toString(),{get:function(){return this[S]},set:function(v){var E=this[S];if(v){if(!(v instanceof e))throw new Error("value is not an OnUUIDEvent");this.data[A]=v.uuid}else this.data[A]=null;if(this[S]=v,v!==E){this.dirty=!0;for(var R=0;R<this.subscriptions.length;R++)this.subscriptions[R](A,v,E)}},enumerable:!0})}},e.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type}},r([K.field,s("design:type",Function)],e.prototype,"callback",void 0),e}(K),kn=function(A){function n(){var S=null!==A&&A.apply(this,arguments)||this;return S.button=v.ActionButton.ANY,S.hoverText="Interact",S.distance=10,S.showFeedback=!0,S}return i(n,A),n.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type,button:this.button,hoverText:this.hoverText,distance:this.distance,showFeedback:this.showFeedback}},r([K.field,s("design:type",String)],n.prototype,"button",void 0),r([K.field,s("design:type",String)],n.prototype,"hoverText",void 0),r([K.field,s("design:type",Number)],n.prototype,"distance",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"showFeedback",void 0),n}(Bn),Hn=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.type="onPointerLock",v}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onPointerLock",v.CLASS_ID.UUID_CALLBACK)],n)}(Bn),Un=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.type="onAnimationEnd",v}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onAnimationEnd",v.CLASS_ID.UUID_CALLBACK)],n)}(Bn),Vn=function(A){function n(){return null!==A&&A.apply(this,arguments)||this}return i(n,A),r([P("engine.smartItem",v.CLASS_ID.SMART_ITEM)],n)}(K),Wn=function(A){function n(v){var S=A.call(this)||this;return S.url=v,S}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"url",void 0),r([N("engine.VideoClip",v.CLASS_ID.VIDEO_CLIP),s("design:paramtypes",[String])],n)}(K);v.VideoStatus=void 0,(Mn=v.VideoStatus||(v.VideoStatus={}))[Mn.NONE=0]="NONE",Mn[Mn.ERROR=1]="ERROR",Mn[Mn.LOADING=2]="LOADING",Mn[Mn.READY=3]="READY",Mn[Mn.PLAYING=4]="PLAYING",Mn[Mn.BUFFERING=5]="BUFFERING";var jn,Gn=function(A){function n(S,E){var R=A.call(this)||this;if(R.volume=1,R.playbackRate=1,R.loop=!1,R.seek=-1,R._position=-1,R._videoLength=-1,R._status=v.VideoStatus.NONE,R.playing=!1,!(S instanceof Wn))throw new Error("Trying to create VideoTexture(VideoClip) with an invalid VideoClip");if(R.videoClipId=D(S),E)for(var I in E)R[I]=E[I];return R}return i(n,A),n.prototype.play=function(){this.playing=!0},n.prototype.pause=function(){this.playing=!1},n.prototype.reset=function(){this.seekTime(0),this.pause()},n.prototype.seekTime=function(v){this.seek=v,this.dirty=!0,this.data.nonce=Math.random()},n.prototype.toJSON=function(){if(this.seek>=0){var v=JSON.parse(JSON.stringify(A.prototype.toJSON.call(this)));return this.seek=-1,v}return A.prototype.toJSON.call(this)},n.prototype.update=function(A){A.videoClipId===this.videoClipId&&(this._status=A.videoStatus||v.VideoStatus.NONE,this._videoLength=A.totalVideoLength,this._position=A.currentOffset)},Object.defineProperty(n.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"videoLength",{get:function(){return this._videoLength},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),r([K.readonly,s("design:type",String)],n.prototype,"videoClipId",void 0),r([K.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([K.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([K.field,s("design:type",Number)],n.prototype,"volume",void 0),r([K.field,s("design:type",Number)],n.prototype,"playbackRate",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([K.field,s("design:type",Number)],n.prototype,"seek",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([N("engine.VideoTexture",v.CLASS_ID.VIDEO_TEXTURE),s("design:paramtypes",[Wn,Object])],n)}(K),Xn=function(A){function n(v){var S=A.call(this)||this;return S.area=v.area,S.cameraMode=v.cameraMode,S}return i(n,A),r([K.field,s("design:type",Object)],n.prototype,"area",void 0),r([K.field,s("design:type",Number)],n.prototype,"cameraMode",void 0),r([P("engine.cameraModeArea",v.CLASS_ID.CAMERA_MODE_AREA),s("design:paramtypes",[Object])],n)}(K),qn=function(A){function n(v,S){var E=A.call(this)||this;if(E.userId=v,S)for(var R in S)E[R]=S[R];return E}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"userId",void 0),r([K.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([K.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([K.readonly,s("design:type",Boolean)],n.prototype,"hasAlpha",void 0),r([N("engine.texture",v.CLASS_ID.AVATAR_TEXTURE),s("design:paramtypes",[String,Object])],n)}(K),Yn=function(){function e(){var A=this;this.position=new Pt.Vector3,this.rotation=new Pt.Quaternion,this.feetPosition=new Pt.Vector3,this.worldPosition=new Pt.Vector3,this.lastEventPosition={x:0,y:0,z:0},this.lastEventWorldPosition={x:0,y:0,z:0},this.lastEventRotation={x:0,y:0,z:0,w:1},this._playerHeight=1.6,this._cameraMode=v.CameraMode.ThirdPerson,"undefined"!=typeof dcl&&(dcl.subscribe("positionChanged"),dcl.subscribe("rotationChanged"),dcl.subscribe("cameraModeChanged"),dcl.onEvent((function(v){switch(v.type){case"positionChanged":A.positionChanged(v.data);break;case"rotationChanged":A.rotationChanged(v.data);break;case"cameraModeChanged":A.cameraModeChanged(v.data)}}))),Object.defineProperty(this.position,"x",{get:function(){return A.lastEventPosition.x}}),Object.defineProperty(this.position,"y",{get:function(){return A.lastEventPosition.y}}),Object.defineProperty(this.position,"z",{get:function(){return A.lastEventPosition.z}}),Object.defineProperty(this.worldPosition,"x",{get:function(){return A.lastEventWorldPosition.x}}),Object.defineProperty(this.worldPosition,"y",{get:function(){return A.lastEventWorldPosition.y}}),Object.defineProperty(this.worldPosition,"z",{get:function(){return A.lastEventWorldPosition.z}}),Object.defineProperty(this.feetPosition,"x",{get:function(){return A.lastEventPosition.x}}),Object.defineProperty(this.feetPosition,"y",{get:function(){return A.lastEventPosition.y-A.playerHeight}}),Object.defineProperty(this.feetPosition,"z",{get:function(){return A.lastEventPosition.z}}),Object.defineProperty(this.rotation,"x",{get:function(){return A.lastEventRotation.x}}),Object.defineProperty(this.rotation,"y",{get:function(){return A.lastEventRotation.y}}),Object.defineProperty(this.rotation,"z",{get:function(){return A.lastEventRotation.z}}),Object.defineProperty(this.rotation,"w",{get:function(){return A.lastEventRotation.w}})}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerHeight",{get:function(){return this._playerHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraMode",{get:function(){return this._cameraMode},enumerable:!1,configurable:!0}),e.prototype.positionChanged=function(v){this.lastEventPosition=v.position,this.lastEventWorldPosition=v.cameraPosition,this._playerHeight=v.playerHeight},e.prototype.rotationChanged=function(v){this.lastEventRotation=v.quaternion},e.prototype.cameraModeChanged=function(v){this._cameraMode=v.cameraMode},e}();!function(v){v.HitFirst="rqhf",v.HitAll="rqha"}(jn||(jn={}));var Qn,Kn=function(){function t(){this.queries={}}return Object.defineProperty(t,"instance",{get:function(){return t.ensureInstance(),t._instance},enumerable:!1,configurable:!0}),t.ensureInstance=function(){t._instance||(t._instance=new t)},t.prototype.getRayFromCamera=function(v){var A=Yn.instance.rotation,S=Pt.Matrix.Identity();A.toRotationMatrix(S);var E=Pt.Vector3.TransformCoordinates(Pt.Vector3.Forward(),S);return{origin:Yn.instance.position,direction:E,distance:v}},t.prototype.getRayFromPositions=function(v,A){var S=A.subtract(v),E=S.length();return{origin:v,direction:S.normalize(),distance:E}},t.prototype.hitFirst=function(v,A,S){var E="number"==typeof S?jn.HitFirst+S:m();this.queries[E]=A,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:E,queryType:"HitFirst",ray:v})},t.prototype.hitAll=function(v,A,S){var E="number"==typeof S?jn.HitAll+S:m();this.queries[E]=A,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:E,queryType:"HitAll",ray:v})},t.prototype.hitFirstAvatar=function(v,A){u("not implemented yet")},t.prototype.hitAllAvatars=function(v,A){u("not implemented yet")},t.prototype.handleRaycastHitFirstResponse=function(v){this.queries[v.payload.queryId](v.payload.payload),delete this.queries[v.payload.queryId]},t.prototype.handleRaycastHitAllResponse=function(v){this.queries[v.payload.queryId](v.payload.payload),delete this.queries[v.payload.queryId]},t}(),Zn=function(){function t(){}return t.prototype.activate=function(v){v.eventManager.addListener(lt,this,(function(v){"HitFirst"===v.payload.queryType?Kn.instance.handleRaycastHitFirstResponse(v):"HitAll"===v.payload.queryType&&Kn.instance.handleRaycastHitAllResponse(v)})),"undefined"!=typeof dcl&&dcl.subscribe("raycastResponse")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("raycastResponse")},t}(),Jn=function(){function t(){}return t.prototype.activate=function(v){v.eventManager.addListener(ht,this,(function(v){dn.instance.handlePointerEvent(v.payload)})),"undefined"!=typeof dcl&&(dcl.subscribe("pointerUp"),dcl.subscribe("pointerDown"),dcl.subscribe("actionButtonEvent"))},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&(dcl.unsubscribe("pointerUp"),dcl.unsubscribe("pointerDown"),dcl.unsubscribe("actionButtonEvent"))},t}(),$n=function(){function t(){this.handlerMap={}}return t.prototype.activate=function(v){v.eventManager.addListener(at,this,this.handleEvent),v.eventManager.addListener(z,this,this.componentAdded),v.eventManager.addListener(O,this,this.componentRemoved),"undefined"!=typeof dcl&&dcl.subscribe("uuidEvent")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("uuidEvent")},t.prototype.onAddEntity=function(v){for(var A in v.components){var S=v.components[A];S instanceof Bn&&(this.handlerMap[S.uuid]=S)}},t.prototype.onRemoveEntity=function(v){for(var A in v.components){var S=v.components[A];S instanceof Bn&&delete this.handlerMap[S.uuid]}},t.prototype.componentAdded=function(v){if(v.entity.isAddedToEngine()){var A=v.entity.components[v.componentName];A instanceof Bn&&(this.handlerMap[A.uuid]=A)}},t.prototype.componentRemoved=function(v){v.entity.isAddedToEngine()&&v.component instanceof Bn&&delete this.handlerMap[v.component.uuid]},t.prototype.handleEvent=function(v){if(v.uuid in this.handlerMap){var A=this.handlerMap[v.uuid];A&&A.callback&&"call"in A.callback&&A.callback(v.payload)}},t}(),ti=new Zn,ei=new Jn,ni=new $n,ii=function(A){function n(v){var S=A.call(this)||this;return S.loop=!1,S.volume=1,S.url=v,S}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"url",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([K.field,s("design:type",String)],n.prototype,"loadingCompleteEventId",void 0),r([K.field,s("design:type",Number)],n.prototype,"volume",void 0),r([N("engine.AudioClip",v.CLASS_ID.AUDIO_CLIP),s("design:paramtypes",[String])],n)}(K),oi=function(A){function n(v){var S=A.call(this)||this;if(S.audioClip=v,S.loop=!1,S.volume=1,S.playing=!1,S.pitch=1,S.playedAtTimestamp=Date.now(),!(v instanceof ii))throw new Error("Trying to create AudioSource(AudioClip) with an invalid AudioClip");return S.audioClipId=D(v),S}return i(n,A),n.prototype.playOnce=function(){return this.playing=!0,this.dirty=!0,this.playedAtTimestamp=Date.now(),this.data.nonce=Math.random(),this},r([K.readonly,s("design:type",String)],n.prototype,"audioClipId",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([K.field,s("design:type",Number)],n.prototype,"volume",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([K.field,s("design:type",Number)],n.prototype,"pitch",void 0),r([K.field,s("design:type",Number)],n.prototype,"playedAtTimestamp",void 0),r([P("engine.AudioSource",v.CLASS_ID.AUDIO_SOURCE),s("design:paramtypes",[ii])],n)}(K),ri=function(A){function n(v){var S=A.call(this)||this;return S.playing=!1,S.volume=1,S.url=v,S.playing=!0,S}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"url",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([K.field,s("design:type",Number)],n.prototype,"volume",void 0),r([P("engine.AudioStream",v.CLASS_ID.AUDIO_STREAM),s("design:paramtypes",[String])],n)}(K);v.Gizmo=void 0,(Qn=v.Gizmo||(v.Gizmo={})).MOVE="MOVE",Qn.ROTATE="ROTATE",Qn.SCALE="SCALE",Qn.NONE="NONE";var si,ai=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.type="gizmoEvent",v}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.gizmoEvent",v.CLASS_ID.UUID_CALLBACK)],n)}(Bn),li=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.position=!0,v.rotation=!0,v.scale=!0,v.cycle=!0,v.localReference=!1,v}return i(n,A),r([K.field,s("design:type",Boolean)],n.prototype,"position",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"rotation",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"scale",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"cycle",void 0),r([K.field,s("design:type",String)],n.prototype,"selectedGizmo",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"localReference",void 0),r([P("engine.gizmos",v.CLASS_ID.GIZMOS)],n)}(K),hi=function(A){function n(v){var S=A.call(this,v)||this;return S.type="onFocus",ni.handlerMap[S.uuid]=S,S}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onFocus",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Bn),ci=function(A){function n(v){var S=A.call(this,v)||this;return S.type="onTextSubmit",ni.handlerMap[S.uuid]=S,S}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onTextSubmit",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Bn),ui=function(A){function n(v){var S=A.call(this,v)||this;return S.type="onBlur",ni.handlerMap[S.uuid]=S,S}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onBlur",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Bn),di=function(A){function n(v){var S=A.call(this,v)||this;return S.type="onEnter",ni.handlerMap[S.uuid]=S,S}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onEnter",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Bn),pi=function(A){function n(v){var S=A.call(this,v)||this;return S.type="onChange",ni.handlerMap[S.uuid]=S,S}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onChange",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Bn),yi=function(A){function n(v,S){var E=A.call(this,v)||this;return E.type="onClick",ni.handlerMap[E.uuid]=E,S&&(E.showFeedback=!(!1===S.showFeedback),S.button&&(E.button=S.button),S.hoverText&&(E.hoverText=S.hoverText),S.distance&&(E.distance=S.distance)),E}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onClick",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(kn),fi=function(A){function n(v,S){var E=A.call(this,v)||this;return E.type="pointerDown",ni.handlerMap[E.uuid]=E,S&&(E.showFeedback=!(!1===S.showFeedback),S.button&&(E.button=S.button),S.hoverText&&(E.hoverText=S.hoverText),S.distance&&(E.distance=S.distance)),E}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerDown",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(kn),gi=function(A){function n(v,S){var E=A.call(this,v)||this;return E.type="pointerUp",ni.handlerMap[E.uuid]=E,S&&(E.showFeedback=!(!1===S.showFeedback),S.button&&(E.button=S.button),S.hoverText&&(E.hoverText=S.hoverText),S.distance&&(E.distance=S.distance)),E}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerUp",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(kn),mi=function(A){function n(v,S){var E=A.call(this,v)||this;return E.type="pointerHoverEnter",ni.handlerMap[E.uuid]=E,S&&S.distance&&(E.distance=S.distance),E}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerHoverEnter",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(kn),vi=function(A){function n(v){var S=A.call(this,v)||this;return S.type="pointerHoverExit",ni.handlerMap[S.uuid]=S,S.distance=160,S}return i(n,A),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerHoverExit",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(kn),bi=function(v){function e(A){var S=v.call(this)||this;return S.name=null,S.visible=!0,S.opacity=1,S.hAlign="center",S.vAlign="center",S.width="100px",S.height="50px",S.positionX="0px",S.positionY="0px",S.isPointerBlocker=!0,A&&(S._parent=A,S.data.parentComponent=D(A)),S}return i(e,v),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentComponent",{get:function(){return this.data.parentComponent},enumerable:!1,configurable:!0}),r([K.field,s("design:type",Object)],e.prototype,"name",void 0),r([K.field,s("design:type",Boolean)],e.prototype,"visible",void 0),r([K.field,s("design:type",Number)],e.prototype,"opacity",void 0),r([K.field,s("design:type",String)],e.prototype,"hAlign",void 0),r([K.field,s("design:type",String)],e.prototype,"vAlign",void 0),r([K.uiValue,s("design:type",Object)],e.prototype,"width",void 0),r([K.uiValue,s("design:type",Object)],e.prototype,"height",void 0),r([K.uiValue,s("design:type",Object)],e.prototype,"positionX",void 0),r([K.uiValue,s("design:type",Object)],e.prototype,"positionY",void 0),r([K.field,s("design:type",Boolean)],e.prototype,"isPointerBlocker",void 0),e}(K),wi=function(A){function n(){return A.call(this,null)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.UI_FULLSCREEN_SHAPE),s("design:paramtypes",[])],n)}(bi),Ti=function(A){function n(){return A.call(this,null)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.UI_WORLD_SPACE_SHAPE),s("design:paramtypes",[])],n)}(bi),xi=function(A){function n(){return A.call(this,null)||this}return i(n,A),r([N("engine.shape",v.CLASS_ID.UI_SCREEN_SPACE_SHAPE),s("design:paramtypes",[])],n)}(bi),Ci=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.thickness=0,v.color=Pt.Color4.Clear(),v.alignmentUsesSize=!0,v}return i(n,A),r([K.field,s("design:type",Number)],n.prototype,"thickness",void 0),r([K.field,s("design:type",Pt.Color4)],n.prototype,"color",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"alignmentUsesSize",void 0),r([N("engine.shape",v.CLASS_ID.UI_CONTAINER_RECT)],n)}(bi);v.UIStackOrientation=void 0,(si=v.UIStackOrientation||(v.UIStackOrientation={}))[si.VERTICAL=0]="VERTICAL",si[si.HORIZONTAL=1]="HORIZONTAL";var _i=function(A){function n(){var S=null!==A&&A.apply(this,arguments)||this;return S.adaptWidth=!0,S.adaptHeight=!0,S.color=Pt.Color4.Clear(),S.stackOrientation=v.UIStackOrientation.VERTICAL,S.spacing=0,S}return i(n,A),r([K.field,s("design:type",Boolean)],n.prototype,"adaptWidth",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"adaptHeight",void 0),r([K.field,s("design:type",Pt.Color4)],n.prototype,"color",void 0),r([K.field,s("design:type",Number)],n.prototype,"stackOrientation",void 0),r([K.field,s("design:type",Number)],n.prototype,"spacing",void 0),r([N("engine.shape",v.CLASS_ID.UI_CONTAINER_STACK)],n)}(bi),Ai=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.fontSize=10,v.fontWeight="normal",v.thickness=0,v.cornerRadius=0,v.color=Pt.Color4.White(),v.background=Pt.Color4.White(),v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v.shadowBlur=0,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowColor=Pt.Color4.Black(),v.text="button",v}return i(n,A),r([K.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([K.field,s("design:type",String)],n.prototype,"fontWeight",void 0),r([K.field,s("design:type",Number)],n.prototype,"thickness",void 0),r([K.field,s("design:type",Number)],n.prototype,"cornerRadius",void 0),r([K.field,s("design:type",Pt.Color4)],n.prototype,"color",void 0),r([K.field,s("design:type",Pt.Color4)],n.prototype,"background",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([K.field,s("design:type",Pt.Color4)],n.prototype,"shadowColor",void 0),r([K.field,s("design:type",String)],n.prototype,"text",void 0),r([N("engine.shape",v.CLASS_ID.UI_BUTTON_SHAPE)],n)}(bi),Si=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.outlineWidth=0,v.outlineColor=Pt.Color4.White(),v.color=Pt.Color4.White(),v.fontSize=10,v.fontAutoSize=!1,v.value="",v.lineSpacing=0,v.lineCount=0,v.adaptWidth=!1,v.adaptHeight=!1,v.textWrapping=!1,v.shadowBlur=0,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowColor=Pt.Color4.Black(),v.hTextAlign="left",v.vTextAlign="bottom",v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v}return i(n,A),r([K.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([K.field,s("design:type",Pt.Color4)],n.prototype,"outlineColor",void 0),r([K.field,s("design:type",Pt.Color4)],n.prototype,"color",void 0),r([K.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"fontAutoSize",void 0),r([K.component,s("design:type",Dn)],n.prototype,"font",void 0),r([K.field,s("design:type",String)],n.prototype,"value",void 0),r([K.field,s("design:type",Number)],n.prototype,"lineSpacing",void 0),r([K.field,s("design:type",Number)],n.prototype,"lineCount",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"adaptWidth",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"adaptHeight",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([K.field,s("design:type",Pt.Color4)],n.prototype,"shadowColor",void 0),r([K.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([K.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([N("engine.shape",v.CLASS_ID.UI_TEXT_SHAPE)],n)}(bi),Ei=function(A){function n(v){var S=A.call(this,v)||this;return S.outlineWidth=0,S.outlineColor=Pt.Color4.Black(),S.color=Pt.Color4.Clear(),S.fontSize=10,S.value="",S.placeholder="",S.margin=10,S.hTextAlign="left",S.vTextAlign="bottom",S.focusedBackground=Pt.Color4.Black(),S.textWrapping=!1,S.shadowBlur=0,S.shadowOffsetX=0,S.shadowOffsetY=0,S.shadowColor=Pt.Color4.White(),S.paddingTop=0,S.paddingRight=0,S.paddingBottom=0,S.paddingLeft=0,S.onTextSubmit=null,S.onChanged=null,S.onFocus=null,S.onBlur=null,S.onTextChanged=new pi((function(v){var A=v.value,E=A.value,R=A.isSubmit,I=S.dirty;if(S.value=E,S.dirty=I,R&&S.onTextSubmit){var O={text:E};S.onTextSubmit.callback(O)}else if(!R&&S.onChanged){var z={value:E,pointerId:v.pointerId};S.onChanged.callback(z)}})),S}return i(n,A),r([K.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([K.field,s("design:type",Pt.Color4)],n.prototype,"outlineColor",void 0),r([K.field,s("design:type",Pt.Color4)],n.prototype,"color",void 0),r([K.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([K.component,s("design:type",Dn)],n.prototype,"font",void 0),r([K.field,s("design:type",String)],n.prototype,"value",void 0),r([K.field,s("design:type",String)],n.prototype,"placeholder",void 0),r([K.field,s("design:type",Number)],n.prototype,"margin",void 0),r([K.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([K.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([K.field,s("design:type",Pt.Color4)],n.prototype,"focusedBackground",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([K.field,s("design:type",Pt.Color4)],n.prototype,"shadowColor",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([Bn.uuidEvent,s("design:type",pi)],n.prototype,"onTextChanged",void 0),r([Bn.uuidEvent,s("design:type",Object)],n.prototype,"onFocus",void 0),r([Bn.uuidEvent,s("design:type",Object)],n.prototype,"onBlur",void 0),r([N("engine.shape",v.CLASS_ID.UI_INPUT_TEXT_SHAPE),s("design:paramtypes",[Object])],n)}(bi),Pi=function(A){function n(v,S){var E=A.call(this,v)||this;return E.sourceLeft=0,E.sourceTop=0,E.sourceWidth=1,E.sourceHeight=1,E.paddingTop=0,E.paddingRight=0,E.paddingBottom=0,E.paddingLeft=0,E.sizeInPixels=!0,E.onClick=null,E.source=S,E}return i(n,A),r([K.field,s("design:type",Number)],n.prototype,"sourceLeft",void 0),r([K.field,s("design:type",Number)],n.prototype,"sourceTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"sourceWidth",void 0),r([K.field,s("design:type",Number)],n.prototype,"sourceHeight",void 0),r([K.component,s("design:type",Object)],n.prototype,"source",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"sizeInPixels",void 0),r([Bn.uuidEvent,s("design:type",Object)],n.prototype,"onClick",void 0),r([N("engine.shape",v.CLASS_ID.UI_IMAGE_SHAPE),s("design:paramtypes",[bi,Object])],n)}(bi),Ii=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.valueX=0,v.valueY=0,v.backgroundColor=Pt.Color4.Clear(),v.isHorizontal=!1,v.isVertical=!1,v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v.onChanged=null,v}return i(n,A),r([K.field,s("design:type",Number)],n.prototype,"valueX",void 0),r([K.field,s("design:type",Number)],n.prototype,"valueY",void 0),r([K.field,s("design:type",Pt.Color4)],n.prototype,"backgroundColor",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"isHorizontal",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"isVertical",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([Bn.uuidEvent,s("design:type",Object)],n.prototype,"onChanged",void 0),r([N("engine.shape",v.CLASS_ID.UI_SLIDER_SHAPE)],n)}(bi),Oi=function(A){function n(){var v=null!==A&&A.apply(this,arguments)||this;return v.useDummyModel=!1,v.talking=!1,v}var S;return i(n,A),S=n,n.Dummy=function(){var v=new S;return v.useDummyModel=!0,v},r([K.field,s("design:type",String)],n.prototype,"id",void 0),r([K.field,s("design:type",String)],n.prototype,"name",void 0),r([K.field,s("design:type",String)],n.prototype,"expressionTriggerId",void 0),r([K.field,s("design:type",Number)],n.prototype,"expressionTriggerTimestamp",void 0),r([K.field,s("design:type",String)],n.prototype,"bodyShape",void 0),r([K.field,s("design:type",Array)],n.prototype,"wearables",void 0),r([K.field,s("design:type",Array)],n.prototype,"emotes",void 0),r([K.field,s("design:type",Object)],n.prototype,"skinColor",void 0),r([K.field,s("design:type",Object)],n.prototype,"hairColor",void 0),r([K.field,s("design:type",Object)],n.prototype,"eyeColor",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"useDummyModel",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"talking",void 0),S=r([P("engine.avatarShape",v.CLASS_ID.AVATAR_SHAPE)],n)}(K),Di=null,Ni=null,zi=null;function Ri(){return zi||(zi=new st),zi}var Mi=function(){function t(){var v=this;this.messageQueue=[],this.connected=!1,this.flushing=!1,function(){if(!Ni){(Ni=dcl.loadModule("@decentraland/CommunicationsController",{})).then((function(v){Di=v}));var v=Ri();dcl.subscribe("comms"),dcl.onEvent((function(A){"comms"===A.type&&v.notifyObservers(A.data)}))}return Ni}().then((function(){v.connected=!0,v.flush()}))}return t.prototype.on=function(v,A){return Ri().add((function(S){try{var E=JSON.parse(S.message);E.message===v&&A(E.payload,S.sender)}catch(S){dcl.error("Error parsing comms message "+(S.message||""),S)}}))},t.prototype.sendRaw=function(v){this.messageQueue.push(v),this.connected&&this.flush()},t.prototype.emit=function(v,A){var S=JSON.stringify({message:v,payload:A});this.sendRaw(S),Ri().notifyObservers({message:S,sender:"self"})},t.prototype.flush=function(){var v=this;if(0!==this.messageQueue.length&&this.connected&&Di&&!this.flushing){var A=this.messageQueue.shift();this.flushing=!0,dcl.callRpc(Di.rpcHandle,"send",[A]).then((function(A){v.flushing=!1,v.flush()}),(function(A){v.flushing=!1,y("Error flushing MessageBus",A)}))}},t}(),Li=new J("scene");Li.uuid="0";var Fi=new $(Li);N.engine=Fi,"undefined"!=typeof dcl&&(Fi.addSystem(new St(dcl),1/0),mt(dcl)),Fi.addSystem(ni),Fi.addSystem(ei),Fi.addSystem(ti),v.AVATAR_OBSERVABLE="AVATAR_OBSERVABLE",v.Angle=Pt.Angle,v.AnimationState=an,v.Animator=In,v.Arc2=Pt.Arc2,v.AttachToAvatar=mn,v.Attachable=A,v.AudioClip=ii,v.AudioSource=oi,v.AudioStream=ri,v.AvatarModifierArea=yn,v.AvatarShape=Oi,v.AvatarTexture=qn,v.Axis=Pt.Axis,v.BasicMaterial=Fn,v.BezierCurve=Pt.BezierCurve,v.Billboard=vn,v.BoxShape=wn,v.Camera=Yn,v.CameraModeArea=Xn,v.CircleShape=xn,v.Color3=Pt.Color3,v.Color4=Pt.Color4,v.Component=P,v.ComponentAdded=z,v.ComponentGroup=Z,v.ComponentRemoved=O,v.ConeShape=_n,v.Curve3=Pt.Curve3,v.CylinderShape=An,v.DEG2RAD=Pt.DEG2RAD,v.DisposableComponent=N,v.DisposableComponentCreated=W,v.DisposableComponentRemoved=X,v.DisposableComponentUpdated=Q,v.Engine=$,v.Entity=J,v.Epsilon=Pt.Epsilon,v.EventConstructor=x,v.EventManager=R,v.Font=Dn,v.Frustum=Pt.Frustum,v.GLTFShape=Sn,v.Gizmos=li,v.GlobalPointerDown=cn,v.GlobalPointerUp=un,v.Input=dn,v.Material=Ln,v.Matrix=Pt.Matrix,v.MessageBus=Mi,v.MultiObserver=rt,v.NFTShape=Rn,v.OBJShape=On,v.Observable=st,v.ObservableComponent=K,v.Observer=Y,v.ObserverEventState=ot,v.OnAnimationEnd=Un,v.OnBlur=ui,v.OnChanged=pi,v.OnClick=yi,v.OnEnter=di,v.OnFocus=hi,v.OnGizmoEvent=ai,v.OnPointerDown=fi,v.OnPointerHoverEnter=mi,v.OnPointerHoverExit=vi,v.OnPointerLock=Hn,v.OnPointerUUIDEvent=kn,v.OnPointerUp=gi,v.OnTextSubmit=ci,v.OnUUIDEvent=Bn,v.Orientation=Pt.Orientation,v.ParentChanged=M,v.Path2=Pt.Path2,v.Path3D=Pt.Path3D,v.PhysicsCast=Kn,v.Plane=Pt.Plane,v.PlaneShape=Cn,v.PointerEvent=ht,v.PointerEventComponent=Ke,v.PointerEventSystem=Jn,v.Quaternion=Pt.Quaternion,v.RAD2DEG=Pt.RAD2DEG,v.RaycastEventSystem=Zn,v.RaycastResponse=lt,v.Scalar=Pt.Scalar,v.Shape=bn,v.Size=Pt.Size,v.SmartItem=Vn,v.Space=Pt.Space,v.SphereShape=Tn,v.Subscription=en,v.TextShape=zn,v.Texture=Pn,v.ToGammaSpace=Pt.ToGammaSpace,v.ToLinearSpace=Pt.ToLinearSpace,v.Transform=fn,v.UIButton=Ai,v.UICanvas=xi,v.UIContainerRect=Ci,v.UIContainerStack=_i,v.UIFullScreen=wi,v.UIImage=Pi,v.UIInputText=Ei,v.UIScrollRect=Ii,v.UIShape=bi,v.UIText=Si,v.UIValue=B,v.UIWorldSpace=Ti,v.UUIDEvent=at,v.UUIDEventSystem=$n,v.Vector2=Pt.Vector2,v.Vector3=Pt.Vector3,v.Vector4=Pt.Vector4,v.VideoClip=Wn,v.VideoTexture=Gn,v._initEventObservables=mt,v.buildArray=function(v,A){for(var S=[],E=0;E<v;++E)S.push(A());return S},v.engine=Fi,v.error=y,v.executeTask=G,v.getComponentClassId=L,v.getComponentId=D,v.getComponentName=F,v.getMessageObserver=Ri,v.isDisposableComponent=U,v.log=u,v.newId=f,v.onCameraModeChangedObservable=ct,v.onEnterScene=pt,v.onEnterSceneObservable=dt,v.onIdleStateChangedObservable=ut,v.onLeaveScene=ft,v.onLeaveSceneObservable=yt,v.onPlayerClickedObservable=At,v.onPlayerConnectedObservable=xt,v.onPlayerDisconnectedObservable=Ct,v.onPlayerExpressionObservable=vt,v.onPointerLockedStateChange=bt,v.onProfileChanged=Tt,v.onRealmChangedObservable=_t,v.onSceneReadyObservable=gt,v.onVideoEvent=wt,v.openExternalURL=function(v){"undefined"!=typeof dcl?dcl.openExternalUrl(v):y("ERROR: openExternalURL dcl is undefined")},v.openNFTDialog=function(v,A){if(void 0===A&&(A=null),"undefined"!=typeof dcl){var S=v.match(/ethereum:\/\/(.+)\/(.+)/);if(!S||S.length<3)return;dcl.openNFTDialog(S[1],S[2],A)}else y("ERROR: openNFTDialog dcl is undefined")},v.pointerEventSystem=ei,v.raycastEventSystem=ti,v.teleportTo=function(v){var A;A=[v],void 0===nt&&"undefined"!=typeof dcl&&(nt=dcl.loadModule("@decentraland/UserActionModule",{})),void 0!==nt&&"undefined"!=typeof dcl&&nt.then((function(v){dcl.callRpc(v.rpcHandle,"requestTeleport",A)}))},v.uuid=m,v.uuidEventSystem=ni,Object.defineProperty(v,"__esModule",{value:!0})}(this.self=this.self||{}),function(v,A){"object"==typeof exports&&"undefined"!=typeof module?A(exports):"function"==typeof define&&define.amd?define("@dcl/npc-scene-utils",["exports"],A):A((v="undefined"!=typeof globalThis?globalThis:v||self)["@dcl/npc-scene-utils"]={})}(this,(function(v){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var e=function(v,A){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,A){v.__proto__=A}||function(v,A){for(var S in A)Object.prototype.hasOwnProperty.call(A,S)&&(v[S]=A[S])})(v,A)};function i(v,A){function o(){this.constructor=v}e(v,A),v.prototype=null===A?Object.create(A):(o.prototype=A.prototype,new o)}function o(v,A,S,E){var R,I=arguments.length,O=I<3?A:null===E?E=Object.getOwnPropertyDescriptor(A,S):E;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)O=Reflect.decorate(v,A,S,E);else for(var z=v.length-1;z>=0;z--)(R=v[z])&&(O=(I<3?R(O):I>3?R(A,S,O):R(A,S))||O);return I>3&&O&&Object.defineProperty(A,S,O),O}function n(v){var A="function"==typeof Symbol&&Symbol.iterator,S=A&&v[A],E=0;if(S)return S.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}var A=o([Component("trackUserFlag")],(function(v,A,E){this.lockXZRotation=!1,this.active=!1,S||(S=!0,engine.addSystem(new R)),this.lockXZRotation=v||!1,this.rotSpeed=A||2,E&&(this.active=!0)})),S=!1,E=Camera.instance,R=function(){function t(){this.followingNPCs=engine.getComponentGroup(A)}return t.prototype.update=function(v){var S,R;try{for(var I=n(this.followingNPCs.entities),O=I.next();!O.done;O=I.next()){var z=O.value,M=z.getComponent(Transform),B=z.getComponent(A);if(B.active){var k=new Vector3(E.position.x,E.position.y,E.position.z).subtract(M.position);M.rotation=Quaternion.Slerp(M.rotation,Quaternion.LookRotation(k),v*B.rotSpeed),B.lockXZRotation&&(M.rotation.x=0,M.rotation.z=0)}}}catch(v){S={error:v}}finally{try{O&&!O.done&&(R=I.return)&&R.call(I)}finally{if(S)throw S.error}}},t}(),I=new UICanvas;I.visible=!0;var O,z,M=new Font(Fonts.SanFrancisco),B=new Font(Fonts.SanFrancisco_Heavy),k=new Texture("https://decentraland.org/images/ui/light-atlas-v3.png"),H=new Texture("https://decentraland.org/images/ui/dark-atlas-v3.png"),V=new Texture("https://decentraland.org/images/ui/dialog-bubbles.png");function b(v,A,S,E){void 0===S&&(S=512),void 0===E&&(E=512),function(v,A,S,E,R){v.uvs=[A.x,A.y,S.x,S.y,E.x,E.y,R.x,R.y,A.x,A.y,S.x,S.y,E.x,E.y,R.x,R.y]}(v,new Vector2(A.sourceLeft/S,(E-A.sourceTop-A.sourceHeight)/E),new Vector2((A.sourceLeft+A.sourceWidth)/S,(E-A.sourceTop-A.sourceHeight)/E),new Vector2((A.sourceLeft+A.sourceWidth)/S,(E-A.sourceTop)/E),new Vector2(A.sourceLeft/S,(E-A.sourceTop)/E))}function T(v,A){v.sourceWidth=A.sourceWidth,v.sourceHeight=A.sourceHeight,v.sourceLeft=A.sourceLeft?A.sourceLeft:0,v.sourceTop=A.sourceTop?A.sourceTop:0}function C(v){var A=-10-4*v;return A>-65?A:-65}(O=v.ButtonStyles||(v.ButtonStyles={})).E="e",O.F="f",O.DARK="dark",O.RED="red",O.ROUNDBLACK="roundblack",O.ROUNDWHITE="roundwhite",O.ROUNDSILVER="roundsilver",O.ROUNDGOLD="roundgold",O.SQUAREBLACK="squareblack",O.SQUAREWHITE="squarewhite",O.SQUARESILVER="squaresilver",O.SQUAREGOLD="squaregold",O.WHITE="white",(z=v.NPCState||(v.NPCState={})).STANDING="standing",z.TALKING="talking",z.FOLLOWPATH="followPath";var W,X={buttons:{buttonE:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},buttonF:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},white:{sourceWidth:174,sourceHeight:46,sourceLeft:698,sourceTop:662},buttonRed:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},buttonDark:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},roundBlack:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:458},squareBlack:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:457},roundWhite:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:494},squareWhite:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:493},roundSilver:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:531},squareSilver:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:531},roundGold:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:567},squareGold:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:567}},buttonLabels:{E:{sourceWidth:26,sourceHeight:26,sourceLeft:697,sourceTop:611},F:{sourceWidth:26,sourceHeight:26,sourceLeft:733,sourceTop:611},EBlack:{sourceWidth:26,sourceHeight:26,sourceLeft:766,sourceTop:611},FBlack:{sourceWidth:26,sourceHeight:26,sourceLeft:802,sourceTop:611}},backgrounds:{promptBackground:{sourceWidth:416,sourceHeight:352,sourceLeft:501,sourceTop:12},promptLargeBackground:{sourceWidth:480,sourceHeight:384,sourceLeft:7,sourceTop:12},promptSlantedBackground:{sourceWidth:486,sourceHeight:326,sourceLeft:7,sourceTop:413},NPCDialog:{sourceWidth:766,sourceHeight:248,sourceLeft:22,sourceTop:756}},icons:{closeW:{sourceWidth:32,sourceHeight:32,sourceLeft:942,sourceTop:306},closeD:{sourceWidth:32,sourceHeight:32,sourceLeft:986,sourceTop:306},closeWLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:512,sourceTop:381},closeDLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:583,sourceTop:381},closeWNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:252},closeDNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:214},closeWNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:214},closeDNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:260},FDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:4},FWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:4},EDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:40},EWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:40},Timer:{sourceWidth:24,sourceHeight:32.2,sourceLeft:718,sourceTop:388},TimerLarge:{sourceWidth:48,sourceHeight:68,sourceLeft:662,sourceTop:386},ClickWhite:{sourceWidth:32,sourceHeight:48,sourceLeft:799,sourceTop:389},ClickDark:{sourceWidth:32,sourceHeight:48,sourceLeft:757,sourceTop:389}},checkboxes:{wOff:{sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:76},wOn:{sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:104},dOff:{sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:76},dOn:{sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:104},wLargeOff:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:132},wLargeOn:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:168},dLargeOff:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:132},dLargeOn:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:168}},switches:{roundOff:{sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:454},roundRed:{sourceWidth:64,sourceHeight:32,sourceLeft:853,sourceTop:454},roundGreen:{sourceWidth:64,sourceHeight:32,sourceLeft:923,sourceTop:454},squareOff:{sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:501},squareRed:{sourceWidth:64,sourceHeight:32,sourceLeft:852,sourceTop:501},squareGreen:{sourceWidth:64,sourceHeight:32,sourceLeft:921,sourceTop:501}},bubbles:{short:{sourceWidth:232,sourceHeight:168,sourceLeft:610,sourceTop:834},normal:{sourceWidth:572,sourceHeight:168,sourceLeft:16,sourceTop:834},long:{sourceWidth:994,sourceHeight:306,sourceLeft:12,sourceTop:508},huge:{sourceWidth:994,sourceHeight:478,sourceLeft:12,sourceTop:14}}},Q=function(){function t(A,S){var E=this;Z.createAndAddToEngine(),this.elapsedTime=0,this.targetTime=A,this.onTimeReachedCallback=S,this.onTargetTimeReached=function(A){E.onTimeReachedCallback(),A.removeComponent(v)}}var v;return v=t,t.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=o([Component("npcTimerDelay")],t)}(),K=engine.getComponentGroup(Q),Z=function(){function t(){t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){var A,S;try{for(var E=n(K.entities),R=E.next();!R.done;R=E.next()){var I=R.value,O=I.getComponent(Q);O.elapsedTime+=v,O.elapsedTime>=O.targetTime&&O.onTargetTimeReached(I)}}catch(v){A={error:v}}finally{try{R&&!R.done&&(S=E.return)&&S.call(E)}finally{if(A)throw A.error}}},t._instance=null,t}();!function(v){v[v.Confirm=0]="Confirm",v[v.Cancel=1]="Cancel",v[v.Next=2]="Next",v[v.Button3=3]="Button3",v[v.Button4=4]="Button4"}(W||(W={}));var J=.75,$=-262.5,et=262.5,nt=37.5,it=192,ot=192,rt=7.5,st=112.5,at=112.5,lt=-48.75,ht=-48.75,ct=19.5,ut=19.5,dt=function(){function e(A,S,E,R){var O=this;this.NPCScript=[],this.isDialogOpen=!1,this.isQuestionPanel=!1,this.isFixedScreen=!1,this.activeTextId=0,this.UIOpenTime=0,this.defaultSound=null,this.canvas=I,this.ClickAction=null,this.EButtonAction=null,this.FButtonAction=null,this.defaultPortrait=A||null,this.uiTheme=R||(S?H:k),this.container=new UIContainerRect(I),this.container.adaptWidth=!0,this.container.width="100%",this.container.vAlign="bottom",this.container.positionY=105,this.container.visible=!1,this.panel=new UIImage(this.container,this.uiTheme),T(this.panel,X.backgrounds.NPCDialog),this.panel.width=574.5,this.panel.height=186,this.panel.onClick=new OnClick((function(){O.confirmText(W.Next)})),this.defaultPortraitTexture=new Texture(A?A.path:this.uiTheme.src),this.portrait=new UIImage(this.container,this.defaultPortraitTexture),this.portrait.sourceWidth=A&&A.section?A.section.sourceWidth:256,this.portrait.sourceHeight=A&&A.section?A.section.sourceHeight:256,this.portrait.width=A&&A.width?A.width*J:it,this.portrait.height=A&&A.height?A.height*J:it,this.portrait.positionX=A&&A.offsetX?A.offsetX*J+$:$,this.portrait.positionY=A&&A.offsetY?A.offsetY*J+0:0,this.portrait.onClick=new OnClick((function(){O.confirmText(W.Next)})),this.image=new UIImage(this.container,new Texture(this.uiTheme.src)),this.image.sourceWidth=256,this.image.sourceHeight=256,this.image.sourceTop=0,this.image.sourceLeft=0,this.image.width=ot,this.image.height=ot,this.image.positionX=et,this.image.positionY=nt,this.image.onClick=new OnClick((function(){O.confirmText(W.Next)})),this.text=new UIText(this.container),this.text.adaptWidth=!1,this.text.textWrapping=!0,this.text.width=345,this.text.positionX=30,this.text.hAlign="center",this.text.vAlign="center",this.text.font=B,this.text.fontSize=18,this.text.hTextAlign="left",this.text.vTextAlign="center",this.text.positionY=rt,this.text.fontWeight="normal",this.text.color=S?Color4.White():Color4.Black(),this.text.isPointerBlocker=!1,this.soundEnt=new Entity,this.soundEnt.addComponent(new Transform),engine.addEntity(this.soundEnt),this.soundEnt.setParent(Attachable.AVATAR),E&&(this.soundEnt.addComponent(new AudioSource(new AudioClip(E))),this.soundEnt.getComponent(AudioSource).volume=.5,this.defaultSound=E),this.button1=new yt(this.container,this.uiTheme,"yes",st,lt,(function(){O.confirmText(W.Confirm)}),!1,v.ButtonStyles.E),this.button1.hide(),this.button2=new yt(this.container,this.uiTheme,"no",-60,ht,(function(){O.confirmText(W.Cancel)}),!1,v.ButtonStyles.F),this.button2.hide(),this.button3=new yt(this.container,this.uiTheme,"maybe",-60,-60,(function(){O.confirmText(W.Button3)}),!1,v.ButtonStyles.DARK),this.button3.hide(),this.button4=new yt(this.container,this.uiTheme,"maybe",at,-60,(function(){O.confirmText(W.Button4)}),!1,v.ButtonStyles.DARK),this.button4.hide(),this.skipButton=new yt(this.container,this.uiTheme,"Skip",-225,-75,(function(){O.skipDialogs()}),!1,H?v.ButtonStyles.WHITE:v.ButtonStyles.F),this.skipButton.image.width=60,this.skipButton.image.height=22.5,this.skipButton.label.hTextAlign="left",this.skipButton.label.fontSize=9,this.skipButton.label.positionX=30,this.skipButton.label.font=B,this.skipButton.icon.height=15,this.skipButton.icon.width=15,this.skipButton.icon.positionX=-15,this.skipButton.hide(),this.leftClickIcon=new UIImage(this.container,this.uiTheme),this.leftClickIcon.width=24,this.leftClickIcon.height=36,this.leftClickIcon.positionX=255,this.leftClickIcon.positionY=-60,this.leftClickIcon.visible=!1,T(this.leftClickIcon,S?X.icons.ClickDark:X.icons.ClickWhite),pt.createAndAddToEngine()}return e.prototype.openDialogWindow=function(v,A){var S=this;this.UIOpenTime=+Date.now(),this.NPCScript=v,this.activeTextId=A?"number"==typeof A?A:F(v,A):0;var E=v[this.activeTextId]?v[this.activeTextId]:{text:""};if(E.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(E.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),E.portrait?(this.portrait.source=new Texture(E.portrait.path),this.portrait.positionX=E.portrait.offsetX?E.portrait.offsetX*J+$:$,this.portrait.positionY=E.portrait.offsetY?E.portrait.offsetY*J+0:0,this.portrait.width=E.portrait.width?E.portrait.width*J:it,this.portrait.height=E.portrait.height?E.portrait.height*J:it,E.portrait.section&&T(this.portrait,E.portrait.section),this.portrait.visible=!0):this.defaultPortrait?(this.portrait.source=this.defaultPortraitTexture,this.portrait.positionX=this.defaultPortrait&&this.defaultPortrait.offsetX?this.defaultPortrait.offsetX*J+$:$,this.portrait.positionY=this.defaultPortrait&&this.defaultPortrait.offsetY?this.defaultPortrait.offsetY*J+0:0,this.portrait.width=this.defaultPortrait&&this.defaultPortrait.width?this.defaultPortrait.width*J:it,this.portrait.height=this.defaultPortrait&&this.defaultPortrait.height?this.defaultPortrait.height*J:it,this.defaultPortrait.section&&T(this.portrait,this.defaultPortrait.section),this.portrait.visible=!0):(log("No portrait"),this.portrait.visible=!1),E.image){var R=E.image;log("setting image to ",R.path),this.image.source=new Texture(R.path),this.image.positionX=R.offsetX?R.offsetX*J+et:et,this.image.positionY=R.offsetY?R.offsetY*J+nt:nt,this.image.width=R.width?R.width*J:ot,this.portrait.height=R.height?R.height*J:ot,R.section&&T(this.image,R.section),this.image.visible=!0}else this.image.visible=!1;this.text.fontSize=E.fontSize?E.fontSize*J:18,this.text.positionY=E.offsetY?E.offsetY*J+rt:rt,this.text.positionX=E.offsetX?E.offsetX*J:0,this.text.visible=!0,this.container.visible=!0,pt._instance.newText(this,E.text,this.activeTextId,E.typeSpeed?E.typeSpeed:void 0),this.ClickAction||(this.ClickAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.POINTER,!1,(function(v){!S.isDialogOpen||+Date.now()-S.UIOpenTime<100||(pt._instance.done?S.isQuestionPanel||S.isFixedScreen||S.confirmText(W.Next):pt._instance.rush())})),this.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){S.isDialogOpen&&S.isQuestionPanel&&pt._instance.done&&+Date.now()-S.UIOpenTime>100&&S.confirmText(W.Confirm)})),this.FButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){S.isDialogOpen&&S.isQuestionPanel&&pt._instance.done&&+Date.now()-S.UIOpenTime>100?S.confirmText(W.Cancel):S.isDialogOpen&&E.skipable&&+Date.now()-S.UIOpenTime>100&&S.skipDialogs()}))),this.layoutDialogWindow(this.activeTextId),this.isDialogOpen=!0},e.prototype.confirmText=function(v){var A=this.NPCScript[this.activeTextId];if(v==W.Next&&!A.isQuestion){if(A.triggeredByNext&&A.triggeredByNext(),A.isEndOfDialog)return void this.closeDialogWindow();this.activeTextId++}v==W.Confirm&&A.buttons&&A.buttons.length>=1&&("number"==typeof A.buttons[0].goToDialog?this.activeTextId=A.buttons[0].goToDialog:this.activeTextId=F(this.NPCScript,A.buttons[0].goToDialog),A.buttons[0].triggeredActions&&A.buttons[0].triggeredActions()),v==W.Cancel&&A.buttons&&A.buttons.length>=2&&("number"==typeof A.buttons[1].goToDialog?this.activeTextId=A.buttons[1].goToDialog:this.activeTextId=F(this.NPCScript,A.buttons[1].goToDialog),A.buttons[1].triggeredActions&&A.buttons[1].triggeredActions()),v==W.Button3&&A.buttons&&A.buttons.length>=3&&("number"==typeof A.buttons[2].goToDialog?this.activeTextId=A.buttons[2].goToDialog:this.activeTextId=F(this.NPCScript,A.buttons[2].goToDialog),A.buttons[2].triggeredActions&&A.buttons[2].triggeredActions()),v==W.Button4&&A.buttons&&A.buttons.length>=4&&("number"==typeof A.buttons[3].goToDialog?this.activeTextId=A.buttons[3].goToDialog:this.activeTextId=F(this.NPCScript,A.buttons[3].goToDialog),A.buttons[3].triggeredActions&&A.buttons[3].triggeredActions()),A=this.NPCScript[this.activeTextId],pt._instance.newText(this,A.text,this.activeTextId,A.typeSpeed?A.typeSpeed:void 0)},e.prototype.layoutDialogWindow=function(v){var A=this,S=this.NPCScript[v]?this.NPCScript[v]:{text:""},E=S.offsetY?S.offsetY*J+rt:rt;if(S.buttons&&S.buttons.length>=3?E+=37.5:S.buttons&&S.buttons.length>=1&&(E+=18),this.text.fontSize=S.fontSize?S.fontSize*J:18,this.text.positionY=E,S.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(S.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),S.portrait?(this.portrait.source=new Texture(S.portrait.path),this.portrait.positionX=S.portrait.offsetX?S.portrait.offsetX*J+$:$,this.portrait.positionY=S.portrait.offsetY?S.portrait.offsetY*J+0:0,this.portrait.width=S.portrait.width?S.portrait.width*J:it,this.portrait.height=S.portrait.height?S.portrait.height*J:it,S.portrait.section&&T(this.portrait,S.portrait.section),this.portrait.visible=!0):this.defaultPortrait?(this.portrait.source=new Texture(this.defaultPortrait.path),this.portrait.positionX=this.defaultPortrait&&this.defaultPortrait.offsetX?this.defaultPortrait.offsetX*J+$:$,this.portrait.positionY=this.defaultPortrait&&this.defaultPortrait.offsetY?this.defaultPortrait.offsetY*J+0:0,this.portrait.width=this.defaultPortrait&&this.defaultPortrait.width?this.defaultPortrait.width*J:it,this.portrait.height=this.defaultPortrait&&this.defaultPortrait.height?this.defaultPortrait.height*J:it,this.defaultPortrait.section&&T(this.portrait,this.defaultPortrait.section),this.portrait.visible=!0):(log("No portrait"),this.portrait.visible=!1),this.image.visible=!1,S.image){var R=S.image;log("setting image to ",R.path),this.image.source=new Texture(R.path),this.image.positionX=R.offsetX?R.offsetX*J+et:et,this.image.positionY=R.offsetY?R.offsetY*J+nt:nt,this.image.width=S.image.width?S.image.width*J:ot,this.image.height=S.image.height?S.image.height*J:ot,R.section&&T(this.image,R.section),this.image.visible=!0}else this.image.visible=!1;this.isQuestionPanel=!!S.isQuestion&&S.isQuestion,this.isFixedScreen=!!S.isFixedScreen&&S.isFixedScreen,this.button1.hide(),this.button2.hide(),this.button3.hide(),this.button4.hide(),this.leftClickIcon.visible=!1,S.isQuestion?(this.skipButton.hide(),S.buttons&&S.buttons.length>=1&&this.button1.update(S.buttons[0].label,S.buttons[0].offsetX?S.buttons[0].offsetX*J+st:st,S.buttons.length>=3?S.buttons[0].offsetY?S.buttons[0].offsetY*J-15:-15:S.buttons[0].offsetY?S.buttons[0].offsetY*J+lt:lt),S.buttons&&S.buttons.length>=2&&this.button2.update(S.buttons[1].label,S.buttons[1].offsetX*J?S.buttons[1].offsetX*J-60:-60,S.buttons.length>=3?S.buttons[1].offsetY*J?S.buttons[1].offsetY*J-15:-15:S.buttons[1].offsetY*J?S.buttons[1].offsetY*J+ht:ht),S.buttons&&S.buttons.length>=3&&this.button3.update(S.buttons[2].label,S.buttons[2].offsetX*J?S.buttons[2].offsetX*J-60:-60,S.buttons[2].offsetY*J?S.buttons[2].offsetY*J-60:-60),S.buttons&&S.buttons.length>=4&&this.button4.update(S.buttons[3].label,S.buttons[3].offsetX*J?S.buttons[3].offsetX*J+at:at,S.buttons[3].offsetY*J?S.buttons[3].offsetY*J-60:-60),ft.addComponentOrReplace(new Q(.7,(function(){S.buttons&&S.buttons.length>=1&&A.button1.show(),S.buttons&&S.buttons.length>=2&&A.button2.show(),S.buttons&&S.buttons.length>=3&&A.button3.show(),S.buttons&&S.buttons.length>=4&&A.button4.show()})))):this.isFixedScreen||(this.leftClickIcon.visible=!0,S.skipable?this.skipButton.show():this.skipButton.hide())},e.prototype.closeDialogWindow=function(){this.isDialogOpen&&(this.isDialogOpen=!1,this.portrait.visible=!1,this.text.value="",this.text.visible=!1,this.button1.hide(),this.button2.hide(),this.button3.hide(),this.button4.hide(),this.skipButton.hide(),this.leftClickIcon.visible=!1,this.container.visible=!1)},e.prototype.skipDialogs=function(){if(this.isDialogOpen&&!(+Date.now()-this.UIOpenTime<100)){for(;this.NPCScript[this.activeTextId]&&this.NPCScript[this.activeTextId].skipable&&!this.NPCScript[this.activeTextId].isQuestion;){if(this.NPCScript[this.activeTextId].triggeredByNext&&this.NPCScript[this.activeTextId].triggeredByNext(),this.NPCScript[this.activeTextId].skipable&&this.NPCScript[this.activeTextId].isEndOfDialog)return void this.closeDialogWindow();this.activeTextId+=1}this.confirmText(W.Next)}},e}(),pt=function(){function t(){this.timer=0,this.speed=45,this.visibleChars=0,this.fullText="",this.UIText=null,this.done=!0,t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){if(!this.done&&(this.timer+=v,this.timer>=2/this.speed)){var A=Math.floor(this.timer/(1/this.speed));this.timer=0,this.visibleChars+=A,this.closeTag(A),this.visibleChars>=this.fullText.length&&(this.done=!0,this.visibleChars=this.fullText.length),this.UIText&&(this.UIText.value=this.fullText.substr(0,this.visibleChars))}},t.prototype.newText=function(v,A,S,E){this.timer=0,this.done=!1,this.UIText=v.text,this.fullText=A,this.visibleChars=0,E&&E<=0?this.rush():this.speed=E||45,v.layoutDialogWindow(S)},t.prototype.rush=function(){this.done=!0,this.timer=0,this.visibleChars=this.fullText.length,this.UIText&&(this.UIText.value=this.fullText)},t.prototype.closeTag=function(v){if(0!=this.visibleChars&&0!=v){for(var A=!1,S=!1,E=this.visibleChars-v;E<this.visibleChars;E++)A?">"==this.fullText.substr(E,1)&&(S=!0):"<"==this.fullText.substr(E,1)&&(A=!0);if(A&&!S)for(;this.visibleChars<this.fullText.length&&">"!=this.fullText.substr(this.visibleChars-1,1);)this.visibleChars+=1}},t._instance=null,t}(),yt=function(A){function o(S,E,R,I,O,z,B,V){var W=A.call(this)||this;if(W.icon=null,W.image=new UIImage(S,E),W.image.positionX=I,W.image.positionY=O,W.image.width=130.5,W.image.height=34.5,W.label=new UIText(W.image),W.style=V||null,W.onClick=z,W.style)switch(W.style){case v.ButtonStyles.E:T(W.image,X.buttons.buttonE),W.label.positionX=18.75,W.icon=new UIImage(W.image,1==B?H:k),W.icon.width=ct,W.icon.height=ut,W.icon.hAlign="center",W.icon.vAlign="center",W.icon.isPointerBlocker=!1,T(W.icon,X.buttonLabels.E),W.icon.positionX=C(R.length);break;case v.ButtonStyles.F:T(W.image,X.buttons.buttonF),W.label.positionX=18.75,W.icon=new UIImage(W.image,1==B?H:k),W.icon.width=ct,W.icon.height=ut,W.icon.hAlign="center",W.icon.vAlign="center",W.icon.isPointerBlocker=!1,T(W.icon,X.buttonLabels.F),W.icon.positionX=C(R.length);break;case v.ButtonStyles.WHITE:T(W.image,X.buttons.white),W.label.positionX=18.75,W.icon=new UIImage(W.image,1==B?H:k),W.icon.width=ct,W.icon.height=ut,W.icon.hAlign="center",W.icon.vAlign="center",W.icon.isPointerBlocker=!1,T(W.icon,X.buttonLabels.FBlack),W.icon.positionX=C(R.length);break;case v.ButtonStyles.RED:T(W.image,X.buttons.buttonRed);break;case v.ButtonStyles.DARK:T(W.image,X.buttons.buttonDark);break;case v.ButtonStyles.ROUNDBLACK:T(W.image,X.buttons.roundBlack);break;case v.ButtonStyles.ROUNDWHITE:T(W.image,X.buttons.roundWhite);break;case v.ButtonStyles.ROUNDSILVER:T(W.image,X.buttons.roundSilver);break;case v.ButtonStyles.ROUNDGOLD:T(W.image,X.buttons.roundGold);break;case v.ButtonStyles.SQUAREBLACK:T(W.image,X.buttons.squareBlack);break;case v.ButtonStyles.SQUAREWHITE:T(W.image,X.buttons.squareWhite);break;case v.ButtonStyles.SQUARESILVER:T(W.image,X.buttons.squareSilver);break;case v.ButtonStyles.SQUAREGOLD:T(W.image,X.buttons.squareGold)}else T(W.image,X.buttons.roundSilver);return W.label.value=R,W.label.hTextAlign="center",W.label.vTextAlign="center",W.label.fontSize=15,W.label.font=M,W.label.color=V==v.ButtonStyles.ROUNDWHITE||V==v.ButtonStyles.SQUAREWHITE||V==v.ButtonStyles.WHITE?Color4.Black():Color4.White(),W.label.isPointerBlocker=!1,W.image.onClick=new OnClick((function(){W.onClick()})),V==v.ButtonStyles.E?Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){W.image.visible&&W.onClick()})):V==v.ButtonStyles.F&&Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){W.image.visible&&W.onClick()})),W}return i(o,A),o.prototype.hide=function(){this.image.visible=!1},o.prototype.show=function(){this.image.visible=!0},o.prototype.grayOut=function(){this.label.color=Color4.Gray(),this.image.isPointerBlocker=!1},o.prototype.enable=function(){this.label.color=Color4.White(),this.image.isPointerBlocker=!0},o.prototype.update=function(A,S,E){this.label.value=A,this.image.positionX=S,this.image.positionY=E,!this.icon||this.style!=v.ButtonStyles.E&&this.style!=v.ButtonStyles.F||(this.icon.positionX=C(A.length))},o}(Entity),ft=new Entity;function F(v,A){for(var S=0;S<v.length;S++)if(v[S].name&&v[S].name==A)return S;return 0}engine.addEntity(ft);var gt=function(){function t(){this._triggers={},t._instance=this,this._cameraTriggerWrapper=new bt(new j(new Vector3(.5,1.8,.5),new Vector3(0,.91,0))),this._componentGroup=engine.getComponentGroup(wt)}return Object.defineProperty(t,"instance",{get:function(){return this.createAndAddToEngine()},enumerable:!1,configurable:!0}),t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.setCameraTriggerShape=function(v){this._cameraTriggerWrapper.setShape(v)},t.prototype.update=function(){var v=this,A=this._componentGroup.entities;for(var S in A.forEach((function(A){v.shouldWrapTriggerEntity(A)&&v.wrapTriggerEntity(A)})),this._triggers)if(this._triggers.hasOwnProperty(S)){var E=this._triggers[S];E.isDebugging()&&E.updateDebugEntity(),E.isInEngine()?null!=E.trigger&&E.trigger.enabled?(E.wasEnabled||E.isDebugging()&&E.addDebugEntity(),E.wasEnabled=!0,(E.trigger.onCameraEnter||E.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(E),(E.trigger.onTriggerEnter||E.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(E)):E.wasEnabled&&(E.wasEnabled=!1,E.isDebugging()&&E.removeDebugEntity(),t.removeTriggerFromSystem(E)):(E.isDebugging()&&E.removeDebugEntity(),t.removeTriggerFromSystem(E),delete this._triggers[S])}},t.prototype.shouldWrapTriggerEntity=function(v){return null==this._triggers[v.uuid]||null==this._triggers[v.uuid]},t.prototype.wrapTriggerEntity=function(v){this._triggers[v.uuid]=new vt(v)},t.removeTriggerFromSystem=function(v){for(var A,S=v.getActiveCollisions(),E=0;E<S.length;E++)!(S[E]===(null===(A=t._instance)||void 0===A?void 0:A._cameraTriggerWrapper)||null==S[E].trigger)&&S[E].trigger.onTriggerExit&&v.entity&&S[E].trigger.onTriggerExit(v.entity),S[E].disengageActiveCollision(v),v.disengageActiveCollision(S[E])},t.disengageCollision=function(v,A){v.disengageActiveCollision(A),A.disengageActiveCollision(v),v.trigger.onTriggerExit&&A.entity&&v.trigger.onTriggerExit(A.entity),A.trigger.onTriggerExit&&v.entity&&A.trigger.onTriggerExit(v.entity)},t.engageCollision=function(v,A){v.engageCollision(A),A.engageCollision(v),v.trigger.onTriggerEnter&&A.entity&&v.trigger.onTriggerEnter(A.entity),A.trigger.onTriggerEnter&&v.entity&&A.trigger.onTriggerEnter(v.entity)},t.prototype.checkCollisionAgainstCamera=function(v){var A=v.hasActiveCollision(this._cameraTriggerWrapper),S=t.areColliding(v,this._cameraTriggerWrapper);A&&!S?(v.disengageActiveCollision(this._cameraTriggerWrapper),v.trigger.onCameraExit&&v.trigger.onCameraExit()):!A&&S&&(v.engageCollision(this._cameraTriggerWrapper),v.trigger.onCameraEnter&&v.trigger.onCameraEnter())},t.prototype.checkCollisionAgainstOtherTriggers=function(v){for(var A in this._triggers)if(this._triggers.hasOwnProperty(A)&&A!=v.uuid&&this._triggers[A].trigger.enabled&&t.canTriggersCollide(v,this._triggers[A])){var S=v.hasActiveCollision(this._triggers[A]),E=t.areColliding(v,this._triggers[A]);S&&!E?t.disengageCollision(v,this._triggers[A]):!S&&E&&t.engageCollision(v,this._triggers[A])}},t.canTriggersCollide=function(v,A){return 0==v.trigger.triggeredByLayer||0!=(A.trigger.layer&v.trigger.triggeredByLayer)},t.areColliding=function(v,A){return v.getShape()instanceof j&&A.getShape()instanceof j?t.areCollidingAABB(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof q&&A.getShape()instanceof q?t.areCollidingSphere(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof j&&A.getShape()instanceof q?t.areCollidingAABBSphere(v.getGlobalPosition(),v.getShape(),A.getGlobalPosition(),A.getShape()):v.getShape()instanceof q&&A.getShape()instanceof j&&t.areCollidingAABBSphere(A.getGlobalPosition(),A.getShape(),v.getGlobalPosition(),v.getShape())},t.areCollidingAABB=function(v,A,S,E){var R=t.getBoxShapeValues(v,A),I=t.getBoxShapeValues(S,E);return R.min.x<=I.max.x&&R.max.x>=I.min.x&&R.min.y<=I.max.y&&R.max.y>=I.min.y&&R.min.z<=I.max.z&&R.max.z>=I.min.z},t.areCollidingSphere=function(v,A,S,E){return Vector3.DistanceSquared(v.add(A.position),S.add(E.position))<A.radius*A.radius+E.radius*E.radius},t.areCollidingAABBSphere=function(v,A,S,E){var R=t.getBoxShapeValues(v,A),I=S.add(E.position),O=E.radius,z=0;return I.x<R.min.x&&(z+=(R.min.x-I.x)*(R.min.x-I.x)),I.x>R.max.x&&(z+=(I.x-R.max.x)*(I.x-R.max.x)),I.y<R.min.y&&(z+=(R.min.y-I.y)*(R.min.y-I.y)),I.y>R.max.y&&(z+=(I.y-R.max.y)*(I.y-R.max.y)),I.z<R.min.z&&(z+=(R.min.z-I.z)*(R.min.z-I.z)),I.z>R.max.z&&(z+=(I.z-R.max.z)*(I.z-R.max.z)),z<O*O},t.getBoxShapeValues=function(v,A){var S=v.add(A.position);return{center:S,min:S.subtract(A.size.scale(.5)),max:S.add(A.size.scale(.5))}},t._instance=null,t}(),vt=function(){function t(v){this.wasEnabled=!0,this._uuid="",this._collidingWith={},this._isDebug=!1,this._debugEntity=null,this._entity=v,v&&(this._trigger=v.getComponent(wt),this._uuid=v.uuid,this._isDebug=this._trigger.debugEnabled,this._isDebug&&this.addDebugEntity())}return Object.defineProperty(t.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trigger",{get:function(){return this._trigger},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uuid",{get:function(){return this._uuid},enumerable:!1,configurable:!0}),t.prototype.getGlobalPosition=function(){return this._entity?t.getEntityWorldPosition(this._entity):Vector3.Zero()},t.prototype.getShape=function(){return this._trigger.shape},t.prototype.isInEngine=function(){return null!=this._entity&&this._entity.isAddedToEngine()},t.prototype.getActiveCollisions=function(){var v=[];for(var A in this._collidingWith)this._collidingWith.hasOwnProperty(A)&&v.push(this._collidingWith[A]);return v},t.prototype.hasActiveCollision=function(v){return null!=this._collidingWith[v.uuid]&&null!=this._collidingWith[v.uuid]},t.prototype.disengageActiveCollision=function(v){delete this._collidingWith[v.uuid]},t.prototype.engageCollision=function(v){this._collidingWith[v.uuid]=v},t.prototype.isDebugging=function(){return this._isDebug},t.prototype.addDebugEntity=function(){if(t._debugMaterial||(t._debugMaterial=new Material,t._debugMaterial.alphaTest=.5),null==this._debugEntity){this._debugEntity=new Entity;var v=new Transform;if(this._debugEntity.addComponent(v),this._debugEntity.addComponent(t._debugMaterial),this.getShape()instanceof j&&((A=new BoxShape).withCollisions=!1,this._debugEntity.addComponent(A),v.scale=this.getShape().size),this.getShape()instanceof q){var A;(A=new SphereShape).withCollisions=!1,this._debugEntity.addComponent(A);var S=this.getShape().radius;v.scale=new Vector3(S,S,S)}}engine.addEntity(this._debugEntity)},t.prototype.removeDebugEntity=function(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)},t.prototype.updateDebugEntity=function(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))},t.getEntityWorldPosition=function(v){var A=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),S=v.getParent();if(null!=S){var E=S.hasComponent(Transform)?S.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(S).add(A.rotate(E))}return A},t._debugMaterial=null,t}(),bt=function(v){function e(A){var S=v.call(this)||this;return S._shape=A,S._uuid="cameraTrigger",S}return i(e,v),e.prototype.getGlobalPosition=function(){return Camera.instance.position},e.prototype.getShape=function(){return this._shape},e.prototype.setShape=function(v){this._shape=v},e.prototype.isInEngine=function(){return!1},e.prototype.hasActiveCollision=function(v){return!1},e.prototype.disengageActiveCollision=function(v){},e.prototype.engageCollision=function(v){},e.prototype.isDebugging=function(){return!1},e}(vt),wt=function(){function t(v,A){this.enabled=!0,this.layer=0,this.triggeredByLayer=0,gt.createAndAddToEngine(),this.shape=v,this.layer=A&&A.layer?A.layer:0,this.triggeredByLayer=A&&A.triggeredByLayer?A.triggeredByLayer:0,this.onTriggerEnter=A&&A.onTriggerEnter?A.onTriggerEnter:void 0,this.onTriggerExit=A&&A.onTriggerExit?A.onTriggerExit:void 0,this.onCameraEnter=A&&A.onCameraEnter?A.onCameraEnter:void 0,this.onCameraExit=A&&A.onCameraExit?A.onCameraExit:void 0,this._debugEnabled=!(!A||!A.enableDebug)&&A.enableDebug}return Object.defineProperty(t.prototype,"debugEnabled",{get:function(){return this._debugEnabled},enumerable:!1,configurable:!0}),o([Component("npcTriggerComponent")],t)}(),j=function(v,A){this.size=v,this.position=A},q=function(v,A){this.radius=v,this.position=A},Tt=function(){function t(v){this.origin=0,this.target=1,this.fraction=0,this.totalDuration=0,this.speed=[],this.loop=!1,this.path=v,Ct.createAndAddToEngine()}return t.prototype.setIndex=function(v){this.fraction=0,this.origin=v,this.target=v+1<this.path.length?v+1:0},o([Component("npclerpData")],t)}(),xt=[],Ct=function(){function e(){e._instance=this}return e.prototype.update=function(A){var S,E;try{for(var R=n(xt),I=R.next();!I.done;I=R.next()){var O=I.value;if(O.state==v.NPCState.FOLLOWPATH){var z=O.getComponent(Transform),M=O.getComponent(Tt);if(M.fraction<1)M.fraction+=A*M.speed[M.origin],z.position=Vector3.Lerp(M.path[M.origin],M.path[M.target],M.fraction);else{if(M.origin=M.target,M.target+=1,M.target>=M.path.length){if(!M.loop)return O.stopWalking(),M.onFinishCallback&&M.onFinishCallback(),void(M.fraction=1);M.target=0}else M.onReachedPointCallback&&M.onReachedPointCallback();M.fraction=0,z.lookAt(M.path[M.target])}}}}catch(v){S={error:v}}finally{try{I&&!I.done&&(E=R.return)&&E.call(R)}finally{if(S)throw S.error}}},e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e._instance=null,e}(),_t=100,At=function(){function t(v,A,S){this.NPCScript=[],this.isBubleOpen=!1,this.activeTextId=0,this.defaultSound=null,this.baseYOffset=2.5,this.baseYOffset=A||2.5,this.rootEntity=new Entity,this.rootEntity.addComponent(new Billboard(!1,!0,!1)),this.rootEntity.addComponent(new Transform),this.rootEntity.setParent(v),this.container=new Entity,this.container.addComponent(new Transform({position:new Vector3(-.1,this.baseYOffset,0)})),this.container.setParent(this.rootEntity),this.material=new BasicMaterial,this.material.texture=V,this.panel=new Entity,this.panel.addComponent(new Transform({scale:new Vector3(2,1,1)})),this.panel.setParent(this.container),this.panel.addComponent(new PlaneShape),this.panel.addComponent(this.material),this.panel.getComponent(PlaneShape).visible=!1,b(this.panel.getComponent(PlaneShape),X.bubbles.normal,1024,1024),this.text=new Entity,this.text.addComponent(new Transform({position:new Vector3(0,0,.05),rotation:Quaternion.Euler(0,180,0)})),this.text.addComponent(new TextShape("")),this.text.setParent(this.container),this.text.getComponent(TextShape).textWrapping=!0,this.text.getComponent(TextShape).font=B,this.text.getComponent(TextShape).hTextAlign="center",this.text.getComponent(TextShape).vTextAlign="center",this.text.getComponent(TextShape).fontSize=1,this.text.getComponent(TextShape).fontWeight="normal",this.text.getComponent(TextShape).color=Color3.Black(),this.text.getComponent(TextShape).visible=!1,this.soundEnt=new Entity,S&&(this.soundEnt.addComponent(new Transform),engine.addEntity(this.soundEnt),this.soundEnt.setParent(this.container),this.soundEnt.addComponent(new AudioSource(new AudioClip(S))),this.soundEnt.getComponent(AudioSource).volume=.5,this.defaultSound=S),St.createAndAddToEngine()}return t.prototype.openDialogWindow=function(v,A){this.NPCScript=v,this.activeTextId=A?"number"==typeof A?A:function(v,A){for(var S=0;S<v.length;S++)if(v[S].name&&v[S].name==A)return S;return 0}(v,A):0;var S=v[this.activeTextId]?v[this.activeTextId]:{text:""};S.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(S.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),this.text.getComponent(TextShape).fontSize=S.fontSize?S.fontSize:1,this.text.getComponent(Transform).position.y=S.offsetY?S.offsetY+0:0,this.text.getComponent(Transform).position.x=S.offsetX?S.offsetX:0,this.text.getComponent(TextShape).visible=!0,this.panel.getComponent(PlaneShape).visible=!0,this.text.getComponent(TextShape).value="",S.text.length<_t&&S.text.slice(0,_t),St._instance.newText(this,S.text,this.activeTextId,S.timeOn?S.timeOn:void 0,S.typeSpeed?S.typeSpeed:void 0),this.adjustBubble(S.text.length),this.layoutDialogWindow(this.activeTextId),this.isBubleOpen=!0},t.prototype.adjustBubble=function(v){v<8?(b(this.panel.getComponent(PlaneShape),X.bubbles.short,1024,1024),this.panel.getComponent(Transform).scale.x=.58,this.panel.getComponent(Transform).scale.y=.42,this.container.getComponent(Transform).position.x=-.1,this.container.getComponent(Transform).position.y=this.baseYOffset+-.2,this.text.getComponent(TextShape).width=.7):v<25?(b(this.panel.getComponent(PlaneShape),X.bubbles.normal,1024,1024),this.panel.getComponent(Transform).scale.x=1.43,this.panel.getComponent(Transform).scale.y=.42,this.container.getComponent(Transform).position.x=-.5,this.container.getComponent(Transform).position.y=this.baseYOffset+-.2,this.text.getComponent(TextShape).width=1.5):v<50?(b(this.panel.getComponent(PlaneShape),X.bubbles.long,1024,1024),this.panel.getComponent(Transform).scale.x=2.485,this.panel.getComponent(Transform).scale.y=.765,this.container.getComponent(Transform).position.y=this.baseYOffset+0,this.container.getComponent(Transform).position.x=-.8,this.text.getComponent(TextShape).width=2):(b(this.panel.getComponent(PlaneShape),X.bubbles.huge,1024,1024),this.panel.getComponent(Transform).scale.x=2.485,this.panel.getComponent(Transform).scale.y=1.195,this.container.getComponent(Transform).position.y=this.baseYOffset+.2,this.container.getComponent(Transform).position.x=-.8,this.text.getComponent(TextShape).width=2)},t.prototype.next=function(){var v=this.NPCScript[this.activeTextId];v||(v=this.NPCScript[this.activeTextId-1]),v.triggeredByNext&&v.triggeredByNext(),v.isEndOfDialog?this.closeDialogWindow():(this.activeTextId++,(v=this.NPCScript[this.activeTextId]).text.length<_t&&v.text.slice(0,_t),this.text.getComponent(TextShape).value="",this.adjustBubble(v.text.length),St._instance.newText(this,v.text,this.activeTextId,v.timeOn?v.timeOn:void 0,v.typeSpeed?v.typeSpeed:void 0),this.layoutDialogWindow(this.activeTextId))},t.prototype.layoutDialogWindow=function(v){var A=this.NPCScript[v]?this.NPCScript[v]:{text:""},S=A.offsetY?A.offsetY+0:0;A.buttons&&A.buttons.length>=3?S+=50:A.buttons&&A.buttons.length>=1&&(S+=24),this.text.getComponent(TextShape).fontSize=A.fontSize?A.fontSize:1,this.text.getComponent(Transform).position.y=S,A.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(A.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce())},t.prototype.closeDialogWindow=function(){this.isBubleOpen&&(this.isBubleOpen=!1,this.text.getComponent(TextShape).value="",this.text.getComponent(TextShape).visible=!1,this.panel.getComponent(PlaneShape).visible=!1)},t.prototype.closeDialogEndAll=function(){this.isBubleOpen&&(this.isBubleOpen=!1,this.text.getComponent(TextShape).value="",this.text.getComponent(TextShape).visible=!1,this.panel.getComponent(PlaneShape).visible=!1,St._instance.Dialog==this&&(St._instance.done=!0))},t.prototype.skipDialogs=function(){if(this.isBubleOpen)for(;this.NPCScript[this.activeTextId];){if(this.NPCScript[this.activeTextId].triggeredByNext&&this.NPCScript[this.activeTextId].triggeredByNext(),this.NPCScript[this.activeTextId].isEndOfDialog)return void this.closeDialogWindow();this.activeTextId+=1}},t}(),St=function(){function t(){this.timer=0,this.speed=45,this.visibleChars=0,this.fullText="",this.Text=null,this.textId=0,this.done=!0,this.showing=!1,this.timeOn=3,t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){if(!this.done)if(this.timer+=v,this.showing)this.timer>this.timeOn&&(this.showing=!1,this.done=!0,this.timer=0,this.window.next());else if(this.timer>=2/this.speed){var A=Math.floor(this.timer/(1/this.speed));this.timer=0,this.visibleChars+=A,this.closeTag(A),this.visibleChars>=this.fullText.length&&(this.showing=!0,this.timer=0,this.visibleChars=this.fullText.length),this.Text&&(this.Text.value=this.fullText.substr(0,this.visibleChars))}},t.prototype.newText=function(v,A,S,E,R){if(v!=this.Dialog||S!=this.textId){var I=this.Dialog;this.Dialog=v,this.Text=this.Dialog.text.getComponent(TextShape),this.textId=S,I&&v!=I&&I.skipDialogs(),this.timer=0,this.done=!1,this.showing=!1,this.fullText=A,this.visibleChars=0,this.window=v,R&&R<=0?this.rush():this.speed=R||45,this.timeOn=E||3}},t.prototype.rush=function(){this.showing=!0,this.timer=0,this.visibleChars=this.fullText.length,this.Text&&(this.Text.value=this.fullText)},t.prototype.closeTag=function(v){if(0!=this.visibleChars&&0!=v){for(var A=!1,S=!1,E=this.visibleChars-v;E<this.visibleChars;E++)A?">"==this.fullText.substr(E,1)&&(S=!0):"<"==this.fullText.substr(E,1)&&(A=!0);if(A&&!S)for(;this.visibleChars<this.fullText.length&&">"!=this.fullText.substr(this.visibleChars-1,1);)this.visibleChars+=1}},t._instance=null,t}(),Rt=function(S){function o(E,R,I,O){var z=S.call(this)||this;z.introduced=!1,z.onWalkAway=null,z.inCooldown=!1,z.coolDownDuration=5,z.faceUser=!1,z.walkingAnim=null,z.walkingSpeed=2,z.bubbleHeight=2,z.addComponent(new GLTFShape(R)),z.addComponent(new Transform(E)),engine.addEntity(z),z.state=v.NPCState.STANDING,O&&O.noUI||(O&&O.portrait?z.dialog=new dt("string"==typeof O.portrait?{path:O.portrait}:O.portrait,!(!O||!O.darkUI)&&O.darkUI,O.dialogSound?O.dialogSound:void 0):z.dialog=new dt(void 0,!(!O||!O.darkUI)&&O.darkUI,O&&O.dialogSound?O.dialogSound:void 0)),O&&O.textBubble&&(O&&O.bubbleHeight&&(z.bubbleHeight=O.bubbleHeight),z.bubble=new At(z,z.bubbleHeight,O.dialogSound?O.dialogSound:void 0)),z.addComponent(new Animator),z.idleAnim=new AnimationState(O&&O.idleAnim?O.idleAnim:"Idle",{looping:!0}),z.getComponent(Animator).addClip(z.idleAnim),z.lastPlayedAnim=z.idleAnim,z.idleAnim.play(),O&&O.walkingAnim&&(z.walkingAnim=new AnimationState(O.walkingAnim,{looping:!0}),z.getComponent(Animator).addClip(z.walkingAnim)),z.onActivate=I,O&&O.onWalkAway&&(z.onWalkAway=O.onWalkAway),z.endAnimTimer=new Entity,engine.addEntity(z.endAnimTimer),z.closeDialogTimer=new Entity,engine.addEntity(z.closeDialogTimer),z.pauseWalkingTimer=new Entity,engine.addEntity(z.pauseWalkingTimer);var M=O&&O.onlyClickTrigger?ActionButton.POINTER:ActionButton.PRIMARY;z.addComponent(new OnPointerDown((function(v){z.inCooldown||z.dialog&&z.dialog.isDialogOpen||z.activate()}),{button:M,hoverText:O&&O.hoverText?O.hoverText:"Talk",showFeedback:!O||!O.onlyExternalTrigger})),O&&O.onlyExternalTrigger&&z.removeComponent(OnPointerDown);var B={};return(!O||O&&!O.continueOnWalkAway)&&(B.onCameraExit=function(){z.handleWalkAway()}),O&&(!O||O.onlyExternalTrigger||O.onlyClickTrigger||O.onlyETrigger)||(B.onCameraEnter=function(){z.inCooldown?log(z.name," in cooldown"):z.dialog&&z.dialog.isDialogOpen||O&&O.onlyExternalTrigger||O&&O.onlyClickTrigger||z.activate()}),(B.onCameraEnter||B.onCameraExit)&&z.addComponent(new wt(new q(O&&O.reactDistance?O.reactDistance:6,Vector3.Zero()),B)),O&&O.faceUser&&(z.addComponent(new A(!0,O.turningSpeed?O.turningSpeed:void 0)),z.faceUser=!0),O&&O.walkingSpeed&&(z.walkingSpeed=O.walkingSpeed),O&&O.coolDownDuration&&(z.coolDownDuration=O.coolDownDuration),O&&O.path&&(z.addComponent(new Tt(O.path?O.path:[])),z.getComponent(Tt).loop=!0,xt.push(z),z.followPath()),z}return i(o,S),o.prototype.activate=function(){var v=this;this.faceUser&&(this.getComponent(A).active=!0),this.inCooldown=!0,this.addComponentOrReplace(new Q(this.coolDownDuration,(function(){v.inCooldown=!1}))),this.onActivate()},o.prototype.endInteraction=function(){this.faceUser&&(this.getComponent(A).active=!1),this.dialog&&this.dialog.isDialogOpen&&this.dialog.closeDialogWindow(),this.bubble&&this.bubble.isBubleOpen&&this.bubble.closeDialogWindow(),this.state=v.NPCState.STANDING},o.prototype.handleWalkAway=function(){this.state!=v.NPCState.FOLLOWPATH&&(this.endInteraction(),this.onWalkAway&&this.onWalkAway())},o.prototype.talk=function(A,S,E){var R=this;this.introduced=!0,this.state=v.NPCState.TALKING,this.closeDialogTimer.hasComponent(Q)&&this.closeDialogTimer.removeComponent(Q),this.bubble&&this.bubble.isBubleOpen&&this.bubble.closeDialogWindow(),this.dialog.openDialogWindow(A,S||0),E&&this.closeDialogTimer.addComponentOrReplace(new Q(E,(function(){R.dialog.closeDialogWindow()})))},o.prototype.talkBubble=function(v,A){this.bubble||(this.bubble=new At(this,this.bubbleHeight)),this.bubble.openDialogWindow(v,A||0)},o.prototype.playAnimation=function(v,A,S){var E=this;this.lastPlayedAnim.stop(),this.endAnimTimer.hasComponent(Q)&&this.endAnimTimer.removeComponent(Q);var R=this.getComponent(Animator).getClip(v);A&&(R.looping=!1,S&&this.endAnimTimer.addComponentOrReplace(new Q(S,(function(){R.stop(),E.idleAnim&&(E.idleAnim.play(),E.lastPlayedAnim=E.idleAnim)})))),R.stop(),R.play(),this.lastPlayedAnim=R},o.prototype.changeIdleAnim=function(v,A){this.idleAnim.stop(),this.idleAnim=new AnimationState(v,{looping:!0}),this.getComponent(Animator).addClip(this.idleAnim),A&&(this.lastPlayedAnim.stop(),this.idleAnim.play(),this.lastPlayedAnim=this.idleAnim)},o.prototype.followPath=function(S){if(!this.hasComponent(Tt)){if(!S)return;this.addComponent(new Tt(S.path?S.path:[])),xt.push(this)}this.faceUser&&(this.getComponent(A).active=!1);var E=this.getComponent(Tt);if(S){if(S.path)if(S.curve){var R=Curve3.CreateCatmullRomSpline(S.path,4*S.path.length,!!S.loop).getPoints();S.loop&&R.pop(),E.path=R}else E.path=S.path;null!=S.loop&&(E.loop=S.loop),null!=S.startingPoint&&E.setIndex(S.startingPoint),S.onFinishCallback&&(E.onFinishCallback=S.onFinishCallback),S.onReachedPointCallback&&(E.onReachedPointCallback=S.onReachedPointCallback)}var I=this.getComponent(Transform).position;(0==E.fraction&&E.path[E.origin].subtract(I).lengthSquared()>.1||E.fraction>0&&I.subtract(E.path[E.origin]).normalize()==E.path[E.target].subtract(E.path[E.origin]).normalize())&&(E.path.splice(E.origin,0,this.getComponent(Transform).position),E.fraction=0),this.getComponent(Transform).lookAt(E.path[E.target]);for(var O=0,z=[],M=0;M<E.path.length-1;M++){var B;O+=B=Vector3.Distance(E.path[M],E.path[M+1]),z.push(B)}for(E.loop&&(O+=B=Vector3.Distance(E.path[E.path.length-1],E.path[0]),z.push(B)),S&&S.totalDuration?E.totalDuration=S.totalDuration:S&&S.speed?E.totalDuration=O/S.speed:E.totalDuration||(E.totalDuration=O/this.walkingSpeed),E.speed=[],M=0;M<z.length;M++)E.speed.push(1/(z[M]/O*E.totalDuration));this.walkingAnim&&(this.endAnimTimer.hasComponent(Q)&&this.endAnimTimer.removeComponent(Q),this.idleAnim.stop(),this.lastPlayedAnim.stop(),this.walkingAnim.play(),this.lastPlayedAnim=this.walkingAnim),this.state=v.NPCState.FOLLOWPATH},o.prototype.stopWalking=function(A){var S=this;this.state=v.NPCState.STANDING,this.walkingAnim&&(this.walkingAnim.stop(),this.idleAnim.play(),this.lastPlayedAnim=this.idleAnim),A&&this.pauseWalkingTimer.addComponentOrReplace(new Q(A,(function(){S.dialog&&S.dialog.isDialogOpen||(S.lastPlayedAnim.stop(),S.walkingAnim&&(S.walkingAnim.play(),S.lastPlayedAnim=S.walkingAnim),S.endAnimTimer.hasComponent(Q)&&S.endAnimTimer.removeComponent(Q),S.state=v.NPCState.FOLLOWPATH)})))},o}(Entity);v.CustomDialogButton=yt,v.DialogTypeInSystem=pt,v.DialogWindow=dt,v.NPC=Rt,v.NPCDelay=Q,v.NPCLerpData=Tt,v.NPCTriggerComponent=wt,v.SFFont=M,v.SFHeavyFont=B,v.TrackUserFlag=A,v.TriggerBoxShape=j,v.TriggerSphereShape=q,v.canvas=I,v.darkTheme=H,v.lightTheme=k,Object.defineProperty(v,"__esModule",{value:!0})}));var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(v){for(var A,S=1,E=arguments.length;S<E;S++)for(var R in A=arguments[S])Object.prototype.hasOwnProperty.call(A,R)&&(v[R]=A[R]);return v},__assign.apply(this,arguments)},__values=this&&this.__values||function(v){var A="function"==typeof Symbol&&Symbol.iterator,S=A&&v[A],E=0;if(S)return S.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")},__decorate=this&&this.__decorate||function(v,A,S,E){var R,I=arguments.length,O=I<3?A:null===E?E=Object.getOwnPropertyDescriptor(A,S):E;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)O=Reflect.decorate(v,A,S,E);else for(var z=v.length-1;z>=0;z--)(R=v[z])&&(O=(I<3?R(O):I>3?R(A,S,O):R(A,S))||O);return I>3&&O&&Object.defineProperty(A,S,O),O};define("node_modules/decentraland-builder-scripts/channel",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.createChannel=void 0;var S="__request_value__",E="__reply_value__";A.createChannel=function(v,A,R){var I={},O={},z={};return R.on(A.name,(function(v){var A=I[v.actionId];A&&A(v),O={}})),R.on(S,(function(S){if(S.sender!==v&&S.entityName===A.name){var I=S.key,M=z[I];if(M){var B=M(),k={entityName:A.name,key:I,sender:v,value:B};R.emit(E,k)}delete O[I]}})),R.on(E,(function(S){if(S.sender!==v&&S.entityName===A.name){var E=S.key,R=S.value,I=O[E];I&&I(R),delete O[E]}})),{id:v,bus:R,createAction:function(v,S){return{entityName:A.name,actionId:v,values:S}},sendActions:function(A){var S,E;void 0===A&&(A=[]);try{for(var I=__values(A),O=I.next();!O.done;O=I.next()){var z=O.value,M=__assign(__assign({},z),{sender:v});R.emit(M.entityName,M)}}catch(v){S={error:v}}finally{try{O&&!O.done&&(E=I.return)&&E.call(I)}finally{if(S)throw S.error}}},handleAction:function(v,A){I[v]=A},request:function(E,I){O[E]=I;var z={entityName:A.name,key:E,sender:v},M=setInterval((function(){E in O?R.emit(S,z):clearInterval(M)}),5e3)},reply:function(v,A){z[v]=A}}}})),define("node_modules/decentraland-builder-scripts/inventory",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0}),A.createInventory=void 0,A.createInventory=function(v,A,S){var E=null,R=null,I={};return{add:function(O,z){var M=I[O]||new S((E||(E=new v),R||((R=new A(E)).isPointerBlocker=!1,R.vAlign="bottom",R.hAlign="right",R.stackOrientation=0,R.spacing=0,R.positionY=75,R.positionX=-25),R),z);M.width=128,M.height=128,M.sourceTop=0,M.sourceLeft=0,M.sourceHeight=256,M.sourceWidth=256,M.isPointerBlocker=!1,M.visible=!0,I[O]=M},remove:function(v){var A=I[v];A&&(A.visible=!1,A.height=0,A.width=0)},has:function(v){return v in I&&I[v].visible}}}})),define("src/smart-items/stream/src/item",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0});var S=function(){function Button(){this.channel="",this.video={},this.materials={},this.active={},this.volume={},this.sign={}}return Button.prototype.init=function(){},Button.prototype.toggle=function(v,A){if(log("all screens: ",this.video," setting: ",v.name," to ",A),A){if(this.activeScreen&&this.activeScreen==v)return;this.activeScreen&&this.toggle(this.activeScreen,!1),this.activeScreen=v,this.active[v.name]=!0,this.video[v.name].volume=this.volume[v.name],this.video[v.name].playing=!0,engine.removeEntity(this.sign[v.name])}else{if(!this.activeScreen||this.activeScreen!=v)return;this.activeScreen=null,this.active[v.name]=!1,this.video[v.name].playing=!1}},Button.prototype.spawn=function(v,A,S){var E=this,R=new Entity(v.name+"-screen");R.setParent(v);R.addComponent(new PlaneShape),R.addComponent(new Transform({scale:new Vector3(2.976,1.08*1.55,15.5),position:new Vector3(0,.8494,0)})),A.customStation?this.channel=A.customStation:A.station?this.channel=A.station:this.channel="https://theuniverse.club/live/genesisplaza/index.m3u8",this.video[R.name]=new VideoTexture(new VideoClip(this.channel)),this.materials[R.name]=new Material,this.materials[R.name].albedoTexture=this.video[R.name],this.materials[R.name].specularIntensity=0,this.materials[R.name].roughness=1,this.materials[R.name].metallic=0,this.materials[R.name].emissiveTexture=this.video[R.name],this.materials[R.name].emissiveIntensity=.8,this.materials[R.name].emissiveColor=new Color3(1,1,1),R.addComponent(this.materials[R.name]),this.sign[R.name]=new Entity(v.name+"-sign"),this.sign[R.name].setParent(R),this.sign[R.name].addComponent(new PlaneShape),this.sign[R.name].addComponent(new Transform({position:new Vector3(0,0,.002),rotation:Quaternion.Euler(180,0,0)})),this.volume[R.name]=A.volume;var I=new Material;I.albedoTexture=new Texture(A.image?A.image:"src/smart-items/stream/images/stream3.png"),I.specularIntensity=0,I.roughness=1,this.sign[R.name].addComponent(I),A.onClick&&(this.sign[R.name].addComponent(new OnPointerDown((function(){S.sendActions(A.onClick)}),{button:ActionButton.POINTER,hoverText:A.onClickText,distance:6})),R.addComponent(new OnPointerDown((function(){log("clicked"),S.sendActions(A.onClick)}),{button:ActionButton.POINTER,hoverText:A.onClickText,distance:6}))),A.startOn?this.toggle(R,!0):this.toggle(R,!1),S.handleAction("activate",(function(v){var I=v.sender;E.toggle(R,!0),I===S.id&&S.sendActions(A.onActivate)})),S.handleAction("deactivate",(function(v){var I=v.sender;E.toggle(R,!1),I===S.id&&S.sendActions(A.onDeactivate)})),S.handleAction("toggle",(function(v){var I=v.sender,O=!E.active[R.name];E.toggle(R,O),I===S.id&&(O?S.sendActions(A.onActivate):S.sendActions(A.onDeactivate))})),S.request("isActive",(function(v){return E.toggle(R,v)})),S.reply("isActive",(function(){return E.active[R.name]}))},Button}();A.default=S})),define("src/smart-items/elevator/src/item",["require","exports"],(function(v,A){Object.defineProperty(A,"__esModule",{value:!0});var S=function(){function VerticalPlatform(v,A,S,E,R,I,O){void 0===A&&(A=10),void 0===S&&(S=5),void 0===E&&(E=[0,5,10]),void 0===R&&(R=2e3),void 0===I&&(I=0),this.channel=v,this.distance=A,this.speed=S,this.levels=E,this.duration=R,this.loopDuration=I,this.durations=O,this.transition=-1,this.delay=-1}return __decorate([Component("VerticalPlatform")],VerticalPlatform)}(),E=function(){function VerticalPlatformSystem(){this.group=engine.getComponentGroup(S)}return VerticalPlatformSystem.prototype.update=function(v){var A,E;try{for(var R=__values(this.group.entities),I=R.next();!I.done;I=R.next()){var O=I.value,z=O.getComponent(S),M=O.getComponent(Transform),B=Date.now()%(2*z.loopDuration),k=B<=z.loopDuration,H=0,V=0;do{(H+=z.durations[V])<=z.loopDuration?V++:V--}while(H<B);k?V--:V++;var W=O.getComponent(Animator).getClip("LightAction"),X=void 0;if(V%2==1){X=V/2+.5;var Q=H-z.durations[V],K=(B-Q)/(H-Q),Z=new Vector3(0,z.levels[X-1],0),J=new Vector3(0,z.levels[X],0),$=k?Z:J,et=k?J:Z;M.position.copyFrom(Vector3.Lerp($,et,K)),W.playing||(W.stop(),W.play())}else{X=V/2;var nt=new Vector3(0,z.levels[X],0);z.delay=0,M.position.copyFrom(nt)}z.delay>=0&&z.delay<1?z.delay+=v:z.delay>=1&&(z.delay=-1,W.stop())}}catch(v){A={error:v}}finally{try{I&&!I.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}},VerticalPlatformSystem}(),R=function(){function Platform(){}return Platform.prototype.init=function(){engine.addSystem(new E)},Platform.prototype.spawn=function(v,A,E){var R=A.speed,I=A.levels,O=A.duration,z=new Entity(v.name+"-platform");z.setParent(v),z.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1)})),z.addComponent(new GLTFShape("src/smart-items/elevator/models/Ascenseur.glb"));for(var M=R/20*1e3,B=I.split(" ").map((function(v){return parseFloat(v)})),k=B[B.length-1]-B[0],H=(B.length-1)*O,V=k*M,W=[],X=0;X<B.length;X++){if(0!=X){var Q=B[X]-B[X-1];W.push(Q*M)}W.push(O)}z.addComponent(new S(E,k,R,B,O,H+V,W));var K=new Animator,Z=new AnimationState("main",{looping:!0});K.addClip(Z),z.addComponent(K),Z.play()},Platform}();A.default=R})),define("src/smart-items/npc/src/item",["require","exports","@decentraland/RestrictedActions","@dcl/npc-scene-utils","@dcl/npc-scene-utils"],(function(v,A,S,E,R){Object.defineProperty(A,"__esModule",{value:!0});var I=function(){function Bot18(){}return Bot18.prototype.init=function(){},Bot18.prototype.spawn=function(v,A,I){var O=this,z=A.target,M=[{text:"Hey, I'm Charlie - The body guard. Are you over 18 years old ?",isQuestion:!0,offsetY:20,buttons:[{label:"YES",goToDialog:2},{label:"NO",goToDialog:1}]},{text:"Come back when you grow up.",isEndOfDialog:!0,triggeredByNext:function(){O.npc.playAnimation("hello",!0,2)}},{text:"Good, You can enter. Enjoy your stay !",isEndOfDialog:!0,triggeredByNext:function(){(0,S.movePlayerTo)(z.getComponent(Transform).position),O.npc.playAnimation("hello",!0,2)}}];this.npc=new R.NPC({position:new Vector3(0,0,0),rotation:Quaternion.Euler(0,0,0)},"src/smart-items/npc/models/avatar_npc_V2.glb",(function(){O.npc.playAnimation("salut_formel",!0,2);var v=new Entity;v.addComponent(new E.NPCDelay(2,(function(){O.npc.playAnimation("speaking")}))),engine.addEntity(v),O.npc.addComponentOrReplace(new AudioSource(new AudioClip("src/smart-items/npc/sounds/Hi.mp3"))),O.npc.getComponent(AudioSource).playOnce(),O.npc.talk(M)}),{idleAnim:"idle",faceUser:!0,reactDistance:4,portrait:{path:"src/smart-items/npc/images/charlie-avatar.png",height:256,width:256,section:{sourceHeight:512,sourceWidth:512}},onWalkAway:function(){O.npc.playAnimation("hello",!0,2)}}),this.npc.setParent(v)},Bot18}();A.default=I})),define("src/game",["require","exports","node_modules/decentraland-builder-scripts/channel","node_modules/decentraland-builder-scripts/inventory","src/smart-items/stream/src/item","src/smart-items/elevator/src/item","src/smart-items/npc/src/item"],(function(v,A,S,E,R,I,O){Object.defineProperty(A,"__esModule",{value:!0});var z=new Entity("_scene");engine.addEntity(z);var M=new Quaternion;Quaternion.FromEulerAnglesRef(0,-90,0,M);var B=new Transform({position:new Vector3(16,0),rotation:M,scale:new Vector3(1,1,1)});z.addComponentOrReplace(B);var k=new Entity("entity");engine.addEntity(k),k.setParent(z);var H=new GLTFShape("assets/tour_barman_sol.glb");H.withCollisions=!0,H.isPointerBlocker=!0,H.visible=!0,k.addComponentOrReplace(H);var V=new Transform({position:new Vector3(8,0,8),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});k.addComponentOrReplace(V);var W=new Entity("imagesCerf");engine.addEntity(W),W.setParent(z);var X=new Transform({position:new Vector3(8,0,8),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});W.addComponentOrReplace(X);var Q=new GLTFShape("assets/images_cerf.glb");Q.withCollisions=!0,Q.isPointerBlocker=!0,Q.visible=!0,W.addComponentOrReplace(Q);var K=new Entity("videoStream");engine.addEntity(K),K.setParent(z);var Z=new Transform({position:new Vector3(.5000000596046448,1,8),rotation:new Quaternion(1539415254273621e-30,-.7071067690849304,8.429368847373553e-8,-.7071068286895752),scale:new Vector3(3,3,3)});K.addComponentOrReplace(Z);var J=new Entity("tours");engine.addEntity(J),J.setParent(z);var $=new Transform({position:new Vector3(8,0,8),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});J.addComponentOrReplace($);var et=new GLTFShape("assets/tours4.glb");et.withCollisions=!0,et.isPointerBlocker=!0,et.visible=!0,J.addComponentOrReplace(et);var nt=new Transform({position:new Vector3(8,0,8),rotation:new Quaternion(0,0,0,1),scale:new Vector3(.99,.99,.99)}),it=new Entity("bordure");engine.addEntity(it),it.setParent(z),it.addComponentOrReplace(nt);var ot=new GLTFShape("assets/collisions_18.glb");ot.withCollisions=!0,ot.isPointerBlocker=!0,ot.visible=!0,it.addComponentOrReplace(ot);var rt=new Entity("tables");engine.addEntity(rt),rt.setParent(z);var st=new Transform({position:new Vector3(8,0,8),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});rt.addComponentOrReplace(st);var at=new GLTFShape("assets/TABLES.glb");at.withCollisions=!0,at.isPointerBlocker=!0,at.visible=!0,rt.addComponentOrReplace(at);var lt=new Entity("bars");engine.addEntity(lt),lt.setParent(z);var ht=new Transform({position:new Vector3(8,0,8),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});lt.addComponentOrReplace(ht);var ct=new GLTFShape("assets/Bars.glb");ct.withCollisions=!0,ct.isPointerBlocker=!0,ct.visible=!0,lt.addComponentOrReplace(ct);var ut=new Entity("verre");engine.addEntity(ut),ut.setParent(z);var dt=new Transform({position:new Vector3(8,0,8),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});ut.addComponentOrReplace(dt);var pt=new GLTFShape("assets/verre.glb");pt.withCollisions=!0,pt.isPointerBlocker=!0,pt.visible=!0,ut.addComponentOrReplace(pt);var yt=new Entity("canapes");engine.addEntity(yt),yt.setParent(z);var ft=new Transform({position:new Vector3(8,0,8),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});yt.addComponentOrReplace(ft);var gt=new GLTFShape("assets/canape.glb");gt.withCollisions=!0,gt.isPointerBlocker=!0,gt.visible=!0,yt.addComponentOrReplace(gt);var vt=new Entity("videoStream2");engine.addEntity(vt),vt.setParent(z);var bt=new Transform({position:new Vector3(7,7,.5),rotation:new Quaternion(21770622922413687e-31,5.960464477539063e-8,-24641827444380534e-31,-1),scale:new Vector3(1.500000238418579,1.5,1.500000238418579)});vt.addComponentOrReplace(bt);var wt=new Entity("videoStream3");engine.addEntity(wt),wt.setParent(z);var Tt=new Transform({position:new Vector3(.49999988079071045,11,8),rotation:new Quaternion(-6356408404321759e-30,.7071067690849304,-8.429368136830817e-8,.70710688829422),scale:new Vector3(1.5000009536743164,1.5,1.5000009536743164)});wt.addComponentOrReplace(Tt);var xt=new Entity("Elevator");engine.addEntity(xt),xt.setParent(z);var Ct=new Transform({position:new Vector3(14.5,0,13.5),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});xt.addComponent(Ct);var _t=new Entity("videoStream4");engine.addEntity(_t),_t.setParent(z);var At=new Transform({position:new Vector3(13.5,15,11.5),rotation:new Quaternion(-16008176255321509e-32,.70710688829422,-8.429368847373553e-8,-.7071067690849304),scale:new Vector3(1.5000064373016357,1.5,1.5000064373016357)});_t.addComponentOrReplace(At);var St=new Entity("vdeco");engine.addEntity(St),St.setParent(z);var Rt=new Transform({position:new Vector3(8,0,7.5),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});St.addComponentOrReplace(Rt);var Pt=new GLTFShape("assets/V.glb");Pt.withCollisions=!0,Pt.isPointerBlocker=!0,Pt.visible=!0,St.addComponentOrReplace(Pt);var It=new Entity("npc");engine.addEntity(It),It.setParent(z);var Ot=new Transform({position:new Vector3(2,0,15),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});It.addComponentOrReplace(Ot);var Nt=new Entity("npctarget");engine.addEntity(Nt);var zt=new Transform({position:new Vector3(2,0,5),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});Nt.addComponentOrReplace(zt);var Lt=new Entity("panneaux2");engine.addEntity(Lt),Lt.setParent(z);var Ft=new Transform({position:new Vector3(8,0,8),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)}),Bt=new GLTFShape("assets/panneaux.glb");Bt.withCollisions=!0,Bt.isPointerBlocker=!0,Bt.visible=!0,Lt.addComponentOrReplace(Ft),Lt.addComponentOrReplace(Bt);var kt=Math.random().toString(16).slice(2),Ht=new MessageBus,Ut={inventory:(0,E.createInventory)(UICanvas,UIContainerStack,UIImage)},Vt=new R.default,Wt=new I.default,Gt=new O.default;Vt.init(Ut),Wt.init(Ut),Gt.init(Ut),Vt.spawn(K,{startOn:!1,onClickText:"Play video",volume:1,onClick:[{entityName:"videoStream",actionId:"toggle",values:{}}],customStation:"https://ipfs.io/ipfs/Qme6yKmrju3KTmeAoPHbtgGWrMAEriPLp1AdE6dn1Mwrb4?filename=GLENFIDDICHxRYCHARSKI_202201003_v7eng.mp4"},(0,S.createChannel)(kt,K,Ht)),Vt.spawn(vt,{startOn:!1,onClickText:"Play video",volume:1,onClick:[{entityName:"videoStream2",actionId:"toggle",values:{}}],customStation:"https://ipfs.io/ipfs/Qme6yKmrju3KTmeAoPHbtgGWrMAEriPLp1AdE6dn1Mwrb4?filename=GLENFIDDICHxRYCHARSKI_202201003_v7eng.mp4"},(0,S.createChannel)(kt,vt,Ht)),Vt.spawn(wt,{startOn:!1,onClickText:"Play video",volume:1,onClick:[{entityName:"videoStream3",actionId:"toggle",values:{}}],customStation:"https://ipfs.io/ipfs/Qme6yKmrju3KTmeAoPHbtgGWrMAEriPLp1AdE6dn1Mwrb4?filename=GLENFIDDICHxRYCHARSKI_202201003_v7eng.mp4"},(0,S.createChannel)(kt,wt,Ht)),Wt.spawn(xt,{speed:5,levels:"0 6.02 9.96 14.07 18.8",duration:2e3},(0,S.createChannel)(kt,xt,Ht)),Vt.spawn(_t,{startOn:!1,onClickText:"Play video",volume:1,onClick:[{entityName:"videoStream4",actionId:"toggle",values:{}}],customStation:"https://ipfs.io/ipfs/Qme6yKmrju3KTmeAoPHbtgGWrMAEriPLp1AdE6dn1Mwrb4?filename=GLENFIDDICHxRYCHARSKI_202201003_v7eng.mp4"},(0,S.createChannel)(kt,_t,Ht)),Gt.spawn(It,{target:Nt},(0,S.createChannel)(kt,xt,Ht))}));